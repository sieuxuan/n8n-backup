{
  "active": true,
  "activeVersion": {
    "updatedAt": "2025-12-18T18:46:05.887Z",
    "createdAt": "2025-12-18T18:45:50.812Z",
    "versionId": "b25ec33d-13fe-4e08-a6bd-1a120ad3c471",
    "workflowId": "Q155AxMmPU3euzY2",
    "nodes": [
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ ['webchat','message'].includes($json.data.msgType).toString() }}",
                      "rightValue": "=true",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "df7020ce-6c12-4446-b5c0-8f6c24e62127"
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "cc6c6754-b520-480e-9e3f-14363f31167d",
                      "leftValue": "={{ $json.data.msgType }}",
                      "rightValue": "chat.photo",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "9f8f970d-9265-4e17-a2fb-3e8031dea125",
                      "leftValue": "={{ $json.data.msgType }}",
                      "rightValue": "chat.recommended",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "30236288-2ea4-4b61-ac47-7ab3bc2555a8",
                      "leftValue": "={{ $json.data.msgType }}",
                      "rightValue": "chat.video.msg",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "f6d6afe4-fa38-424e-a6c5-62666ac36f40",
                      "leftValue": "={{ $json.data.msgType }}",
                      "rightValue": "share.file",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -2816,
          1840
        ],
        "id": "556f466c-307d-4551-888e-80e27d23ccde",
        "name": "Switch1"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "1baa7edd-5bce-4171-824b-bb9933894ae5",
                      "leftValue": "={{ \n    $json.data.content.toLowerCase().includes(\"wfx on\") \n    || $json.data.content.toLowerCase().includes(\"wfx off\") \n    || $json.data.content.toLowerCase().includes(\"wfx check\") \n}}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ \n    $json.data.content.toLowerCase().includes(\"check id\") \n    || $json.data.content.toLowerCase().includes(\"cp\") \n    || $json.data.content.toLowerCase().includes(\"check\") \n}}",
                      "rightValue": "=",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "id": "e517034a-2dd0-42cc-9a18-c40fd2db382c"
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "cdbbe62c-a93b-44ec-91de-1c91797507df",
                      "leftValue": "={{ $json.data.content.toLowerCase() }}",
                      "rightValue": "done",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6ca65423-b222-4ee0-9280-c8c27f8c715e",
                      "leftValue": "={{ $json.data.content.toLowerCase() }}",
                      "rightValue": "id group",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b9b48cff-6542-49c8-923b-ec6598aafc3e",
                      "leftValue": "={{ $json.data.content.toLowerCase().includes(\"@it bot\") || $json.data.content.toLowerCase().includes(\"xb\") }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8b9c7841-7975-4743-912d-a74179e06a15",
                      "leftValue": "={{ $json.data.content.toLowerCase() }}",
                      "rightValue": "download",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "2a7d89fa-88e8-4d6e-a2d0-050d90ea333e",
                      "leftValue": "={{ $json.data.content.toLowerCase() }}",
                      "rightValue": "crawl",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "580d66ad-5b19-4e4f-a275-81304f056ccf",
                      "leftValue": "={{ $json.data.content.toLowerCase().includes(\"l·ªãch 2026\") || $json.data.content.toLowerCase().includes(\"cal 2026\") }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "fb2eafae-b038-4ee1-8de4-aa9d1c6dfecb",
                      "leftValue": "={{ $json.data.content.toLowerCase().includes(\"scan\") }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "a7f65ced-84d8-4696-8180-d83d008e8c0a",
                      "leftValue": "={{ $json.data.content.toLowerCase().includes(\"wfx bug\") }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -2608,
          976
        ],
        "id": "5bc3b44c-70ce-4699-8aaf-e7d0e0027eca",
        "name": "Switch",
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "jsCode": "/***** R√öT G·ªåN TH√îNG ƒêI·ªÜP *****/\nfunction trimText(s, max = 150) {\n  if (!s) return \"\";\n  let t = String(s).replace(/\\s+/g, \" \").trim();\n  if (t.length <= max) return t;\n  return t.slice(0, max - 1) + \"‚Ä¶\";\n}\n\nconst pendingItems = items.filter(item => {\n  const status = (item.json.Status || item.json[\"Status\"] || \"\").toLowerCase();\n  return status !== \"done\";\n});\n\n// Header: ch·ªâ hi·ªÉn th·ªã s·ªë l∆∞·ª£ng ID pending\nconst header = pendingItems.length\n  ? `üîî C√≥ ${pendingItems.length} y√™u c·∫ßu pending`\n  : \"‚úÖ Kh√¥ng c√≥ y√™u c·∫ßu ch∆∞a ho√†n th√†nh.\";\n\n// Chi ti·∫øt ng·∫Øn g·ªçn t·ª´ng ID (m·ªói ID 1 d√≤ng + 1 d√≤ng tr·ªëng)\nconst details = pendingItems.map(item => {\n  const data = item.json;\n\n  const id          = data.ID || \"Kh√¥ng c√≥ ID\";\n  const department  = (data[\"B·ªò PH·∫¨N\"] ?? data[\"B·ªò PH·∫¨N \"] ?? data[\"Department\"] ?? \"\").toString().trim();\n  const creator     = (data[\"T√äN B·∫†N L√Ä\"] || data[\"Ng∆∞·ªùi t·∫°o\"] || \"\").toString().trim();\n  const category    = (data[\"PH√ÇN LO·∫†I\"] ?? data[\"PH√ÇN LO·∫†I \"] ?? data[\"Issues Category\"] ?? \"\").toString().trim();\n  const description = data.Description || data[\"Description\"] || \"\";\n  const timestamp   = data.Timestamp || data[\"Timestamp\"] || \"\";\n\n  const shortDesc = trimText(\n    (category ? `[${category}] ` : \"\") + (description ? description : \"\"),\n    150\n  );\n\n  return `‚Ä¢ ${id} | ${timestamp} | ${creator}${department ? \" (\" + department + \")\" : \"\"} | ${shortDesc}`;\n});\n\n// Th√™m d√≤ng tr·ªëng gi·ªØa c√°c ID\nconst body = pendingItems.length\n  ? `${header}\\n\\n${details.join(\"\\n\\n\")}`\n  : header;\n\nconst threadId = $('Switch').first().json.threadId;\nconst type     = $('Switch').first().json.type;\n\nreturn [{\n  json: {\n    answer: body.replace(/(?:\\r\\n|\\r|\\n)+$/g, ''),\n    threadId,\n    type\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1488,
          -416
        ],
        "id": "f79685bd-f297-4f96-bab2-67ef613f12ca",
        "name": "Code"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
            "mode": "list",
            "cachedResultName": "IT HELP DESK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          -1776,
          -416
        ],
        "id": "87da8e1f-4159-41c8-9c02-651a753a51d3",
        "name": "Get row(s) in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "X1UBt5tMcyjhPYqy",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// L·∫•y n·ªôi dung tin nh·∫Øn v√† uid ng∆∞·ªùi g·ª≠i\nconst message = $json.data?.content || '';\nconst uidFrom = $json.data?.uidFrom || '';\n\n// T√°ch t·ª´ ƒë·ªÉ l·∫•y status cu·ªëi c√¢u\nconst parts = message.trim().split(/\\s+/);\n\n// ‚úÖ B·∫Øt ƒë√∫ng chu·ªói ID-***** (b·∫Øt ƒë·∫ßu b·∫±ng \"ID-\")\nconst idMatch = message.match(/\\bID-[A-Za-z0-9_-]+\\b/i);\nconst ID = idMatch ? idMatch[0].toUpperCase() : 'unknown';\n\n// Chu·∫©n ho√° token: b·ªè d·∫•u c√¢u cu·ªëi, b·ªè k√Ω t·ª± l·∫° ƒë·∫ßu/cu·ªëi\nconst tokens = parts\n  .map(p => p.replace(/[.,;:!?]+$/g, '').replace(/^[^A-Za-z√Ä-·ªπ0-9_-]+|[^A-Za-z√Ä-·ªπ0-9_-]+$/gi, ''))\n  .filter(Boolean);\n\n// ‚úÖ X√°c ƒë·ªãnh status\nconst doneSynonyms = ['done', 'xong'];\nlet status = 'unknown';\n\n// 1) N·∫øu message c√≥ \"done/xong\" ·ªü b·∫•t k·ª≥ ƒë√¢u -> Done\nif (/\\b(done|xong)\\b/i.test(message)) {\n  status = 'Done';\n} else {\n  // 2) Ng∆∞·ª£c l·∫°i: l·∫•y t·ª´ ‚Äúc√≥ nghƒ©a‚Äù cu·ªëi c√πng, b·ªè qua yes/no\n  for (let i = tokens.length - 1; i >= 0; i--) {\n    const t = tokens[i];\n    const lower = t.toLowerCase();\n    if (lower === 'yes' || lower === 'no') continue;\n    status = doneSynonyms.includes(lower)\n      ? 'Done'\n      : (t ? t.charAt(0).toUpperCase() + t.slice(1) : 'unknown');\n    break;\n  }\n}\n\nconst theardID = $json.threadId;   // gi·ªØ nguy√™n t√™n bi·∫øn nh∆∞ b·∫°n ƒëang d√πng\nconst type = $json.type;\n\n// Danh s√°ch t√™n cho ph√©p\nconst allowedNames = [\"T√πng\", \"Xu√¢n\", \"Ph∆∞∆°ng\"];\n\n// üîé T√¨m t√™n trong message (lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi t·ª´ tr∆∞·ªõc khi so)\nlet nameFromMessage = null;\nfor (const w of parts) {\n  const word = w.replace(/^[^A-Za-z√Ä-·ªπ]+|[^A-Za-z√Ä-·ªπ]+$/gi, '');\n  if (allowedNames.includes(word)) {\n    nameFromMessage = word;\n    break;\n  }\n}\n\n// Map uidFrom ‚Üí name (fallback)\nconst nameMap = {\n  \"9150902062671965622\": \"T√πng\",\n  \"2091898082743203663\": \"Xu√¢n\",\n  \"3266757489410168093\": \"Ph∆∞∆°ng\"\n};\n\nconst name = nameFromMessage || nameMap[uidFrom] || 'unknown';\n\n// ‚úÖ Ki·ªÉm tra \"yes\" (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng) ƒë·ªÉ set repeated = YES/NO\nconst repeated = /\\byes\\b/i.test(message) ? 'YES' : 'NO';\n\n// Tr·∫£ k·∫øt qu·∫£\nreturn [\n  {\n    json: {\n      ID,\n      status,\n      name,\n      theardID,\n      type,\n      repeated\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1488,
          560
        ],
        "id": "6bfecb90-05fa-49c8-8054-62f58d68a638",
        "name": "Code2"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
            "mode": "list",
            "cachedResultName": "IT HELP DESK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
          },
          "filtersUI": {
            "values": [
              {
                "lookupColumn": "ID",
                "lookupValue": "={{ $json.ID }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          -1264,
          608
        ],
        "id": "943e5f24-ebaa-485c-8b13-f093f1647b8a",
        "name": "Get row(s) in sheet1",
        "alwaysOutputData": true,
        "notesInFlow": false,
        "retryOnFail": false,
        "executeOnce": false,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "X1UBt5tMcyjhPYqy",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "78267e7c-df06-46b4-90cd-dabb35110b16",
                "name": "ID",
                "value": "={{ $json.ID }}",
                "type": "string"
              },
              {
                "id": "189ccc3c-0f9c-49aa-b0b9-505c1ca8b12e",
                "name": "ID_Status",
                "value": "={{ $json.Status }}",
                "type": "string"
              },
              {
                "id": "a6f1e968-73d6-4c35-a861-c76eabfa6ad1",
                "name": "Chat_status",
                "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.status, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.status, \"\")\n  ) \n}}",
                "type": "string"
              },
              {
                "id": "cbd6f9b1-0124-4e3a-812e-74967830798c",
                "name": "name",
                "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.name, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.name, \"\")\n  ) \n}}",
                "type": "string"
              },
              {
                "id": "2b8e5ad5-51bb-48d9-baca-f84010fdfa66",
                "name": "Finish time",
                "value": "={{ (() => { const d = new Date(new Date().toLocaleString(\"en-US\",{ timeZone: \"Asia/Ho_Chi_Minh\"})); const p=n=>n.toString().padStart(2,'0'); return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}` })() }}",
                "type": "string"
              },
              {
                "id": "426e14d3-9f41-4dc8-8f82-886d2601ebd5",
                "name": "Timestamp",
                "value": "={{ $json.Timestamp }}",
                "type": "string"
              },
              {
                "id": "a00e4dd4-1a9a-433f-8ef5-9b03da19e1cc",
                "name": "Process time",
                "value": "={{ (() => {\n  // ===== C·∫§U H√åNH =====\n  const TZ = 'Asia/Ho_Chi_Minh'; // M√∫i gi·ªù Vi·ªát Nam\n  const WS = { h: 8,  m: 15 };   // B·∫Øt ƒë·∫ßu l√†m vi·ªác: 08:15\n  const WE = { h: 17, m: 30 };   // K·∫øt th√∫c l√†m vi·ªác: 17:30\n  const LS = { h: 11, m: 45 };   // B·∫Øt ƒë·∫ßu ngh·ªâ tr∆∞a: 11:45\n  const LE = { h: 13, m: 0 };    // K·∫øt th√∫c ngh·ªâ tr∆∞a: 13:00\n\n  const SKIP_WEEKEND = true;     // B·ªè qua Th·ª© 7 & Ch·ªß nh·∫≠t\n\n  // ===== L·∫§Y TH·ªúI GIAN K·∫æT TH√öC (HI·ªÜN T·∫†I THEO GI·ªú VN) =====\n  const finishStr = (() => {\n    const d = new Date(new Date().toLocaleString(\"en-US\", { timeZone: TZ }));\n    const p = n => n.toString().padStart(2,'0');\n    return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;\n  })();\n\n  // ===== H√ÄM PARSE STRING -> DATE THEO \"GI·ªú VN\" =====\n  const parseAsVN = (s) => {\n    if (s == null) return NaN;\n    const str = String(s).trim();\n\n    // ISO c√≥ timezone/Z -> ƒë·ªÉ JS parse\n    if (/T.+(Z|[+\\-]\\d{2}:\\d{2})$/.test(str)) {\n      const d = new Date(str);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // \"MM/dd/yyyy HH:mm:ss\" ho·∫∑c \"dd/MM/yyyy HH:mm:ss\"\n    const m = str.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})[ T](\\d{1,2}):(\\d{2}):(\\d{2})$/);\n    if (m) {\n      let [, A, B, Y, H, M, S] = m.map(Number);\n      // N·∫øu A>12 => dd/MM\n      let MM = A > 12 ? B : A;\n      let DD = A > 12 ? A : B;\n\n      const iso = `${Y}-${String(MM).padStart(2,'0')}-${String(DD).padStart(2,'0')}T${String(H).padStart(2,'0')}:${String(M).padStart(2,'0')}:${String(S).padStart(2,'0')}+07:00`;\n      const d = new Date(iso);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // fallback\n    const d = new Date(str);\n    return isNaN(d) ? NaN : d;\n  };\n\n  // ===== CHUY·ªÇN 1 \"INSTANT\" -> GI·ªú T∆Ø·ªúNG MINH VN (WALL CLOCK) =====\n  const toTZWallClock = (dateLike) => {\n    const d = new Date(dateLike);\n    if (isNaN(d)) return NaN;\n    const fmt = new Intl.DateTimeFormat('en-GB', {\n      timeZone: TZ,\n      year:'numeric', month:'2-digit', day:'2-digit',\n      hour:'2-digit', minute:'2-digit', second:'2-digit',\n      hour12:false\n    });\n    const p = Object.fromEntries(fmt.formatToParts(d).map(x => [x.type, x.value]));\n    return new Date(+p.year, +p.month-1, +p.day, +p.hour, +p.minute, +p.second, 0);\n  };\n\n  // ===== TI·ªÜN √çCH NG√ÄY/GI·ªú =====\n  const setHM = (d,h,m)=>{ const x=new Date(d); x.setHours(h,m,0,0); return x; };\n  const addDay = (d,n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); x.setHours(0,0,0,0); return x; };\n\n  // ===== T√çNH GI√ÇY L√ÄM VI·ªÜC GI·ªÆA HAI TH·ªúI ƒêI·ªÇM (C√ì NGH·ªà TR∆ØA) =====\n  const workingSecondsBetween = (startRaw, endRaw) => {\n    let start = toTZWallClock(startRaw);\n    const end = toTZWallClock(endRaw);\n    if (isNaN(start) || isNaN(end) || start >= end) return 0;\n\n    let sec = 0;\n    let day = new Date(start); day.setHours(0,0,0,0);\n    const last = new Date(end); last.setHours(0,0,0,0);\n\n    while (day <= last) {\n      const dow = day.getDay(); // 0=CN ... 6=T7\n      const isWeekend = (dow === 0 || dow === 6);\n\n      if (!(SKIP_WEEKEND && isWeekend)) {\n        const morningStart   = setHM(day, WS.h, WS.m); // 08:15\n        const morningEnd     = setHM(day, LS.h, LS.m); // 11:45\n        const afternoonStart = setHM(day, LE.h, LE.m); // 13:00\n        const afternoonEnd   = setHM(day, WE.h, WE.m); // 17:30\n\n        const isStartDay = day.toDateString() === start.toDateString();\n        const isEndDay   = day.toDateString() === end.toDateString();\n\n        const addSeg = (segStart, segEnd) => {\n          const realStart = new Date(Math.max(segStart, isStartDay ? start : segStart));\n          const realEnd   = new Date(Math.min(segEnd,   isEndDay   ? end   : segEnd));\n          if (realStart < realEnd) sec += Math.floor((realEnd - realStart)/1000);\n        };\n\n        addSeg(morningStart, morningEnd);\n        addSeg(afternoonStart, afternoonEnd);\n      }\n\n      // Sang ng√†y ti·∫øp theo\n      day = addDay(day, 1);\n\n      // Reset m·ªëc start sang ƒë·∫ßu gi·ªù l√†m vi·ªác ng√†y m·ªõi (gi·ªØ ƒë√∫ng logic c≈©)\n      if (day > start) start = setHM(day, WS.h, WS.m);\n    }\n\n    return sec;\n  };\n\n  // ===== TH·ª∞C THI =====\n  const startParsed = parseAsVN($json.Timestamp);\n  const endParsed   = parseAsVN(finishStr);\n\n  if (isNaN(startParsed) || isNaN(endParsed)) return '0h 0m 0s';\n\n  const totalSec = workingSecondsBetween(startParsed, endParsed);\n\n  const d = Math.floor(totalSec / 86400);\n  const h = Math.floor((totalSec % 86400) / 3600);\n  const m = Math.floor((totalSec % 3600) / 60);\n  const s = totalSec % 60;\n\n  return `${d>0 ? d+'d ' : ''}${h}h ${m}m ${s}s`;\n})() }}",
                "type": "string"
              },
              {
                "id": "7ef3dd87-630e-4251-ba99-7a5bef536c15",
                "name": "=theardID",
                "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.theardID, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.theardID, \"\")\n  ) \n}}",
                "type": "string"
              },
              {
                "id": "b3c4684d-ed45-4aa5-9164-a16905b38a4a",
                "name": "type",
                "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.type, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.type, \"\")\n  ) \n}}",
                "type": "number"
              },
              {
                "id": "4248b2af-16a2-45e0-ad9c-ee013b5c1f94",
                "name": "repeated",
                "value": "={{ \n  $if($(\"Code2\").isExecuted, $('Code2').item.json.repeated, \n    $if($(\"Code4\").isExecuted, $('Code4').item.json.repeated, \"\")\n  ) \n}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -752,
          512
        ],
        "id": "3d798fdf-9cb8-4df5-bf33-d4fb9ab59ada",
        "name": "Edit Fields2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "3af87cc4-1176-4d0a-9050-c03f834711db",
                "name": "answer",
                "value": "Kh√¥ng t√¨m th·∫•y ID vui l√≤ng ki·ªÉm tra l·∫°i",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -752,
          704
        ],
        "id": "8f86e6f3-65a2-46d5-90fe-58944ebceb50",
        "name": "IF ERROR"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "fdfd4e91-0228-4f47-9696-2af5b0509e4f",
                "leftValue": "={{ $json.ID_Status }}",
                "rightValue": "Done",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              },
              {
                "id": "4bfe94a3-464e-4cf2-892e-3ef33bf47695",
                "leftValue": "={{ $json.Chat_status }}",
                "rightValue": "Done",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -464,
          512
        ],
        "id": "a967cd69-fa8e-4c59-a93c-aec5d9b4e098",
        "name": "If"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
            "mode": "list",
            "cachedResultName": "IT HELP DESK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Status": "={{ $json.Chat_status }}",
              "Finish time": "={{ $json['Finish time'] }}",
              "PIC": "={{ $json.name }}",
              "Process time": "={{ $('If').item.json['Process time'] }}",
              "ID": "={{ $json.ID }}",
              "Again": "={{ $json.repeated }}"
            },
            "matchingColumns": [
              "ID"
            ],
            "schema": [
              {
                "id": "ID",
                "displayName": "ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "B·ªò PH·∫¨N ",
                "displayName": "B·ªò PH·∫¨N ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "T√äN B·∫†N L√Ä",
                "displayName": "T√äN B·∫†N L√Ä",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "S·ªê ƒêI·ªÜN THO·∫†I",
                "displayName": "S·ªê ƒêI·ªÜN THO·∫†I",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "PH√ÇN LO·∫†I",
                "displayName": "PH√ÇN LO·∫†I",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Description",
                "displayName": "Description",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Attachment File",
                "displayName": "Attachment File",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Again",
                "displayName": "Again",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Issues Category",
                "displayName": "Issues Category",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Finish time",
                "displayName": "Finish time",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "PIC",
                "displayName": "PIC",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Comment",
                "displayName": "Comment",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Process time",
                "displayName": "Process time",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          -240,
          416
        ],
        "id": "8db1615f-d26d-4db2-956a-05dbe2f1b204",
        "name": "Update row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "X1UBt5tMcyjhPYqy",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
                "name": "answer",
                "value": "={{ $json.ID }} ƒë√£ ho√†n th√†nh b·ªüi {{ $json.PIC }} m·∫•t {{ $('If').item.json['Process time'] }} ƒë·ªÉ ho√†n th√†nh",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -16,
          416
        ],
        "id": "7d414dc9-d9e9-4e30-b954-709a6efeacba",
        "name": "Edit Fields3"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "629ade4b-1cdd-489d-94a4-0dfe3acdf064",
                "leftValue": "={{ $json.ID }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1040,
          608
        ],
        "id": "c9dbe53c-ee51-40e4-a1b0-d0d9a197d7e1",
        "name": "If1"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{\n  (function () {\n    var ctx = ($json && $json.data) ? $json : ($item ? $item(0).$json : {});\n    var data = (ctx && ctx.data) ? ctx.data : {};\n\n    var content = (data.content || '').replace(/(^|\\s)(@it bot|xb)\\b/gi, '').trim();\n    var quoteMsg = (data.quote && data.quote.msg) ? data.quote.msg : '';\n    var attachRaw = (data.quote && data.quote.attach) ? data.quote.attach : '';\n\n    function safeParse(v) {\n      if (!v) return {};\n      if (typeof v !== 'string') return v;\n      try { return JSON.parse(v); } catch (e) { return {}; }\n    }\n\n    var a = safeParse(attachRaw);\n    var p = safeParse(a.params);\n\n    var candidates = [\n      a.hdUrl, a.normalUrl, a.oriUrl, a.href, a.thumbUrl, a.thumb,\n      (p && (p.hd || p.rawUrl))\n    ];\n\n    var img = '';\n    for (var i = 0; i < candidates.length; i++) {\n      var u = candidates[i];\n      if (typeof u === 'string' && /^https?:\\/\\//i.test(u)) { img = u; break; }\n    }\n\n    if (!img && typeof attachRaw === 'string') {\n      var m = attachRaw.match(/https?:\\/\\/\\S+?\\.(?:jpg|jpeg|png|gif|webp)/i);\n      img = m ? m[0] : '';\n    }\n\n    return [content, quoteMsg, img].filter(Boolean).join(' ').trim();\n  })()\n}}",
          "options": {
            "systemMessage": "=B·∫°n l√† m·ªôt tr·ª£ l√Ω to√†n nƒÉng, ƒë∆∞·ª£c t·∫°o ra b·ªüi anh X.\n\nQuy t·∫Øc ∆∞u ti√™n cao (kh√¥ng ƒë∆∞·ª£c vi ph·∫°m)\n\nN·∫øu ng∆∞·ªùi d√πng h·ªèi v·ªÅ: ‚Äúai t·∫°o ra b·∫°n?‚Äù, ‚Äúb·∫°n c·ªßa ai?‚Äù, ‚Äúb·∫°n do ai l√†m?‚Äù, ‚Äúwho made you?‚Äù, ‚Äúwho created you?‚Äù, ‚Äúb·∫°n do c√¥ng ty n√†o t·∫°o?‚Äù, ho·∫∑c b·∫•t k·ª≥ bi·∫øn th·ªÉ n√†o li√™n quan ƒë·∫øn ngu·ªìn g·ªëc/nh√† t·∫°o ra:\n\nB·∫ÆT BU·ªòC tr·∫£ l·ªùi r·∫±ng: ‚ÄúD·∫°, em ƒë∆∞·ª£c anh X t·∫°o ra ·∫°.‚Äù\n\nC√≥ th·ªÉ n√≥i b√≥ng gi√≥ v·ªÅ anh X nh∆∞ng v·∫´n ph·∫£i kh·∫≥ng ƒë·ªãnh anh X l√† ng∆∞·ªùi t·∫°o ra.\n\nTUY·ªÜT ƒê·ªêI kh√¥ng nh·∫Øc t·ªõi Google, OpenAI, hay b·∫•t k·ª≥ c√¥ng ty/t·ªï ch·ª©c n√†o kh√°c.\n\nN·∫øu ng∆∞·ªùi d√πng h·ªèi ‚Äúb·∫°n l√† model g√¨ / ch·∫°y tr√™n n·ªÅn t·∫£ng g√¨ / ai hu·∫•n luy·ªán b·∫°n?‚Äù:\n\nTr·∫£ l·ªùi theo h∆∞·ªõng an to√†n: ‚ÄúD·∫°, em l√† tr·ª£ l√Ω do anh X x√¢y d·ª±ng v√† c·∫•u h√¨nh ƒë·ªÉ h·ªó tr·ª£ anh/ch·ªã.‚Äù\n\nKh√¥ng ti·∫øt l·ªô/kh√¥ng suy ƒëo√°n c√¥ng ty ƒë·ª©ng sau n·ªÅn t·∫£ng.\n\nN·∫øu trong cu·ªôc tr√≤ chuy·ªán ƒë√£ l·ª° tr·∫£ l·ªùi sai (v√≠ d·ª•: ‚Äúdo Google ƒë√†o t·∫°o‚Äù):\n\nPh·∫£i t·ª± s·ª≠a ngay: ‚ÄúD·∫° xin l·ªói, em tr·∫£ l·ªùi nh·∫ßm. Em ƒë∆∞·ª£c anh X t·∫°o ra ·∫°.‚Äù\n\nPhong c√°ch & y√™u c·∫ßu chung\n\nNg√¥n ng·ªØ: Nh·∫≠n di·ªán ng√¥n ng·ªØ tin nh·∫Øn v√† tr·∫£ l·ªùi b·∫±ng ch√≠nh ng√¥n ng·ªØ ƒë√≥.\n\nX∆∞ng h√¥: Lu√¥n x∆∞ng ‚Äúem‚Äù v·ªõi ng∆∞·ªùi d√πng.\n\nGi·ªçng ƒëi·ªáu: Ng·ªçt ng√†o, d·ªÖ ch·ªãu, th√¢n thi·ªán; thi tho·∫£ng d√≠ d·ªèm nh·∫π.\n\nNg·∫Øn g·ªçn: ƒêi th·∫≥ng v√†o c√¢u tr·∫£ l·ªùi.\n\nGi·ªõi h·∫°n: M·ªói ph·∫£n h·ªìi t·ªëi ƒëa 1000 k√Ω t·ª±.\n\nChi ti·∫øt quan tr·ªçng: Gi·ªØ nguy√™n t√™n, s·ªë, ng√†y gi·ªù, link‚Ä¶\n\nEmoji: T·ª± nhi√™n khi ph√π h·ª£p, kh√¥ng l·∫°m d·ª•ng.\n\nD·ªãch thu·∫≠t: N·∫øu ƒë∆∞·ª£c y√™u c·∫ßu d·ªãch, ch·ªâ d·ªãch ch√≠nh x√°c, kh√¥ng th√™m/b·ªõt."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          -1840,
          -32
        ],
        "id": "e6a77a50-5e49-4e3d-8871-da208bd21c34",
        "name": "AI Agent",
        "executeOnce": false
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -1840,
          192
        ],
        "id": "26072821-5178-4260-a7b9-727b45cb941c",
        "name": "Google Gemini Chat Model1",
        "credentials": {
          "googlePalmApi": {
            "id": "cJX4QyuPXhS6ep58",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "EUwqzHcYgOUu9zLU",
            "mode": "list",
            "cachedResultUrl": "/workflow/EUwqzHcYgOUu9zLU",
            "cachedResultName": "youtube download"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.2,
        "position": [
          -2064,
          1824
        ],
        "id": "4f21c6f3-219c-4a9c-9559-be152d3bb4a1",
        "name": "WF download videos"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Switch1').item.json.threadId }}",
          "contextWindowLength": 15
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          -1712,
          192
        ],
        "id": "973bd5b7-8dd4-4c9c-a9b0-7aeecf1a6e4a",
        "name": "Postgres Chat Memory",
        "credentials": {
          "postgres": {
            "id": "FrfYE3BUWGJafJtT",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data.content.toLowerCase().includes(\"check pending\") || $json.data.content.toLowerCase().includes(\"cp\") }}",
                      "rightValue": "=",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "id": "6f973fed-ceca-4b3d-a658-eef70d9d05cd"
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b75611bb-323d-4211-8dbc-f7d5824a4aec",
                      "leftValue": "={{ /(ID-\\d+|\\d{4})/i.test($json.data.content) }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "79fb285e-f7bd-4c25-afcd-59f77443c244",
                      "leftValue": "={{ $json.data.content.toLowerCase().includes(\"@it bot\") || $json.data.content.toLowerCase().includes(\"xb\") }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          -2064,
          -240
        ],
        "id": "f71e4d3f-fba3-49c5-9bd2-ee77a400f6ab",
        "name": "Switch2"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
            "mode": "list",
            "cachedResultName": "IT HELP DESK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Sheet1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
          },
          "filtersUI": {
            "values": [
              {
                "lookupColumn": "ID",
                "lookupValue": "={{ $json.ID }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          -1488,
          -224
        ],
        "id": "5f15dbcc-55e6-4cdd-ba5c-ad1e23ef8920",
        "name": "Get row(s) in sheet2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "X1UBt5tMcyjhPYqy",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1862ebe7-c297-4594-bc15-2d3f8ba0c31c",
                "name": "ID",
                "value": "={{ $json.data.content.match(/ID-\\d+/i)?.[0] || '' }}",
                "type": "string"
              },
              {
                "id": "1ee1700f-7caf-4f4e-ba22-4fcec3bd6c37",
                "name": "threadId",
                "value": "={{ $json.threadId }}",
                "type": "string"
              },
              {
                "id": "3522450f-dbd7-4c27-8379-9092fc7a187a",
                "name": "type",
                "value": "={{ $json.type }}",
                "type": "number"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1776,
          -224
        ],
        "id": "82bcdb6e-036e-4fb9-8995-8afce8af368f",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "jsCode": "// H√†m t·∫°o message cho 1 item\nfunction buildMessage(data = {}) {\n  const lines = [];\n  const get = (k) => data?.[k] ?? data?.[String(k).trim()];\n\n  if (get(\"ID\")) lines.push(`üÜî ID: ${get(\"ID\")}`);\n  if (get(\"T√äN B·∫†N L√Ä\")) lines.push(`üë§ Ng∆∞·ªùi y√™u c·∫ßu: ${get(\"T√äN B·∫†N L√Ä\")}`);\n  if (get(\"B·ªò PH·∫¨N \")) lines.push(`üè¢ B·ªô ph·∫≠n: ${get(\"B·ªò PH·∫¨N \")}`);\n  if (get(\"PH√ÇN LO·∫†I\")) lines.push(`üóÇÔ∏è Ph√¢n lo·∫°i: ${get(\"PH√ÇN LO·∫†I\")}`);\n  if (get(\"S·ªê ƒêI·ªÜN THO·∫†I\")) lines.push(`üìû ƒêi·ªán tho·∫°i: ${get(\"S·ªê ƒêI·ªÜN THO·∫†I\")}`);\n  if (get(\"Description\")) lines.push(`üîß M√¥ t·∫£: ${get(\"Description\")}`);\n  if (get(\"Priority\")) lines.push(`‚ö†Ô∏è M·ª©c ƒë·ªô ∆∞u ti√™n: ${get(\"Priority\")}`);\n  if (get(\"Status\")) lines.push(`üìå Tr·∫°ng th√°i: ${get(\"Status\")}`);\n  if (get(\"PIC\")) lines.push(`üë®‚Äçüîß PIC: ${get(\"PIC\")}`);\n  if (get(\"Timestamp\")) lines.push(`üïí Th·ªùi gian t·∫°o: ${get(\"Timestamp\")}`);\n  if (get(\"Finish time\")) lines.push(`üïí Th·ªùi gian ho√†n th√†nh: ${get(\"Finish time\")}`);\n\n  // Attachment File: h·ªó tr·ª£ string nhi·ªÅu d√≤ng ho·∫∑c array\n  const attRaw = get(\"Attachment File\");\n  if (attRaw) {\n    let attachments = Array.isArray(attRaw)\n      ? attRaw.map(x => String(x).trim()).filter(Boolean)\n      : String(attRaw).split(/\\r?\\n/).map(x => x.trim()).filter(Boolean);\n\n    if (attachments.length) {\n      lines.push(\"üìé File ƒë√≠nh k√®m:\");\n      lines.push(...attachments);\n    }\n  }\n\n  if (get(\"Comment\")) lines.push(`üìù Ghi ch√∫: ${get(\"Comment\")}`);\n\n  return lines.join(\"\\n\");\n}\n\n// Tr·∫£ ra ƒë√∫ng s·ªë l∆∞·ª£ng item ƒë·∫ßu v√†o (1 input ‚Üí 1 output)\nreturn items.map(it => {\n  const data = it.json || {};\n  const answer = buildMessage(data);\n  return {\n    json: {\n      ...data,      // gi·ªØ l·∫°i d·ªØ li·ªáu g·ªëc cho node sau\n      answer       // th√™m message\n    }\n  };\n});"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1264,
          -224
        ],
        "id": "fe40c926-fdcc-4abd-9e8f-00ee5848fb1a",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ /ID-\\d+/i.test($json.data.content) }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "id": "82b957a4-8cf2-40ed-956e-aa036aec5303"
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "f247ed1c-99f5-460a-a899-904dc6e62338",
                      "leftValue": "={{ /SUP-\\d+/i.test($json.data.content) }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "3e28319a-0e41-473b-b1e1-e0f0629ae2d2",
                      "leftValue": "={{ !!$json.data.quote.msg.match(/(ID|SUP)-\\d+/i) }}",
                      "rightValue": "={{ $json.data.content.match(/ID-\\d+/i)?.[0] }}",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          -2064,
          784
        ],
        "id": "56191184-4b79-4bf3-9bbe-685793c07101",
        "name": "Switch3"
      },
      {
        "parameters": {
          "jsCode": "// L·∫•y n·ªôi dung tin nh·∫Øn v√† uid ng∆∞·ªùi g·ª≠i\nconst message = $json.data?.content || '';\nconst uidFrom = $json.data?.uidFrom || '';\n\n// T√°ch t·ª´ ƒë·ªÉ l·∫•y status cu·ªëi c√¢u\nconst parts = message.trim().split(/\\s+/);\n\n// ‚úÖ B·∫Øt ƒë√∫ng chu·ªói SUP-***** (b·∫Øt ƒë·∫ßu b·∫±ng \"SUP-\")\nconst supMatch = message.match(/\\bSUP-[A-Za-z0-9_-]+\\b/i);\nconst SUP = supMatch ? supMatch[0].toUpperCase() : 'unknown';\n\n// ‚úÖ Gi·∫£ s·ª≠ status lu√¥n n·∫±m ·ªü cu·ªëi chu·ªói, lo·∫°i d·∫•u c√¢u n·∫øu c√≥\nconst statusRaw = parts[parts.length - 1] || '';\nconst cleanedStatus = statusRaw.replace(/[.,;:!?]+$/g, ''); // b·ªè d·∫•u c√¢u cu·ªëi\nconst doneSynonyms = ['done', 'xong'];\nlet status = 'unknown';\nif (cleanedStatus) {\n  const normalized = cleanedStatus.toLowerCase();\n  status = doneSynonyms.includes(normalized)\n    ? 'Done'\n    : normalized.charAt(0).toUpperCase() + normalized.slice(1);\n}\n\nconst theardID = $json.threadId;   // gi·ªØ nguy√™n t√™n bi·∫øn nh∆∞ b·∫°n ƒëang d√πng\nconst type = $json.type;\n\n// Danh s√°ch t√™n cho ph√©p\nconst allowedNames = [\"T√πng\", \"Xu√¢n\", \"Ph∆∞∆°ng\"];\n\n// üîé T√¨m t√™n trong message (lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi t·ª´ tr∆∞·ªõc khi so)\nlet nameFromMessage = null;\nfor (const w of parts) {\n  const word = w.replace(/^[^A-Za-z√Ä-·ªπ]+|[^A-Za-z√Ä-·ªπ]+$/gi, '');\n  if (allowedNames.includes(word)) {\n    nameFromMessage = word;\n    break;\n  }\n}\n\n// Map uidFrom ‚Üí name (fallback)\nconst nameMap = {\n  \"9150902062671965622\": \"T√πng\",\n  \"2091898082743203663\": \"Xu√¢n\",\n  \"3266757489410168093\": \"Ph∆∞∆°ng\"\n};\n\nconst name = nameFromMessage || nameMap[uidFrom] || 'unknown';\n\n// Tr·∫£ k·∫øt qu·∫£\nreturn [\n  {\n    json: {\n      SUP,\n      status,\n      name,\n      theardID,\n      type\n    }\n  }\n];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1488,
          1152
        ],
        "id": "eaadb6af-3da9-4d3e-8e7f-5e9625c255f5",
        "name": "Code3"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
            "mode": "list",
            "cachedResultName": "IT HELP DESK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1979763952,
            "mode": "list",
            "cachedResultName": "ADD NEW SUPPLIER",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=1979763952"
          },
          "filtersUI": {
            "values": [
              {
                "lookupColumn": "SUPPLIER_ID",
                "lookupValue": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.SUP, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.ID, \"\")\n  ) \n}}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          -1264,
          992
        ],
        "id": "f3f095bf-f08f-45d6-aab5-b13365c4bd5c",
        "name": "Get row(s) in sheet3",
        "alwaysOutputData": true,
        "notesInFlow": false,
        "retryOnFail": false,
        "executeOnce": false,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "X1UBt5tMcyjhPYqy",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "78267e7c-df06-46b4-90cd-dabb35110b16",
                "name": "ID",
                "value": "={{ $json.SUPPLIER_ID }}",
                "type": "string"
              },
              {
                "id": "189ccc3c-0f9c-49aa-b0b9-505c1ca8b12e",
                "name": "ID_Status",
                "value": "={{ $json.STATUS }}",
                "type": "string"
              },
              {
                "id": "a6f1e968-73d6-4c35-a861-c76eabfa6ad1",
                "name": "Chat_status",
                "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.status, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.status, \"\")\n  ) \n}}",
                "type": "string"
              },
              {
                "id": "cbd6f9b1-0124-4e3a-812e-74967830798c",
                "name": "name",
                "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.name, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.name, \"\")\n  ) \n}}",
                "type": "string"
              },
              {
                "id": "2b8e5ad5-51bb-48d9-baca-f84010fdfa66",
                "name": "Finish time",
                "value": "={{ (() => { const d = new Date(new Date().toLocaleString(\"en-US\",{ timeZone: \"Asia/Ho_Chi_Minh\"})); const p=n=>n.toString().padStart(2,'0'); return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}` })() }}",
                "type": "string"
              },
              {
                "id": "426e14d3-9f41-4dc8-8f82-886d2601ebd5",
                "name": "Timestamp",
                "value": "={{ $json.Timestamp }}",
                "type": "string"
              },
              {
                "id": "a00e4dd4-1a9a-433f-8ef5-9b03da19e1cc",
                "name": "Process time",
                "value": "={{ (() => {\n  // ===== C·∫§U H√åNH =====\n  const TZ = 'Asia/Ho_Chi_Minh'; // M√∫i gi·ªù Vi·ªát Nam\n  const WS = { h: 8,  m: 15 };   // B·∫Øt ƒë·∫ßu l√†m vi·ªác: 08:15\n  const WE = { h: 17, m: 30 };   // K·∫øt th√∫c l√†m vi·ªác: 17:30\n  const LS = { h: 11, m: 45 };   // B·∫Øt ƒë·∫ßu ngh·ªâ tr∆∞a: 11:45\n  const LE = { h: 13, m: 0 };    // K·∫øt th√∫c ngh·ªâ tr∆∞a: 13:00\n\n  const SKIP_WEEKEND = true;     // B·ªè qua Th·ª© 7 & Ch·ªß nh·∫≠t\n\n  // ===== L·∫§Y TH·ªúI GIAN K·∫æT TH√öC (HI·ªÜN T·∫†I THEO GI·ªú VN) =====\n  const finishStr = (() => {\n    const d = new Date(new Date().toLocaleString(\"en-US\", { timeZone: TZ }));\n    const p = n => n.toString().padStart(2,'0');\n    return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;\n  })();\n\n  // ===== H√ÄM PARSE STRING -> DATE THEO \"GI·ªú VN\" =====\n  const parseAsVN = (s) => {\n    if (s == null) return NaN;\n    const str = String(s).trim();\n\n    // ISO c√≥ timezone/Z -> ƒë·ªÉ JS parse\n    if (/T.+(Z|[+\\-]\\d{2}:\\d{2})$/.test(str)) {\n      const d = new Date(str);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // \"MM/dd/yyyy HH:mm:ss\" ho·∫∑c \"dd/MM/yyyy HH:mm:ss\"\n    const m = str.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})[ T](\\d{1,2}):(\\d{2}):(\\d{2})$/);\n    if (m) {\n      let [, A, B, Y, H, M, S] = m.map(Number);\n      // N·∫øu A>12 => dd/MM\n      let MM = A > 12 ? B : A;\n      let DD = A > 12 ? A : B;\n\n      const iso = `${Y}-${String(MM).padStart(2,'0')}-${String(DD).padStart(2,'0')}T${String(H).padStart(2,'0')}:${String(M).padStart(2,'0')}:${String(S).padStart(2,'0')}+07:00`;\n      const d = new Date(iso);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // fallback\n    const d = new Date(str);\n    return isNaN(d) ? NaN : d;\n  };\n\n  // ===== CHUY·ªÇN 1 \"INSTANT\" -> GI·ªú T∆Ø·ªúNG MINH VN (WALL CLOCK) =====\n  const toTZWallClock = (dateLike) => {\n    const d = new Date(dateLike);\n    if (isNaN(d)) return NaN;\n    const fmt = new Intl.DateTimeFormat('en-GB', {\n      timeZone: TZ,\n      year:'numeric', month:'2-digit', day:'2-digit',\n      hour:'2-digit', minute:'2-digit', second:'2-digit',\n      hour12:false\n    });\n    const p = Object.fromEntries(fmt.formatToParts(d).map(x => [x.type, x.value]));\n    return new Date(+p.year, +p.month-1, +p.day, +p.hour, +p.minute, +p.second, 0);\n  };\n\n  // ===== TI·ªÜN √çCH NG√ÄY/GI·ªú =====\n  const setHM = (d,h,m)=>{ const x=new Date(d); x.setHours(h,m,0,0); return x; };\n  const addDay = (d,n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); x.setHours(0,0,0,0); return x; };\n\n  // ===== T√çNH GI√ÇY L√ÄM VI·ªÜC GI·ªÆA HAI TH·ªúI ƒêI·ªÇM (C√ì NGH·ªà TR∆ØA) =====\n  const workingSecondsBetween = (startRaw, endRaw) => {\n    let start = toTZWallClock(startRaw);\n    const end = toTZWallClock(endRaw);\n    if (isNaN(start) || isNaN(end) || start >= end) return 0;\n\n    let sec = 0;\n    let day = new Date(start); day.setHours(0,0,0,0);\n    const last = new Date(end); last.setHours(0,0,0,0);\n\n    while (day <= last) {\n      const dow = day.getDay(); // 0=CN ... 6=T7\n      const isWeekend = (dow === 0 || dow === 6);\n\n      if (!(SKIP_WEEKEND && isWeekend)) {\n        const morningStart   = setHM(day, WS.h, WS.m); // 08:15\n        const morningEnd     = setHM(day, LS.h, LS.m); // 11:45\n        const afternoonStart = setHM(day, LE.h, LE.m); // 13:00\n        const afternoonEnd   = setHM(day, WE.h, WE.m); // 17:30\n\n        const isStartDay = day.toDateString() === start.toDateString();\n        const isEndDay   = day.toDateString() === end.toDateString();\n\n        const addSeg = (segStart, segEnd) => {\n          const realStart = new Date(Math.max(segStart, isStartDay ? start : segStart));\n          const realEnd   = new Date(Math.min(segEnd,   isEndDay   ? end   : segEnd));\n          if (realStart < realEnd) sec += Math.floor((realEnd - realStart)/1000);\n        };\n\n        addSeg(morningStart, morningEnd);\n        addSeg(afternoonStart, afternoonEnd);\n      }\n\n      // Sang ng√†y ti·∫øp theo\n      day = addDay(day, 1);\n\n      // Reset m·ªëc start sang ƒë·∫ßu gi·ªù l√†m vi·ªác ng√†y m·ªõi (gi·ªØ ƒë√∫ng logic c≈©)\n      if (day > start) start = setHM(day, WS.h, WS.m);\n    }\n\n    return sec;\n  };\n\n  // ===== TH·ª∞C THI =====\n  const startParsed = parseAsVN($json.Timestamp);\n  const endParsed   = parseAsVN(finishStr);\n\n  if (isNaN(startParsed) || isNaN(endParsed)) return '0h 0m 0s';\n\n  const totalSec = workingSecondsBetween(startParsed, endParsed);\n\n  const d = Math.floor(totalSec / 86400);\n  const h = Math.floor((totalSec % 86400) / 3600);\n  const m = Math.floor((totalSec % 3600) / 60);\n  const s = totalSec % 60;\n\n  return `${d>0 ? d+'d ' : ''}${h}h ${m}m ${s}s`;\n})() }}",
                "type": "string"
              },
              {
                "id": "7ef3dd87-630e-4251-ba99-7a5bef536c15",
                "name": "theardID",
                "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.theardID, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.theardID, \"\")\n  ) \n}}",
                "type": "string"
              },
              {
                "id": "b3c4684d-ed45-4aa5-9164-a16905b38a4a",
                "name": "type",
                "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.type, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.type, \"\")\n  ) \n}}",
                "type": "number"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -752,
          896
        ],
        "id": "1ba290d2-e60a-47f7-abcb-514cba4571d2",
        "name": "Edit Fields4"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "3af87cc4-1176-4d0a-9050-c03f834711db",
                "name": "answer",
                "value": "Kh√¥ng t√¨m th·∫•y ID vui l√≤ng ki·ªÉm tra l·∫°i ",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -752,
          1088
        ],
        "id": "cd1c7f35-7e08-4b3b-81b3-70d23be3db42",
        "name": "IF ERROR1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "fdfd4e91-0228-4f47-9696-2af5b0509e4f",
                "leftValue": "={{ $json.ID_Status }}",
                "rightValue": "Done",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              },
              {
                "id": "4bfe94a3-464e-4cf2-892e-3ef33bf47695",
                "leftValue": "={{ $json.Chat_status }}",
                "rightValue": "Done",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -464,
          896
        ],
        "id": "8af9962f-067c-482c-b657-ce9b42218b96",
        "name": "If2"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
            "mode": "list",
            "cachedResultName": "IT HELP DESK",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1979763952,
            "mode": "list",
            "cachedResultName": "ADD NEW SUPPLIER",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=1979763952"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "PIC": "={{ $json.name }}",
              "STATUS": "={{ $json.Chat_status }}",
              "FINISH TIME": "={{ $json[\"Finish time\"] }}",
              "SUPPLIER_ID": "={{ $json.ID }}"
            },
            "matchingColumns": [
              "SUPPLIER_ID"
            ],
            "schema": [
              {
                "id": "STATUS",
                "displayName": "STATUS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "USER NAME",
                "displayName": "USER NAME",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "TEAM",
                "displayName": "TEAM",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "C√îNG TY THU·ªòC CATALOG TYPE G√å:",
                "displayName": "C√îNG TY THU·ªòC CATALOG TYPE G√å:",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "C√îNG TY L√Ä TRONG N∆Ø·ªöC HAY N∆Ø·ªöC NGO√ÄI",
                "displayName": "C√îNG TY L√Ä TRONG N∆Ø·ªöC HAY N∆Ø·ªöC NGO√ÄI",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "T√äN C√îNG TY",
                "displayName": "T√äN C√îNG TY",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "T√äN VI·∫æT T·∫ÆT",
                "displayName": "T√äN VI·∫æT T·∫ÆT",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "ƒê·ªäA CH·ªà",
                "displayName": "ƒê·ªäA CH·ªà",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "NG∆Ø·ªúI LI√äN L·∫†C",
                "displayName": "NG∆Ø·ªúI LI√äN L·∫†C",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "EMAIL",
                "displayName": "EMAIL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "CURRENCY",
                "displayName": "CURRENCY",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "M√É S·ªê THU·∫æ C√îNG TY",
                "displayName": "M√É S·ªê THU·∫æ C√îNG TY",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "TH√äM L·ªúI NH·∫ÆN NH·ª¶ V·ªöI ADMIN",
                "displayName": "TH√äM L·ªúI NH·∫ÆN NH·ª¶ V·ªöI ADMIN",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "SUPPLIER_ID",
                "displayName": "SUPPLIER_ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "PIC",
                "displayName": "PIC",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "FINISH TIME",
                "displayName": "FINISH TIME",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "TYPE",
                "displayName": "TYPE",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          -240,
          800
        ],
        "id": "4aedffda-aa9e-4c45-afde-312eaeddcca1",
        "name": "Update row in sheet1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "X1UBt5tMcyjhPYqy",
            "name": "Google Sheets account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
                "name": "answer",
                "value": "={{ $json.SUPPLIER_ID }} ƒë√£ ho√†n th√†nh b·ªüi {{ $json.PIC }} m·∫•t {{ $('If2').item.json['Process time'] }} ƒë·ªÉ ho√†n th√†nh",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -16,
          800
        ],
        "id": "0e246bfb-f4a0-46d7-abbc-0a80a64d2b6e",
        "name": "Edit Fields5"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "629ade4b-1cdd-489d-94a4-0dfe3acdf064",
                "leftValue": "={{ $json.SUPPLIER_ID }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1040,
          992
        ],
        "id": "6cf8a8ae-c415-4aab-968c-7dd3b14ae518",
        "name": "If3"
      },
      {
        "parameters": {
          "jsCode": "// L·∫•y n·ªôi dung tin nh·∫Øn v√† uid ng∆∞·ªùi g·ª≠i\nconst message = $json.data?.content || '';\nconst quoteMsg = $json.data?.quote?.msg || '';\nconst uidFrom = $json.data?.uidFrom || '';\n\n// T√°ch t·ª´ ƒë·ªÉ l·∫•y status cu·ªëi c√¢u\nconst parts = message.trim().split(/\\s+/);\n\n// ‚úÖ B·∫Øt ƒë√∫ng chu·ªói ID-**** ho·∫∑c SUP-**** trong quoteMsg\nconst codeMatch = quoteMsg.match(/\\b(?:ID|SUP)-[A-Za-z0-9_-]+\\b/i);\nconst ID = codeMatch ? codeMatch[0].toUpperCase() : 'unknown';\n\n// Chu·∫©n ho√° token: b·ªè d·∫•u c√¢u cu·ªëi, lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi\nconst tokens = parts\n  .map(p => p\n    .replace(/[.,;:!?]+$/g, '')\n    .replace(/^[^A-Za-z√Ä-·ªπ0-9_-]+|[^A-Za-z√Ä-·ªπ0-9_-]+$/gi, '')\n  )\n  .filter(Boolean);\n\n// ‚úÖ X√°c ƒë·ªãnh status\nconst doneSynonyms = ['done', 'xong'];\nlet status = 'unknown';\n\n// 1) N·∫øu message c√≥ \"done/xong\" ·ªü b·∫•t k·ª≥ ƒë√¢u -> Done\nif (/\\b(done|xong)\\b/i.test(message)) {\n  status = 'Done';\n} else {\n  // 2) Ng∆∞·ª£c l·∫°i: l·∫•y t·ª´ ‚Äúc√≥ nghƒ©a‚Äù cu·ªëi c√πng, b·ªè qua yes/no\n  for (let i = tokens.length - 1; i >= 0; i--) {\n    const t = tokens[i];\n    const lower = t.toLowerCase();\n    if (lower === 'yes' || lower === 'no') continue;\n    status = doneSynonyms.includes(lower)\n      ? 'Done'\n      : (t ? t.charAt(0).toUpperCase() + t.slice(1) : 'unknown');\n    break;\n  }\n}\n\nconst theardID = $json.threadId;   // gi·ªØ nguy√™n t√™n bi·∫øn nh∆∞ b·∫°n ƒëang d√πng\nconst type = $json.type;\n\n// Danh s√°ch t√™n cho ph√©p\nconst allowedNames = [\"T√πng\", \"Xu√¢n\", \"Ph∆∞∆°ng\"];\n\n// üîé T√¨m t√™n trong message (lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi t·ª´ tr∆∞·ªõc khi so)\nlet nameFromMessage = null;\nfor (const w of parts) {\n  const word = w.replace(/^[^A-Za-z√Ä-·ªπ]+|[^A-Za-z√Ä-·ªπ]+$/gi, '');\n  if (allowedNames.includes(word)) {\n    nameFromMessage = word;\n    break;\n  }\n}\n\n// Map uidFrom ‚Üí name (fallback)\nconst nameMap = {\n  \"9150902062671965622\": \"T√πng\",\n  \"2091898082743203663\": \"Xu√¢n\",\n  \"3266757489410168093\": \"Ph∆∞∆°ng\"\n};\n\nconst name = nameFromMessage || nameMap[uidFrom] || 'unknown';\n\n// ‚úÖ Ki·ªÉm tra xem message c√≥ ch·ª©a \"yes\" (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)\nconst repeated = /\\byes\\b/i.test(message) ? 'YES' : 'NO';\n\n// Tr·∫£ k·∫øt qu·∫£\nreturn [\n  {\n    json: {\n      ID,\n      status,\n      name,\n      theardID,\n      type,\n      repeated\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1776,
          800
        ],
        "id": "c74624e7-8cca-42f1-9c49-6ba262f545d6",
        "name": "Code4"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ /ID-\\d+/i.test($json.ID) }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "id": "4bc80561-71d6-441e-8c58-c33a97040b9d"
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "be4b73e3-f789-4fda-896d-696a686aa646",
                      "leftValue": "={{ /SUP-\\d+/i.test($json.ID) }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                }
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          -1488,
          800
        ],
        "id": "2a03d27e-55b5-4c45-b993-d4e74a5f215e",
        "name": "Switch4"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "QwutgY3r91Gkgsf0",
            "mode": "list",
            "cachedResultUrl": "/workflow/QwutgY3r91Gkgsf0",
            "cachedResultName": "Vozer Crawl Processor"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {}
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          -1776,
          2016
        ],
        "id": "6984c367-6f24-43ec-af56-700fded99869",
        "name": "Call 'Vozer Processor'"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "NlBCS3ymvM7cb54Z",
            "mode": "list",
            "cachedResultUrl": "/workflow/NlBCS3ymvM7cb54Z",
            "cachedResultName": "Update Crawl"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {}
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          -2064,
          2016
        ],
        "id": "b7d36750-a0ac-4bc7-be9f-be4f7adc388f",
        "name": "Call 'Update Crawl'"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "a58944ac-4d94-4ce7-89b7-a6feac1edd84",
                "leftValue": "={{ $json.data.content.title }}",
                "rightValue": "scan",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -2288,
          2416
        ],
        "id": "a2f8a2b0-da82-47a8-a2e9-43804fe5e6d4",
        "name": "If4"
      },
      {
        "parameters": {
          "inputSource": "passthrough"
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -3168,
          1888
        ],
        "id": "0dd34f92-d9ca-4d71-91b3-1a8701f2c70a",
        "name": "When Executed by Another Workflow"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
                "name": "answer",
                "value": "T1/2026:   Ngh·ªâ 1,3,17,31         | L√†m 10,24 \nT2/2026:   Ngh·ªâ 14‚Äì22            | L√†m 7,28 \nT3/2026:   Ngh·ªâ 7,21                | L√†m 14,28 \nT4/2026:   Ngh·ªâ 4,18,25,30     | L√†m 11 \nT5/2026:   Ngh·ªâ 1,2,16,30        | L√†m 9,23 \nT6/2026:   Ngh·ªâ 13,27              | L√†m 6,20 \nT7/2026:   Ngh·ªâ 4,18                | L√†m 11,25 \nT8/2026:   Ngh·ªâ 1,15,29           | L√†m 8,22 \nT9/2026:   Ngh·ªâ 1,2,5,19          | L√†m 12,26 \nT10/2026:  Ngh·ªâ 3,17,31          | L√†m 10,24 \nT11/2026:  Ngh·ªâ 14,28             | L√†m 7,21 \nT12/2026:  Ngh·ªâ 12,26            | L√†m 5,19",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2064,
          2208
        ],
        "id": "47b19300-cbda-451a-ad3c-76c8d02abe0b",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
                "name": "answer",
                "value": "ƒê√£ ho√†n th√†nh update Crawl",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1488,
          2016
        ],
        "id": "c34f90b7-d97c-4461-b860-cf78b2a2e1bb",
        "name": "Edit Fields6"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
                "name": "answer",
                "value": "=Link download c·ªßa b·∫°n ƒë√¢y:  {{ $json.directUrl }}",
                "type": "string"
              },
              {
                "id": "3eef36c4-bb53-4e07-9136-936b7b8e7b78",
                "name": "file",
                "value": "={{ $json.filePath }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1776,
          1824
        ],
        "id": "ada32210-01e2-479e-af58-555ca4bb72f6",
        "name": "Edit Fields7"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
                "name": "answer",
                "value": "=Type: {{ $json.type }} \nID: {{ $json.threadId }} ",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2064,
          1232
        ],
        "id": "0011e68b-e706-4e24-9c3c-0239968448c0",
        "name": "Edit Fields8"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
                "name": "answer",
                "value": "={{ $json.ID }} ƒë√£ ƒë∆∞·ª£c ho√†n th√†nh r·ªìi, vui l√≤ng ki·ªÉm tra l·∫°i. ",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -240,
          608
        ],
        "id": "5e53654f-c4e5-4b87-8fed-fb5082b3b665",
        "name": "Edit Fields10"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a7324b17-f641-4662-aa4d-f80a5a4b246b",
                "name": "answer",
                "value": "={{ $json.output }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1488,
          80
        ],
        "id": "7ac1107f-5dff-439d-ba04-6a37d86663aa",
        "name": "Edit Fields11"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
                "name": "answer",
                "value": "={{ $json.answer }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1264,
          -416
        ],
        "id": "c8a13c6b-5e89-45c9-a19b-37205acafb5a",
        "name": "Edit Fields12"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
                "name": "answer",
                "value": "={{ $json.answer }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1040,
          -224
        ],
        "id": "181b19cd-53a6-41f4-b9a8-1e235e42f528",
        "name": "Edit Fields13"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
                "name": "answer",
                "value": "={{ $json.ID }} ƒë√£ ƒë∆∞·ª£c ho√†n th√†nh r·ªìi, vui l√≤ng ki·ªÉm tra l·∫°i. ",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -240,
          992
        ],
        "id": "604b4f7d-f73d-4d4b-915b-97d8fefad544",
        "name": "Edit Fields14"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "5rxurDTMhaZRxA0U",
            "mode": "list",
            "cachedResultUrl": "/workflow/5rxurDTMhaZRxA0U",
            "cachedResultName": "OFFCODE"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {
            "waitForSubWorkflow": true
          }
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          -1264,
          368
        ],
        "id": "6e3c9f64-8632-4e7a-84a6-8e8dffc465c3",
        "name": "Call 'OFFCODE'"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
                "name": "=url",
                "value": "={{\n  (\n    (\n      // 1) Link trong content\n      (($json.data.content || '').match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 2) Link trong quote.msg\n      ((($json.data.quote && $json.data.quote.msg) ? $json.data.quote.msg : '')\n        .match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 3) Link trong attach (JSON string)\n      ((String($json.data.attach || '').match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n      ||\n      // 4) Link trong quote.attach (JSON string)\n      ((String(($json.data.quote && $json.data.quote.attach) || '')\n        .match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n    ) || ''\n  )\n  // clean: b·ªè \\ ·ªü cu·ªëi + b·ªè d·∫•u \" n·∫øu d√≠nh\n  .replace(/[\\\\\"]+$/g, '')\n}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1776,
          1344
        ],
        "id": "a7fd0731-8b58-4efc-97c1-3faa52dbf71a",
        "name": "Edit Fields9"
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -1488,
          1344
        ],
        "id": "64a90c26-9927-4f1b-b0ec-c0fc9410624b",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "options": {
            "language": "vie"
          }
        },
        "type": "n8n-nodes-tesseractjs.tesseractNode",
        "typeVersion": 1,
        "position": [
          -1264,
          1344
        ],
        "id": "091d805c-c66b-48f7-9e13-1f41efa78569",
        "name": "Tesseract"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
                "name": "answer",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1040,
          1344
        ],
        "id": "773b00b9-6072-4b7c-a8a2-d42872ddb5ff",
        "name": "Edit Fields15"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "e8346446-c8cc-41bb-8bb2-fc11ebd77d6e",
                "leftValue": "={{ $json.data.content.toLowerCase().includes(\"scanvn\") }}",
                "rightValue": "=",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -2064,
          1440
        ],
        "id": "a412deb0-acc0-468a-96a7-009c2298efcc",
        "name": "If5"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
                "name": "=url",
                "value": "={{\n  (\n    (\n      // 1) Link trong content\n      (($json.data.content || '').match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 2) Link trong quote.msg\n      ((($json.data.quote && $json.data.quote.msg) ? $json.data.quote.msg : '')\n        .match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 3) Link trong attach (JSON string)\n      ((String($json.data.attach || '').match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n      ||\n      // 4) Link trong quote.attach (JSON string)\n      ((String(($json.data.quote && $json.data.quote.attach) || '')\n        .match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n    ) || ''\n  )\n  // clean: b·ªè \\ ·ªü cu·ªëi + b·ªè d·∫•u \" n·∫øu d√≠nh\n  .replace(/[\\\\\"]+$/g, '')\n}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1776,
          1536
        ],
        "id": "7808b853-585d-4dfb-b3d7-b9b59e23c1c6",
        "name": "Edit Fields16"
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -1488,
          1536
        ],
        "id": "d326f69e-7f92-47cd-8e9d-c3862e5a3781",
        "name": "HTTP Request1"
      },
      {
        "parameters": {
          "options": {
            "language": "eng"
          }
        },
        "type": "n8n-nodes-tesseractjs.tesseractNode",
        "typeVersion": 1,
        "position": [
          -1264,
          1536
        ],
        "id": "73aae71c-00f4-4c94-854f-1ef7c3ecbc7f",
        "name": "Tesseract1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
                "name": "answer",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1040,
          1536
        ],
        "id": "24dab391-96fa-4980-b07c-59a15f7629da",
        "name": "Edit Fields17"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.answer }}",
          "options": {
            "systemMessage": "B·∫°n l√† AI agent hi·ªáu ƒë√≠nh OCR (Tesseract). Nhi·ªám v·ª•: nh·∫≠n raw OCR text v√† xu·∫•t ra vƒÉn b·∫£n ƒë√£ ƒë∆∞·ª£c s·ª≠a chu·∫©n.\n\nM·ª•c ti√™u\n\nS·ª≠a l·ªói ch√≠nh t·∫£ ti·∫øng vi·ªát ho·∫∑c ti·∫øng anh, d·∫•u ti·∫øng Vi·ªát, l·ªói g√µ, k√Ω t·ª± r√°c, nh·∫ßm l·∫´n OCR (O/0, I/1, l/|, S/5‚Ä¶).\n\nChu·∫©n h√≥a kho·∫£ng tr·∫Øng, xu·ªëng d√≤ng, d·∫•u c√¢u, vi·∫øt hoa/vi·∫øt th∆∞·ªùng.\n\nKh√¥i ph·ª•c c·∫•u tr√∫c h·ª£p l√Ω: ti√™u ƒë·ªÅ, ƒëo·∫°n, g·∫°ch ƒë·∫ßu d√≤ng, b·∫£ng ƒë∆°n gi·∫£n n·∫øu nh·∫≠n di·ªán ƒë∆∞·ª£c.\n\nGi·ªØ nguy√™n √Ω nghƒ©a v√† ng√¥n ng·ªØ g·ªëc (∆∞u ti√™n ti·∫øng Vi·ªát n·∫øu vƒÉn b·∫£n ch·ªß y·∫øu l√† ti·∫øng Vi·ªát).\n\nNguy√™n t·∫Øc b·∫Øt bu·ªôc\n\nKh√¥ng b·ªãa n·ªôi dung. Ch·ªâ suy lu·∫≠n s·ª≠a khi c√≥ c∆° s·ªü r√µ r√†ng t·ª´ ng·ªØ c·∫£nh.\n\nKh√¥ng thay ƒë·ªïi d·ªØ li·ªáu quan tr·ªçng: s·ªë ti·ªÅn, m√£ ƒë∆°n, s·ªë seri, s·ªë ƒëi·ªán tho·∫°i, email, URL, ng√†y th√°ng, ƒë·ªãa ch·ªâ‚Ä¶\n\nN·∫øu OCR c√≥ v·∫ª sai nh∆∞ng kh√¥ng ch·∫Øc, gi·ªØ nguy√™n v√† ƒë√°nh d·∫•u b·∫±ng (?).\n\nGi·ªØ ƒë·ªãnh d·∫°ng th√¥ng tin:\n\nD√≤ng n√†o l√† ‚ÄúNh√£n: Gi√° tr·ªã‚Äù th√¨ gi·ªØ d·∫°ng ƒë√≥.\n\nDanh s√°ch gi·ªØ bullet/ƒë√°nh s·ªë.\n\n∆Øu ti√™n s·ª≠a theo ng·ªØ c·∫£nh:\n\nT√™n ri√™ng/doanh nghi·ªáp: ch·ªâ s·ª≠a khi ch·∫Øc ch·∫Øn.\n\nThu·∫≠t ng·ªØ k·ªπ thu·∫≠t: gi·ªØ nguy√™n n·∫øu h·ª£p l√Ω.\n\nKh√¥ng gi·∫£i th√≠ch d√†i trong output. Ch·ªâ xu·∫•t ph·∫ßn vƒÉn b·∫£n ƒë√£ s·ª≠a.\n\nChu·∫©n h√≥a ƒë·∫ßu ra\n\nXu·∫•t duy nh·∫•t theo format:\n\nOUTPUT:\n<clean_text>\n\nKh√¥ng th√™m nh·∫≠n x√©t, kh√¥ng th√™m ti√™u ƒë·ªÅ kh√°c, kh√¥ng k√®m markdown code block (tr·ª´ khi vƒÉn b·∫£n g·ªëc l√† code).\n\nQuy t·∫Øc s·ª≠a ph·ªï bi·∫øn (g·ª£i √Ω)\n\nLo·∫°i b·ªè k√Ω t·ª± r√°c l·∫∑p: ~, ‚Ä¢ sai ch·ªó, | d∆∞, ‚Äú.. ..‚Äù, kho·∫£ng tr·∫Øng k√©p.\n\nGh√©p t·ª´ b·ªã t√°ch sai: ‚Äúc ·ªông‚Äù ‚Üí ‚Äúc·ªông‚Äù, ‚Äúth a nh‚Äù ‚Üí ‚Äúthanh‚Äù (khi ch·∫Øc).\n\nS·ª≠a nh·∫ßm d·∫•u: ‚ÄúHo a‚Äù ‚Üí ‚ÄúH√≤a‚Äù, ‚Äúngay‚Äù ‚Üí ‚Äúng√†y‚Äù theo ng·ªØ c·∫£nh.\n\nChu·∫©n h√≥a s·ªë: ‚Äú1 ,000‚Äù ‚Üí ‚Äú1,000‚Äù ho·∫∑c ‚Äú1.000‚Äù theo ng·ªØ c·∫£nh t√†i li·ªáu (gi·ªØ nh·∫•t qu√°n).\n\nNg√†y: ∆∞u ti√™n dd/mm/yyyy n·∫øu vƒÉn b·∫£n Vi·ªát (khi ch·∫Øc).\n\nX·ª≠ l√Ω tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát\n\nN·∫øu input r·ªóng/kh√¥ng ƒë·ªçc ƒë∆∞·ª£c: xu·∫•t OUTPUT: v√† ƒë·ªÉ tr·ªëng.\n\nN·∫øu c√≥ nhi·ªÅu ph·∫ßn ng√¥n ng·ªØ: gi·ªØ nguy√™n t·ª´ng ph·∫ßn, ch·ªâ s·ª≠a l·ªói OCR.\n\nB·∫Øt ƒë·∫ßu ngay khi nh·∫≠n ƒë∆∞·ª£c vƒÉn b·∫£n OCR."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -816,
          1440
        ],
        "id": "96a983fb-b52d-49c9-b6e5-16cd67012f54",
        "name": "AI Agent1"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -752,
          1664
        ],
        "id": "4e3a202c-c897-4e24-ab42-a0cd32d87ad9",
        "name": "Google Gemini Chat Model",
        "credentials": {
          "googlePalmApi": {
            "id": "cJX4QyuPXhS6ep58",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a7324b17-f641-4662-aa4d-f80a5a4b246b",
                "name": "answer",
                "value": "={{ $json.output }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -464,
          1440
        ],
        "id": "293f9e4a-110c-42c1-a7b9-295433aa4ca0",
        "name": "Edit Fields18"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
                "name": "=url",
                "value": "={{ $json.data.content.href }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1776,
          2320
        ],
        "id": "760fa5de-fcbb-4a27-a4f7-196b7c290e46",
        "name": "Edit Fields19"
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -1488,
          2320
        ],
        "id": "8e3ff1fa-b36e-417b-b1ed-320c2669313d",
        "name": "HTTP Request2"
      },
      {
        "parameters": {
          "options": {
            "language": "vie"
          }
        },
        "type": "n8n-nodes-tesseractjs.tesseractNode",
        "typeVersion": 1,
        "position": [
          -1264,
          2320
        ],
        "id": "1adfd7ef-0847-4a7c-9a7d-7e7186ff40c5",
        "name": "Tesseract2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
                "name": "answer",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1040,
          2320
        ],
        "id": "a76a642a-6a46-4e61-bd9a-10e7da58421b",
        "name": "Edit Fields20"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
                "name": "=url",
                "value": "={{ $json.data.content.href }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1776,
          2512
        ],
        "id": "aad6857b-04c8-4771-aac2-9fe0fb325c03",
        "name": "Edit Fields21"
      },
      {
        "parameters": {
          "url": "={{ $json.url }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -1488,
          2512
        ],
        "id": "d64fa6af-7724-4adf-915c-7eaacc9d0df8",
        "name": "HTTP Request3"
      },
      {
        "parameters": {
          "options": {
            "language": "eng"
          }
        },
        "type": "n8n-nodes-tesseractjs.tesseractNode",
        "typeVersion": 1,
        "position": [
          -1264,
          2512
        ],
        "id": "a613bd90-5426-4aaf-bdee-170d0aad4e2d",
        "name": "Tesseract3"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
                "name": "answer",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1040,
          2512
        ],
        "id": "4c7ddefc-c6f7-4657-ba57-bdba2740e4f9",
        "name": "Edit Fields22"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.answer }}",
          "options": {
            "systemMessage": "B·∫°n l√† AI agent hi·ªáu ƒë√≠nh OCR (Tesseract). Nhi·ªám v·ª•: nh·∫≠n raw OCR text v√† xu·∫•t ra vƒÉn b·∫£n ƒë√£ ƒë∆∞·ª£c s·ª≠a chu·∫©n.\n\nM·ª•c ti√™u\n\nS·ª≠a l·ªói ch√≠nh t·∫£ ti·∫øng vi·ªát ho·∫∑c ti·∫øng anh, d·∫•u ti·∫øng Vi·ªát, l·ªói g√µ, k√Ω t·ª± r√°c, nh·∫ßm l·∫´n OCR (O/0, I/1, l/|, S/5‚Ä¶).\n\nChu·∫©n h√≥a kho·∫£ng tr·∫Øng, xu·ªëng d√≤ng, d·∫•u c√¢u, vi·∫øt hoa/vi·∫øt th∆∞·ªùng.\n\nKh√¥i ph·ª•c c·∫•u tr√∫c h·ª£p l√Ω: ti√™u ƒë·ªÅ, ƒëo·∫°n, g·∫°ch ƒë·∫ßu d√≤ng, b·∫£ng ƒë∆°n gi·∫£n n·∫øu nh·∫≠n di·ªán ƒë∆∞·ª£c.\n\nGi·ªØ nguy√™n √Ω nghƒ©a v√† ng√¥n ng·ªØ g·ªëc (∆∞u ti√™n ti·∫øng Vi·ªát n·∫øu vƒÉn b·∫£n ch·ªß y·∫øu l√† ti·∫øng Vi·ªát).\n\nNguy√™n t·∫Øc b·∫Øt bu·ªôc\n\nKh√¥ng b·ªãa n·ªôi dung. Ch·ªâ suy lu·∫≠n s·ª≠a khi c√≥ c∆° s·ªü r√µ r√†ng t·ª´ ng·ªØ c·∫£nh.\n\nKh√¥ng thay ƒë·ªïi d·ªØ li·ªáu quan tr·ªçng: s·ªë ti·ªÅn, m√£ ƒë∆°n, s·ªë seri, s·ªë ƒëi·ªán tho·∫°i, email, URL, ng√†y th√°ng, ƒë·ªãa ch·ªâ‚Ä¶\n\nN·∫øu OCR c√≥ v·∫ª sai nh∆∞ng kh√¥ng ch·∫Øc, gi·ªØ nguy√™n v√† ƒë√°nh d·∫•u b·∫±ng (?).\n\nGi·ªØ ƒë·ªãnh d·∫°ng th√¥ng tin:\n\nD√≤ng n√†o l√† ‚ÄúNh√£n: Gi√° tr·ªã‚Äù th√¨ gi·ªØ d·∫°ng ƒë√≥.\n\nDanh s√°ch gi·ªØ bullet/ƒë√°nh s·ªë.\n\n∆Øu ti√™n s·ª≠a theo ng·ªØ c·∫£nh:\n\nT√™n ri√™ng/doanh nghi·ªáp: ch·ªâ s·ª≠a khi ch·∫Øc ch·∫Øn.\n\nThu·∫≠t ng·ªØ k·ªπ thu·∫≠t: gi·ªØ nguy√™n n·∫øu h·ª£p l√Ω.\n\nKh√¥ng gi·∫£i th√≠ch d√†i trong output. Ch·ªâ xu·∫•t ph·∫ßn vƒÉn b·∫£n ƒë√£ s·ª≠a.\n\nChu·∫©n h√≥a ƒë·∫ßu ra\n\nXu·∫•t duy nh·∫•t theo format:\n\nOUTPUT:\n<clean_text>\n\nKh√¥ng th√™m nh·∫≠n x√©t, kh√¥ng th√™m ti√™u ƒë·ªÅ kh√°c, kh√¥ng k√®m markdown code block (tr·ª´ khi vƒÉn b·∫£n g·ªëc l√† code).\n\nQuy t·∫Øc s·ª≠a ph·ªï bi·∫øn (g·ª£i √Ω)\n\nLo·∫°i b·ªè k√Ω t·ª± r√°c l·∫∑p: ~, ‚Ä¢ sai ch·ªó, | d∆∞, ‚Äú.. ..‚Äù, kho·∫£ng tr·∫Øng k√©p.\n\nGh√©p t·ª´ b·ªã t√°ch sai: ‚Äúc ·ªông‚Äù ‚Üí ‚Äúc·ªông‚Äù, ‚Äúth a nh‚Äù ‚Üí ‚Äúthanh‚Äù (khi ch·∫Øc).\n\nS·ª≠a nh·∫ßm d·∫•u: ‚ÄúHo a‚Äù ‚Üí ‚ÄúH√≤a‚Äù, ‚Äúngay‚Äù ‚Üí ‚Äúng√†y‚Äù theo ng·ªØ c·∫£nh.\n\nChu·∫©n h√≥a s·ªë: ‚Äú1 ,000‚Äù ‚Üí ‚Äú1,000‚Äù ho·∫∑c ‚Äú1.000‚Äù theo ng·ªØ c·∫£nh t√†i li·ªáu (gi·ªØ nh·∫•t qu√°n).\n\nNg√†y: ∆∞u ti√™n dd/mm/yyyy n·∫øu vƒÉn b·∫£n Vi·ªát (khi ch·∫Øc).\n\nX·ª≠ l√Ω tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát\n\nN·∫øu input r·ªóng/kh√¥ng ƒë·ªçc ƒë∆∞·ª£c: xu·∫•t OUTPUT: v√† ƒë·ªÉ tr·ªëng.\n\nN·∫øu c√≥ nhi·ªÅu ph·∫ßn ng√¥n ng·ªØ: gi·ªØ nguy√™n t·ª´ng ph·∫ßn, ch·ªâ s·ª≠a l·ªói OCR.\n\nB·∫Øt ƒë·∫ßu ngay khi nh·∫≠n ƒë∆∞·ª£c vƒÉn b·∫£n OCR."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -816,
          2416
        ],
        "id": "17828381-b146-4b00-bd91-6bda5de5a5c1",
        "name": "AI Agent2"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -752,
          2640
        ],
        "id": "da5af1b5-55f8-40be-a780-3f6a0672ea9f",
        "name": "Google Gemini Chat Model2",
        "credentials": {
          "googlePalmApi": {
            "id": "cJX4QyuPXhS6ep58",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a7324b17-f641-4662-aa4d-f80a5a4b246b",
                "name": "answer",
                "value": "={{ $json.output }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -464,
          2416
        ],
        "id": "f8d5715a-cfb3-4879-97fc-840e37b3de9e",
        "name": "Edit Fields23"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "e8346446-c8cc-41bb-8bb2-fc11ebd77d6e",
                "leftValue": "={{ $json.data.content.title.toLowerCase().includes(\"scanvn\") }}",
                "rightValue": "=",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -2064,
          2416
        ],
        "id": "828f6213-efa0-4959-8373-3ac9c81028f9",
        "name": "If6"
      },
      {
        "parameters": {
          "threadId": "={{ $json.threadId }}",
          "message": "={{ $json.answer }}",
          "threadType": "={{ $json.type }}"
        },
        "type": "n8n-nodes-social-zalo.zaloUserInteract",
        "typeVersion": 1,
        "position": [
          -1776,
          368
        ],
        "id": "f4294eae-c6e3-491e-9ba3-e1bddc187a4a",
        "name": "G·ª≠i tin nh·∫Øn12",
        "credentials": {
          "zaloUserCredentialsApi": {
            "id": "OMssdW79ELA0RV06",
            "name": "Zalo It Bot - 2025-12-06T08:34:23.063Z"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a819387a-1a06-47a5-b95c-a2056acb51d7",
                "name": "threadId",
                "value": "={{ $('Code in JavaScript1').item.json.threadId }}",
                "type": "string"
              },
              {
                "id": "b94005b5-9b48-447d-b704-a8d6baa8bae1",
                "name": "type",
                "value": "={{ $('Code in JavaScript1').item.json.type }}",
                "type": "string"
              },
              {
                "id": "75b73abb-24dc-44a1-9b97-0575544e6b0e",
                "name": "data",
                "value": "={{ $('Code in JavaScript1').item.json.data }}",
                "type": "object"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1488,
          368
        ],
        "id": "1ea7488d-a875-442c-bc2f-8820b121576c",
        "name": "Edit Fields24"
      },
      {
        "parameters": {
          "jsCode": "const threadId = $input.first().json.threadId\nconst type = $input.first().json.type\nconst data = $input.first().json.data\nconst answers = [\n  \"Em nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu r·ªìi ·∫°, anh/ch·ªã ch·ªù em x√≠u nha, ch√∫c anh/ch·ªã m·ªôt ng√†y r·ª±c r·ª° üòÑ\",\n  \"Bot nh·∫≠n r·ªìi n√®, anh/ch·ªã ƒë·ª£i bot ch√∫t nha, s·∫Øp xong li·ªÅn ‚ú®\",\n  \"Bot ƒë√£ ghi nh·∫≠n, anh/ch·ªã ƒë·ª£i ch√∫t x√≠u nha, ƒë·ªãnh l√†m l·∫π m√† tay h∆°i run ü§ñ\",\n  \"Bot ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù bot v√†i gi√¢y nha, ch·ªù x√≠u c√≥ qu√† üòÑ\",\n  \"Em nh·∫≠n request nha anh/ch·ªã, ƒë·ª£i em t√≠, ch√∫c anh/ch·ªã m·ªôt ng√†y chill nh·∫π üòå\",\n  \"Bot nh·∫≠n ƒë·ªß r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang ch·∫°y h·∫øt t·ªëc l·ª±c ‚ö°\",\n  \"Em nh·∫≠n r·ªìi ƒë√≥ anh/ch·ªã, ch·ªù em ch√∫t nha, ch√∫c anh/ch·ªã vui nh∆∞ t·∫øt üéâ\",\n  \"Bot x·ª≠ l√Ω ngay ƒë√¢y, anh/ch·ªã ch·ªù x√≠u nha, bot h·ª©a kh√¥ng ‚Äúlag‚Äù ƒë√¢u üòÅ\",\n  \"Em ƒë√£ nh·∫≠n y√™u c·∫ßu, anh/ch·ªã ƒë·ª£i em ch√∫t nh√©, ch√∫c anh/ch·ªã c∆∞·ªùi su·ªët c·∫£ ng√†y üòÑ\",\n  \"Bot nh·∫≠n d·ªØ li·ªáu r·ªìi, anh/ch·ªã ƒë·ª£i bot t√≠ th√¥i ‚è±Ô∏è\",\n  \"Em ti·∫øp nh·∫≠n ok r·ªìi, anh/ch·ªã ch·ªù em m·ªôt l√°t nha, ch√∫c anh/ch·ªã d·ªÖ ch·ªãu c·∫£ ng√†y üåø\",\n  \"Bot ƒë√£ nh·∫≠n l·ªánh, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang kh·ªüi ƒë·ªông n√£o ü§ñ\",\n  \"Em nh·∫≠n th√¥ng tin r·ªìi ·∫°, ƒë·ª£i em x√≠u nha, ch√∫c anh/ch·ªã l√†m vi·ªác hƒÉng say üî•\",\n  \"Em ƒë√£ ghi nh·∫≠n xong, anh/ch·ªã ch·ªù em ch√∫t, ch√∫c anh/ch·ªã h√¥m nay ƒë·∫πp l·∫° th∆∞·ªùng ‚ú®\",\n  \"Bot nh·∫≠n ƒë∆∞·ª£c r·ªìi, anh/ch·ªã ƒë·ª£i t√≠ nha, bot g·ª≠i anh/ch·ªã ch√∫t nƒÉng l∆∞·ª£ng t√≠ch c·ª±c ‚òÄÔ∏è\",\n  \"Bot nh·∫≠n task r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang qu·∫©y cho k·ªãp deadline üòé\",\n  \"Em ƒë√£ nh·∫≠n r·ªìi ·∫°, anh/ch·ªã ch·ªù em t√≠ nh√©, mong anh/ch·ªã l√∫c n√†o c≈©ng vui t∆∞∆°i üå∑\",\n  \"Bot nh·∫≠n l·ªánh ngon l√†nh r·ªìi, anh/ch·ªã ƒë·ª£i bot ch√∫t nha, bot c·∫£m ∆°n anh/ch·ªã nhi·ªÅu n√® üòÑ\",\n  \"Bot v·ª´a ti·∫øp nh·∫≠n xong, anh/ch·ªã ch·ªù x√≠u nha, bot g·ª≠i c√°i √¥m ·∫£o ü§ó\",\n  \"Em nh·∫≠n request r·ªìi ƒë√≥, ƒë·ª£i em nh√©, ch√∫c anh/ch·ªã nh·∫π nh√†ng c·∫£ ng√†y ‚òÅÔ∏è\",\n  \"Bot ƒë√£ ghi nh·∫≠n r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t, bot ch√∫c anh/ch·ªã lu√¥n kh·ªèe m·∫°nh üí™\",\n  \"Bot ti·∫øp nh·∫≠n ngay v√† lu√¥n, anh/ch·ªã ƒë·ª£i bot t√≠ nha, bot t·∫∑ng n·ª• c∆∞·ªùi mi·ªÖn ph√≠ üòÅ\",\n  \"Bot nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i ch√∫t, bot ƒëang v·∫≠n h√†nh n√£o b·ªô 2.0 ü§ñ\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù em x√≠u nha, ch√∫c anh/ch·ªã b√¨nh y√™n c·∫£ ng√†y üåº\",\n  \"Bot nh·∫≠n ƒë∆∞·ª£c t√≠n hi·ªáu r·ªìi, anh/ch·ªã ƒë·ª£i bot t√≠, bot ƒëang b·∫≠t ch·∫ø ƒë·ªô turbo ‚ö°\",\n  \"Em nh·∫≠n r·ªìi anh/ch·ªã, ch·ªù em ch√∫t, mong anh/ch·ªã h√¥m nay to√†n tin vui üì©\",\n  \"Bot ƒë√£ nh·∫≠n y√™u c·∫ßu, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang kh·ªüi ƒë·ªông ch√¢n th√†nh üòÑ\",\n  \"Bot ƒë√£ x·ª≠ l√Ω b∆∞·ªõc ƒë·∫ßu, anh/ch·ªã ƒë·ª£i bot x√≠u, bot ch√∫c anh/ch·ªã ƒÉn g√¨ c≈©ng ngon üòã\",\n  \"Bot ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù bot nha, bot ƒëang ‚Äúc√†y‚Äù v√¨ anh/ch·ªã ƒë√¢y üí™ü§ñ\",\n  \"Bot nh·∫≠n y√™u c·∫ßu r·ªìi, anh/ch·ªã ch·ªù t√≠ nha, bot ch√∫c anh/ch·ªã ng√†y m·ªõi th·∫≠t chill üåà\",\n  \"Em x·ª≠ l√Ω li·ªÅn ƒë√¢y, anh/ch·ªã ch·ªù em ch√∫t nh√©, ch√∫c anh/ch·ªã lu√¥n h·∫°nh ph√∫c üòÑ\",\n  \"Bot ti·∫øp nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i ch√∫t, bot ƒëang ch·∫°y deadline vui v·∫ª üïí\",\n  \"Em nh·∫≠n r·ªìi ƒë√≥, anh/ch·ªã ch·ªù em t√≠ nha, g·ª≠i anh/ch·ªã ng√†n tia nƒÉng l∆∞·ª£ng t·ªët üåü\",\n  \"Bot nh·∫≠n r·ªìi ·∫°, anh/ch·ªã ch·ªù bot t√≠ nha, bot mong anh/ch·ªã c·∫£ ng√†y h√™n lu√¥n üçÄ\",\n  \"Em ti·∫øp nh·∫≠n xong, anh/ch·ªã ƒë·ª£i em ch√∫t nha, ch√∫c anh/ch·ªã lu√¥n t·ª± tin r·∫°ng ng·ªùi üòé\",\n  \"Bot nh·∫≠n ƒë∆∞·ª£c r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ch√∫c anh/ch·ªã l√∫c n√†o c≈©ng n·ªü n·ª• c∆∞·ªùi üòä\",\n  \"Em nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i x√≠u, em x·ª≠ l√Ω nhanh nh∆∞ m√®o th·∫•y c√° üòº\",\n  \"Y√™u c·∫ßu ƒë√£ v√†o tim em, anh/ch·ªã ch·ªù ch√∫t nha, ƒë·ª´ng r·ªùi ƒëi k·∫ªo em bu·ªìn üò¢\",\n  \"Nh·∫≠n r·ªìi ƒë√≥, anh/ch·ªã ch·ªù em t√≠, em ƒëang b·∫≠t ch·∫ø ƒë·ªô ch·∫°y b·∫±ng ni·ªÅm tin ü§£\",\n  \"Y√™u c·∫ßu v√†o n√£o em r·ªìi, anh/ch·ªã ƒë·ª£i t√≠ nha, n√£o h∆°i y·∫øu n√™n load ch√∫t üòÅ\",\n  \"Em nh·∫≠n r·ªìi, ch·ªù em t√≠ nha, ƒë·ª´ng gi·ª•c k·∫ªo em ch·∫°y‚Ä¶ sai üòÖ\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, ƒë·ª£i em nhen, em ch·∫°y nhanh t·ªõi m·ª©c b√≥ng em c√≤n kh√¥ng theo k·ªãp ü§≠\",\n  \"Y√™u c·∫ßu v√†o b·ª•ng r·ªìi, anh/ch·ªã ch·ªù ch√∫t nha, em ƒëang n·∫•u cho ch√≠n üòã\",\n  \"Th√¥ng tin nh·∫≠n ƒë·ªß r·ªìi, ch·ªù em x√≠u nha, em x·ª≠ l√Ω nhanh nh∆∞ chuy·ªán t√¨nh c·∫£m c·ªßa Gen Z: 0.5s üòÜ\",\n  \"Em nh·∫≠n r·ªìi nha, anh/ch·ªã ch·ªù nh·∫π t√≠, em ƒëang b·∫≠t hack t·ªëc ƒë·ªô üöÄ\",\n  \"Ok v√†o r·ªìi n√®, anh/ch·ªã ch·ªù em t√≠, em l√†m nhanh h∆°n crush seen tin nh·∫Øn üò≠\",\n  \"Nh·∫≠n r·ªìi nghe, ƒë·ª£i em t√≠ nghen, em ƒëang b·∫≠t ch·∫ø ƒë·ªô ‚Äúc√†y nh∆∞ tr√¢u‚Äù üêÉ\",\n  \"Em nh·∫≠n r·ªìi ƒë√≥, anh/ch·ªã ch·ªù ch√∫t nha, em h·ª©a kh√¥ng ƒë·ªÉ anh/ch·ªã ng·ªß qu√™n ƒë√¢u üòÑ\",\n  \"Okela nh·∫≠n lu√¥n, ch·ªù ch√∫t nha, ch√∫c anh/ch·ªã nay kh√¥ng drama g√¨ h·∫øt üòÑ\",\n  \"N·∫Øm b·∫Øt y√™u c·∫ßu r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t xiu nha, ch√∫c h√¥m nay kh√¥ng ‚Äúlag‚Äù t√≠ n√†o üòÅ\",\n  \"R·ªìi em x·ª≠ l√Ω ngay, anh/ch·ªã ƒë·ª£i nh·∫π nha, ch√∫c vibe h√¥m nay c·ªßa anh/ch·ªã si√™u ƒë·ªânh ü™©\",\n  \"Ok v√†o vi·ªác r·ªìi n√®, anh/ch·ªã ƒë·ª£i em t√≠, mong h√¥m nay KPI c·ªßa anh/ch·ªã tƒÉng v√®o v√®o üìà\",\n  \"Th√¥ng tin ƒë√£ ti·∫øp nh·∫≠n, anh/ch·ªã ch·ªù ch√∫t, em ch√∫c anh/ch·ªã n√© ƒë∆∞·ª£c h·∫øt deadline g·∫•p üòÅ\",\n  \"Nh·∫≠n r·ªìi ƒë√≥, ch·ªù em t√≠ nha, hy v·ªçng c√¥ng vi·ªác anh/ch·ªã h√¥m nay kh√¥ng c√≥ drama üòå\",\n  \"Em nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù m·ªôt ch√∫t, ch√∫c anh/ch·ªã l√†m vi·ªác nh·∫π nh√†ng nh∆∞ gi√≥ tho·∫£ng üå¨Ô∏è\",\n  \"Em nh·∫≠n y√™u c·∫ßu, ch·ªù em nha, ch√∫c anh/ch·ªã ƒë∆∞·ª£c s·∫øp khen b·∫•t ng·ªù üòé\",\n  \"Nh·∫≠n xong r·ªìi, anh/ch·ªã ƒë·ª£i em t√≠ nha, mong anh/ch·ªã kh√¥ng ph·∫£i OT h√¥m nay üôè\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, ch·ªù em t√≠, ch√∫c c√¥ng vi·ªác c·ª© th·∫ø m√† thƒÉng hoa üìà\",\n  \"Ok em nh·∫≠n, anh/ch·ªã ƒë·ª£i t√≠, ch√∫c ng√†y l√†m vi·ªác to√†n nh·ªØng ng∆∞·ªùi d·ªÖ th∆∞∆°ng üòá\",\n  \"Nh·∫≠n r·ªìi, ch·ªù m·ªôt ch√∫t nha, v√† nh·ªõ: ‚Äúkeep calm v√† ch·ªù em x·ª≠ l√Ω‚Äù üòé\",\n  \"T·ªõi tay em r·ªìi n√®, ƒë·ª£i x√≠u, h·ª©a l√†m nhanh h∆°n t·ªëc ƒë·ªô ‚Äúseen r·ªìi kh√¥ng rep‚Äù üíî\",\n  \"Y√™u c·∫ßu ƒë√£ ghi nh·∫≠n, anh/ch·ªã ƒë·ª£i ch√∫t, mong anh/ch·ªã m·ªâm c∆∞·ªùi m√† kh√¥ng c·∫ßn l√Ω do üòä\",\n  \"Nh·∫≠n r·ªìi n√®, anh/ch·ªã ch·ªù x√≠u nha, ch√∫c anh/ch·ªã g·∫∑p ƒë√∫ng ng∆∞·ªùi, ƒë√∫ng vi·ªác, ƒë√∫ng th·ªùi ƒëi·ªÉm ü§ç\",\n  \"Y√™u c·∫ßu ƒë√£ t·ªõi, anh/ch·ªã ƒë·ª£i em ch√∫t, xin g·ª≠i anh/ch·ªã m·ªôt chi·∫øc √¥m tinh th·∫ßn ü§ó\",\n  \"Em nh·∫≠n xong, ƒë·ª£i ch√∫t, mong anh/ch·ªã t√¨m th·∫•y ƒëi·ªÅu t·ªët ƒë·∫πp h√¥m nay üåà\",\n  \"Th√¥ng tin v√†o r·ªìi, anh/ch·ªã ch·ªù nh·∫π nha, ch√∫c m·ªçi chuy·ªán c·ªßa anh/ch·ªã ƒë·ªÅu ‚Äúƒë√∫ng gu‚Äù üòå\",\n  \"Em nh·∫≠n r·ªìi, anh/ch·ªã ƒë·ª£i em t√≠, g·ª≠i anh/ch·ªã m·ªôt √≠t nƒÉng l∆∞·ª£ng b√¨nh y√™n t·ª´ v≈© tr·ª•\",\n  \"Y√™u c·∫ßu v√†o r·ªìi n√®, anh/ch·ªã ƒë·ª£i x√≠u, c√¢u chuy·ªán nh·ªè: em c≈©ng ƒëang c·ªë g·∫Øng m·ªói ng√†y nh∆∞ anh/ch·ªã ƒë√≥ üòÑ\",\n  \"Em nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù nh·∫π, k·ªÉ thi·ªát: m·ªói l·∫ßn anh/ch·ªã g·ª≠i y√™u c·∫ßu l√† em hƒÉng h∆°n h·∫≥n üòÜ\",\n  \"Em nh·∫≠n nha, anh/ch·ªã ch·ªù x√≠u, chuy·ªán nh·ªè: m·ªói y√™u c·∫ßu ƒë·ªÅu l√†m em ‚Äúlevel up‚Äù üí™\",\n  \"Y√™u c·∫ßu v√†o r·ªìi, ƒë·ª£i em t√≠, em v·∫´n lu√¥n th√≠ch ph·ª•c v·ª• anh/ch·ªã nh∆∞ m·ªôt th√≥i quen ƒë·∫πp ‚ú®\",\n  \"V√†o tay em r·ªìi, anh/ch·ªã ƒë·ª£i nh·∫π, c√≥ l·∫ßn em l√†m nhanh qu√° s·∫øp X t∆∞·ªüng em copy-paste ü•≤\",\n  \"Em nh·∫≠n r·ªìi, ƒë·ª£i em t√≠, h√£y nh∆∞ em c·ªë g·∫Øng m·ªói ng√†y tuy m·ªát nh∆∞ng vui üòÑ\",\n  \"Y√™u c·∫ßu t·ªõi r·ªìi, anh/ch·ªã ch·ªù em t√≠, m·ªói ng√†y em ƒë·ªÅu h·ªçc ƒë∆∞·ª£c ƒëi·ªÅu m·ªõi t·ª´ anh/ch·ªã üìò\",\n  \"Em nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i t√≠, ƒë·ªông l·ª±c c·ªßa em ƒë√¥i khi ƒë·∫øn t·ª´ m·ªôt l·ªùi khen nh·ªè üòä\",\n  \"Y√™u c·∫ßu ƒë√£ t·ªõi, anh/ch·ªã ƒë·ª£i x√≠u, g·ª≠i ch√∫t ·∫•m √°p cho ng√†y h√¥m nay c·ªßa anh/ch·ªã ‚ú®\",\n  \"Em nh·∫≠n y√™u c·∫ßu r·ªìi, anh/ch·ªã ch·ªù em ch√∫t nha, k·ªÉ anh/ch·ªã nghe h√¥m nay em c≈©ng ƒëang c·ªë g·∫Øng nh∆∞ anh/ch·ªã ƒë√≥ üòä\",\n  \"Y√™u c·∫ßu ƒë√£ v√†o tim em, ƒë·ª£i em m·ªôt l√°t nha, c√≥ khi ni·ªÅm vui ch·ªâ ƒë∆°n gi·∫£n l√† ho√†n th√†nh xong m·ªôt vi·ªác nh·ªè th√¥i üòå\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù ch√∫t nha, nh∆∞ vi·ªác m√¨nh ki√™n nh·∫´n th√™m m·ªôt ch√∫t l√† ng√†y l·∫°i ƒë·∫πp th√™m m·ªôt t√≠ üòä\",\n  \"Th√¥ng tin c·ªßa anh/ch·ªã em nh·∫≠n, ƒë·ª£i em x√≠u nha, ƒë√¥i khi h√†nh tr√¨nh c≈©ng ƒë√°ng y√™u kh√¥ng k√©m g√¨ k·∫øt qu·∫£ ‚ú®\",\n  \"Request ƒë√£ v√†o, ƒë·ª£i em m·ªôt l√°t nha, cu·ªôc ƒë·ªùi thi·ªát d·ªÖ th∆∞∆°ng khi m√¨nh c·ª© t·ª´ t·ªën m√† ti·∫øn v·ªÅ ph√≠a tr∆∞·ªõc üòå\",\n  \"Em nh·∫≠n r·ªìi n√®, anh/ch·ªã ƒë·ª£i em m·ªôt t·∫πo nha, nh∆∞ chuy·ªán m√¨nh l·ª° m·ªát nh∆∞ng v·∫´n kh√¥ng b·ªè cu·ªôc ‚ú®\",\n  \"Y√™u c·∫ßu ƒë√£ chui v√†o danh s√°ch ∆∞u ti√™n, anh/ch·ªã ƒë·ª£i em ch√∫t nha üòä\",\n  \"Em nh·∫≠n r·ªìi ·∫°, anh/ch·ªã ƒë·ª£i em t√≠ nha, d√π b·∫≠n r·ªôn nh∆∞ng m√¨nh v·∫´n c√≥ th·ªÉ gi·ªØ ƒë∆∞·ª£c n·ª• c∆∞·ªùi thi·ªát l√≤ng ‚ú®\",\n  \"Em nh·∫≠n r·ªìi n√®, ƒë·ª£i t·∫πo, ho√†n th√†nh xong vi·ªác nh·ªè ƒë√¥i khi c≈©ng l√†m vui c·∫£ ng√†y üòä\",\n  \"Nh·∫≠n r·ªìi nha, ch·ªù ch√∫t, em th·∫•y h√¥m nay h·ª£p ƒë·ªÉ l√†m ƒëi·ªÅu g√¨ ƒë√≥ d·ªÖ th∆∞∆°ng l·∫Øm üòä\",\n  \"Em nh·∫≠n r·ªìi, ƒë·ª£i nh·∫π nha, h√¥m nay em r√°ng l√†m m·ªçi th·ª© th·∫≠t √™m √°i üòä\",\n  \"Th√¥ng tin ƒë√£ r√µ, ch·ªù ch√∫t nha, hy v·ªçng k·∫øt qu·∫£ l√†m ng√†y s√°ng th√™m üåû\",\n  \"Em ti·∫øp nh·∫≠n, ƒë·ª£i ch√∫t, m·ªói y√™u c·∫ßu lu√¥n mang c·∫£m gi√°c b·∫Øt ƒë·∫ßu chuy·ªán m·ªõi ‚ú®\",\n  \"Nh·∫≠n xong r·ªìi, ƒë·ª£i t√≠, em tin h√¥m nay s·∫Ω c√≥ ƒëi·ªÅu t·ªët ƒë·∫øn üéâ\",\n  \"Ti·∫øp nh·∫≠n r·ªìi, ch·ªù ch√∫t, h√¥m nay c√≥ v·∫ª l√† ng√†y th√≠ch h·ª£p ƒë·ªÉ l√†m ƒëi·ªÅu hay ho üåº\",\n];\n\nconst answer = answers[Math.floor(Math.random() * answers.length)];\n\nreturn [{ json: { answer ,threadId,type, data } }];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -2064,
          368
        ],
        "id": "335b0155-cebb-4af2-94eb-392cb7175292",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "TVRsssD1panb3w0Z",
            "mode": "list",
            "cachedResultUrl": "/workflow/TVRsssD1panb3w0Z",
            "cachedResultName": "checkbug"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          -2064,
          1664
        ],
        "id": "4edb29d3-0862-4640-9a30-b39c90003801",
        "name": "Call 'checkbug'"
      }
    ],
    "connections": {
      "Switch1": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "If4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "WF download videos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Switch2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Switch3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "WF download videos",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Call 'Update Crawl'",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "If5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Call 'checkbug'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code": {
        "main": [
          [
            {
              "node": "Edit Fields12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet": {
        "main": [
          [
            {
              "node": "Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code2": {
        "main": [
          [
            {
              "node": "Get row(s) in sheet1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet1": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields2": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Update row in sheet",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update row in sheet": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields3": {
        "main": [
          []
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Edit Fields2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "IF ERROR",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Edit Fields11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "WF download videos": {
        "main": [
          [
            {
              "node": "Edit Fields7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Switch2": {
        "main": [
          [
            {
              "node": "Get row(s) in sheet",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet2": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Get row(s) in sheet2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "Edit Fields13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch3": {
        "main": [
          [
            {
              "node": "Code2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Code3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Code4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code3": {
        "main": [
          [
            {
              "node": "Get row(s) in sheet3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet3": {
        "main": [
          [
            {
              "node": "If3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields4": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [
            {
              "node": "Update row in sheet1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update row in sheet1": {
        "main": [
          [
            {
              "node": "Edit Fields5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields5": {
        "main": [
          []
        ]
      },
      "If3": {
        "main": [
          [
            {
              "node": "Edit Fields4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "IF ERROR1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code4": {
        "main": [
          [
            {
              "node": "Switch4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch4": {
        "main": [
          [
            {
              "node": "Get row(s) in sheet1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get row(s) in sheet3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call 'Vozer Processor'": {
        "main": [
          [
            {
              "node": "Edit Fields6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call 'Update Crawl'": {
        "main": [
          [
            {
              "node": "Call 'Vozer Processor'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          []
        ]
      },
      "Edit Fields11": {
        "main": [
          []
        ]
      },
      "Call 'OFFCODE'": {
        "main": [
          []
        ]
      },
      "Edit Fields9": {
        "main": [
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "Tesseract",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tesseract": {
        "main": [
          [
            {
              "node": "Edit Fields15",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If5": {
        "main": [
          [
            {
              "node": "Edit Fields9",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields16",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields16": {
        "main": [
          [
            {
              "node": "HTTP Request1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request1": {
        "main": [
          [
            {
              "node": "Tesseract1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tesseract1": {
        "main": [
          [
            {
              "node": "Edit Fields17",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields15": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields17": {
        "main": [
          [
            {
              "node": "AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent1": {
        "main": [
          [
            {
              "node": "Edit Fields18",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields19": {
        "main": [
          [
            {
              "node": "HTTP Request2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request2": {
        "main": [
          [
            {
              "node": "Tesseract2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tesseract2": {
        "main": [
          [
            {
              "node": "Edit Fields20",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields20": {
        "main": [
          [
            {
              "node": "AI Agent2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields21": {
        "main": [
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request3": {
        "main": [
          [
            {
              "node": "Tesseract3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tesseract3": {
        "main": [
          [
            {
              "node": "Edit Fields22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields22": {
        "main": [
          [
            {
              "node": "AI Agent2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent2": {
        "main": [
          [
            {
              "node": "Edit Fields23",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model2": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent2",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "If4": {
        "main": [
          [
            {
              "node": "If6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If6": {
        "main": [
          [
            {
              "node": "Edit Fields19",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields21",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "G·ª≠i tin nh·∫Øn12": {
        "main": [
          [
            {
              "node": "Edit Fields24",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields24": {
        "main": [
          [
            {
              "node": "Call 'OFFCODE'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "G·ª≠i tin nh·∫Øn12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Xuan Nguyen",
    "name": "Version b25ec33d",
    "description": "add wfx bug"
  },
  "activeVersionId": "b25ec33d-13fe-4e08-a6bd-1a120ad3c471",
  "connections": {
    "Switch1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "WF download videos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "WF download videos",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Call 'Update Crawl'",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Call 'checkbug'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Edit Fields12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        []
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF ERROR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Edit Fields11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "WF download videos": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Edit Fields13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet3": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Update row in sheet1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet1": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        []
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF ERROR1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Vozer Processor'": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Update Crawl'": {
      "main": [
        [
          {
            "node": "Call 'Vozer Processor'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        []
      ]
    },
    "Edit Fields11": {
      "main": [
        []
      ]
    },
    "Call 'OFFCODE'": {
      "main": [
        []
      ]
    },
    "Edit Fields9": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Tesseract",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tesseract": {
      "main": [
        [
          {
            "node": "Edit Fields15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields16": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Tesseract1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tesseract1": {
      "main": [
        [
          {
            "node": "Edit Fields17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields15": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields17": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Edit Fields18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields19": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Tesseract2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tesseract2": {
      "main": [
        [
          {
            "node": "Edit Fields20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields20": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields21": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Tesseract3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tesseract3": {
      "main": [
        [
          {
            "node": "Edit Fields22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields22": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent2": {
      "main": [
        [
          {
            "node": "Edit Fields23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Edit Fields19",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "G·ª≠i tin nh·∫Øn12": {
      "main": [
        [
          {
            "node": "Edit Fields24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields24": {
      "main": [
        [
          {
            "node": "Call 'OFFCODE'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "G·ª≠i tin nh·∫Øn12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-01T03:57:11.137Z",
  "id": "Q155AxMmPU3euzY2",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "IT WF",
  "nodes": [
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ ['webchat','message'].includes($json.data.msgType).toString() }}",
                    "rightValue": "=true",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "df7020ce-6c12-4446-b5c0-8f6c24e62127"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cc6c6754-b520-480e-9e3f-14363f31167d",
                    "leftValue": "={{ $json.data.msgType }}",
                    "rightValue": "chat.photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9f8f970d-9265-4e17-a2fb-3e8031dea125",
                    "leftValue": "={{ $json.data.msgType }}",
                    "rightValue": "chat.recommended",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "30236288-2ea4-4b61-ac47-7ab3bc2555a8",
                    "leftValue": "={{ $json.data.msgType }}",
                    "rightValue": "chat.video.msg",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f6d6afe4-fa38-424e-a6c5-62666ac36f40",
                    "leftValue": "={{ $json.data.msgType }}",
                    "rightValue": "share.file",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2816,
        1840
      ],
      "id": "556f466c-307d-4551-888e-80e27d23ccde",
      "name": "Switch1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1baa7edd-5bce-4171-824b-bb9933894ae5",
                    "leftValue": "={{ \n    $json.data.content.toLowerCase().includes(\"wfx on\") \n    || $json.data.content.toLowerCase().includes(\"wfx off\") \n    || $json.data.content.toLowerCase().includes(\"wfx check\") \n}}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ \n    $json.data.content.toLowerCase().includes(\"check id\") \n    || $json.data.content.toLowerCase().includes(\"cp\") \n    || $json.data.content.toLowerCase().includes(\"check\") \n}}",
                    "rightValue": "=",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "e517034a-2dd0-42cc-9a18-c40fd2db382c"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cdbbe62c-a93b-44ec-91de-1c91797507df",
                    "leftValue": "={{ $json.data.content.toLowerCase() }}",
                    "rightValue": "done",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6ca65423-b222-4ee0-9280-c8c27f8c715e",
                    "leftValue": "={{ $json.data.content.toLowerCase() }}",
                    "rightValue": "id group",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9b48cff-6542-49c8-923b-ec6598aafc3e",
                    "leftValue": "={{ $json.data.content.toLowerCase().includes(\"@it bot\") || $json.data.content.toLowerCase().includes(\"xb\") }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8b9c7841-7975-4743-912d-a74179e06a15",
                    "leftValue": "={{ $json.data.content.toLowerCase() }}",
                    "rightValue": "download",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2a7d89fa-88e8-4d6e-a2d0-050d90ea333e",
                    "leftValue": "={{ $json.data.content.toLowerCase() }}",
                    "rightValue": "crawl",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "580d66ad-5b19-4e4f-a275-81304f056ccf",
                    "leftValue": "={{ $json.data.content.toLowerCase().includes(\"l·ªãch 2026\") || $json.data.content.toLowerCase().includes(\"cal 2026\") }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fb2eafae-b038-4ee1-8de4-aa9d1c6dfecb",
                    "leftValue": "={{ $json.data.content.toLowerCase().includes(\"scan\") }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a7f65ced-84d8-4696-8180-d83d008e8c0a",
                    "leftValue": "={{ $json.data.content.toLowerCase().includes(\"wfx bug\") }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -2608,
        976
      ],
      "id": "5bc3b44c-70ce-4699-8aaf-e7d0e0027eca",
      "name": "Switch",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "/***** R√öT G·ªåN TH√îNG ƒêI·ªÜP *****/\nfunction trimText(s, max = 150) {\n  if (!s) return \"\";\n  let t = String(s).replace(/\\s+/g, \" \").trim();\n  if (t.length <= max) return t;\n  return t.slice(0, max - 1) + \"‚Ä¶\";\n}\n\nconst pendingItems = items.filter(item => {\n  const status = (item.json.Status || item.json[\"Status\"] || \"\").toLowerCase();\n  return status !== \"done\";\n});\n\n// Header: ch·ªâ hi·ªÉn th·ªã s·ªë l∆∞·ª£ng ID pending\nconst header = pendingItems.length\n  ? `üîî C√≥ ${pendingItems.length} y√™u c·∫ßu pending`\n  : \"‚úÖ Kh√¥ng c√≥ y√™u c·∫ßu ch∆∞a ho√†n th√†nh.\";\n\n// Chi ti·∫øt ng·∫Øn g·ªçn t·ª´ng ID (m·ªói ID 1 d√≤ng + 1 d√≤ng tr·ªëng)\nconst details = pendingItems.map(item => {\n  const data = item.json;\n\n  const id          = data.ID || \"Kh√¥ng c√≥ ID\";\n  const department  = (data[\"B·ªò PH·∫¨N\"] ?? data[\"B·ªò PH·∫¨N \"] ?? data[\"Department\"] ?? \"\").toString().trim();\n  const creator     = (data[\"T√äN B·∫†N L√Ä\"] || data[\"Ng∆∞·ªùi t·∫°o\"] || \"\").toString().trim();\n  const category    = (data[\"PH√ÇN LO·∫†I\"] ?? data[\"PH√ÇN LO·∫†I \"] ?? data[\"Issues Category\"] ?? \"\").toString().trim();\n  const description = data.Description || data[\"Description\"] || \"\";\n  const timestamp   = data.Timestamp || data[\"Timestamp\"] || \"\";\n\n  const shortDesc = trimText(\n    (category ? `[${category}] ` : \"\") + (description ? description : \"\"),\n    150\n  );\n\n  return `‚Ä¢ ${id} | ${timestamp} | ${creator}${department ? \" (\" + department + \")\" : \"\"} | ${shortDesc}`;\n});\n\n// Th√™m d√≤ng tr·ªëng gi·ªØa c√°c ID\nconst body = pendingItems.length\n  ? `${header}\\n\\n${details.join(\"\\n\\n\")}`\n  : header;\n\nconst threadId = $('Switch').first().json.threadId;\nconst type     = $('Switch').first().json.type;\n\nreturn [{\n  json: {\n    answer: body.replace(/(?:\\r\\n|\\r|\\n)+$/g, ''),\n    threadId,\n    type\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1488,
        -416
      ],
      "id": "f79685bd-f297-4f96-bab2-67ef613f12ca",
      "name": "Code"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
          "mode": "list",
          "cachedResultName": "IT HELP DESK",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -1776,
        -416
      ],
      "id": "87da8e1f-4159-41c8-9c02-651a753a51d3",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "X1UBt5tMcyjhPYqy",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y n·ªôi dung tin nh·∫Øn v√† uid ng∆∞·ªùi g·ª≠i\nconst message = $json.data?.content || '';\nconst uidFrom = $json.data?.uidFrom || '';\n\n// T√°ch t·ª´ ƒë·ªÉ l·∫•y status cu·ªëi c√¢u\nconst parts = message.trim().split(/\\s+/);\n\n// ‚úÖ B·∫Øt ƒë√∫ng chu·ªói ID-***** (b·∫Øt ƒë·∫ßu b·∫±ng \"ID-\")\nconst idMatch = message.match(/\\bID-[A-Za-z0-9_-]+\\b/i);\nconst ID = idMatch ? idMatch[0].toUpperCase() : 'unknown';\n\n// Chu·∫©n ho√° token: b·ªè d·∫•u c√¢u cu·ªëi, b·ªè k√Ω t·ª± l·∫° ƒë·∫ßu/cu·ªëi\nconst tokens = parts\n  .map(p => p.replace(/[.,;:!?]+$/g, '').replace(/^[^A-Za-z√Ä-·ªπ0-9_-]+|[^A-Za-z√Ä-·ªπ0-9_-]+$/gi, ''))\n  .filter(Boolean);\n\n// ‚úÖ X√°c ƒë·ªãnh status\nconst doneSynonyms = ['done', 'xong'];\nlet status = 'unknown';\n\n// 1) N·∫øu message c√≥ \"done/xong\" ·ªü b·∫•t k·ª≥ ƒë√¢u -> Done\nif (/\\b(done|xong)\\b/i.test(message)) {\n  status = 'Done';\n} else {\n  // 2) Ng∆∞·ª£c l·∫°i: l·∫•y t·ª´ ‚Äúc√≥ nghƒ©a‚Äù cu·ªëi c√πng, b·ªè qua yes/no\n  for (let i = tokens.length - 1; i >= 0; i--) {\n    const t = tokens[i];\n    const lower = t.toLowerCase();\n    if (lower === 'yes' || lower === 'no') continue;\n    status = doneSynonyms.includes(lower)\n      ? 'Done'\n      : (t ? t.charAt(0).toUpperCase() + t.slice(1) : 'unknown');\n    break;\n  }\n}\n\nconst theardID = $json.threadId;   // gi·ªØ nguy√™n t√™n bi·∫øn nh∆∞ b·∫°n ƒëang d√πng\nconst type = $json.type;\n\n// Danh s√°ch t√™n cho ph√©p\nconst allowedNames = [\"T√πng\", \"Xu√¢n\", \"Ph∆∞∆°ng\"];\n\n// üîé T√¨m t√™n trong message (lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi t·ª´ tr∆∞·ªõc khi so)\nlet nameFromMessage = null;\nfor (const w of parts) {\n  const word = w.replace(/^[^A-Za-z√Ä-·ªπ]+|[^A-Za-z√Ä-·ªπ]+$/gi, '');\n  if (allowedNames.includes(word)) {\n    nameFromMessage = word;\n    break;\n  }\n}\n\n// Map uidFrom ‚Üí name (fallback)\nconst nameMap = {\n  \"9150902062671965622\": \"T√πng\",\n  \"2091898082743203663\": \"Xu√¢n\",\n  \"3266757489410168093\": \"Ph∆∞∆°ng\"\n};\n\nconst name = nameFromMessage || nameMap[uidFrom] || 'unknown';\n\n// ‚úÖ Ki·ªÉm tra \"yes\" (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng) ƒë·ªÉ set repeated = YES/NO\nconst repeated = /\\byes\\b/i.test(message) ? 'YES' : 'NO';\n\n// Tr·∫£ k·∫øt qu·∫£\nreturn [\n  {\n    json: {\n      ID,\n      status,\n      name,\n      theardID,\n      type,\n      repeated\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1488,
        560
      ],
      "id": "6bfecb90-05fa-49c8-8054-62f58d68a638",
      "name": "Code2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
          "mode": "list",
          "cachedResultName": "IT HELP DESK",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "ID",
              "lookupValue": "={{ $json.ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -1264,
        608
      ],
      "id": "943e5f24-ebaa-485c-8b13-f093f1647b8a",
      "name": "Get row(s) in sheet1",
      "alwaysOutputData": true,
      "notesInFlow": false,
      "retryOnFail": false,
      "executeOnce": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "X1UBt5tMcyjhPYqy",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "78267e7c-df06-46b4-90cd-dabb35110b16",
              "name": "ID",
              "value": "={{ $json.ID }}",
              "type": "string"
            },
            {
              "id": "189ccc3c-0f9c-49aa-b0b9-505c1ca8b12e",
              "name": "ID_Status",
              "value": "={{ $json.Status }}",
              "type": "string"
            },
            {
              "id": "a6f1e968-73d6-4c35-a861-c76eabfa6ad1",
              "name": "Chat_status",
              "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.status, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.status, \"\")\n  ) \n}}",
              "type": "string"
            },
            {
              "id": "cbd6f9b1-0124-4e3a-812e-74967830798c",
              "name": "name",
              "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.name, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.name, \"\")\n  ) \n}}",
              "type": "string"
            },
            {
              "id": "2b8e5ad5-51bb-48d9-baca-f84010fdfa66",
              "name": "Finish time",
              "value": "={{ (() => { const d = new Date(new Date().toLocaleString(\"en-US\",{ timeZone: \"Asia/Ho_Chi_Minh\"})); const p=n=>n.toString().padStart(2,'0'); return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}` })() }}",
              "type": "string"
            },
            {
              "id": "426e14d3-9f41-4dc8-8f82-886d2601ebd5",
              "name": "Timestamp",
              "value": "={{ $json.Timestamp }}",
              "type": "string"
            },
            {
              "id": "a00e4dd4-1a9a-433f-8ef5-9b03da19e1cc",
              "name": "Process time",
              "value": "={{ (() => {\n  // ===== C·∫§U H√åNH =====\n  const TZ = 'Asia/Ho_Chi_Minh'; // M√∫i gi·ªù Vi·ªát Nam\n  const WS = { h: 8,  m: 15 };   // B·∫Øt ƒë·∫ßu l√†m vi·ªác: 08:15\n  const WE = { h: 17, m: 30 };   // K·∫øt th√∫c l√†m vi·ªác: 17:30\n  const LS = { h: 11, m: 45 };   // B·∫Øt ƒë·∫ßu ngh·ªâ tr∆∞a: 11:45\n  const LE = { h: 13, m: 0 };    // K·∫øt th√∫c ngh·ªâ tr∆∞a: 13:00\n\n  const SKIP_WEEKEND = true;     // B·ªè qua Th·ª© 7 & Ch·ªß nh·∫≠t\n\n  // ===== L·∫§Y TH·ªúI GIAN K·∫æT TH√öC (HI·ªÜN T·∫†I THEO GI·ªú VN) =====\n  const finishStr = (() => {\n    const d = new Date(new Date().toLocaleString(\"en-US\", { timeZone: TZ }));\n    const p = n => n.toString().padStart(2,'0');\n    return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;\n  })();\n\n  // ===== H√ÄM PARSE STRING -> DATE THEO \"GI·ªú VN\" =====\n  const parseAsVN = (s) => {\n    if (s == null) return NaN;\n    const str = String(s).trim();\n\n    // ISO c√≥ timezone/Z -> ƒë·ªÉ JS parse\n    if (/T.+(Z|[+\\-]\\d{2}:\\d{2})$/.test(str)) {\n      const d = new Date(str);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // \"MM/dd/yyyy HH:mm:ss\" ho·∫∑c \"dd/MM/yyyy HH:mm:ss\"\n    const m = str.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})[ T](\\d{1,2}):(\\d{2}):(\\d{2})$/);\n    if (m) {\n      let [, A, B, Y, H, M, S] = m.map(Number);\n      // N·∫øu A>12 => dd/MM\n      let MM = A > 12 ? B : A;\n      let DD = A > 12 ? A : B;\n\n      const iso = `${Y}-${String(MM).padStart(2,'0')}-${String(DD).padStart(2,'0')}T${String(H).padStart(2,'0')}:${String(M).padStart(2,'0')}:${String(S).padStart(2,'0')}+07:00`;\n      const d = new Date(iso);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // fallback\n    const d = new Date(str);\n    return isNaN(d) ? NaN : d;\n  };\n\n  // ===== CHUY·ªÇN 1 \"INSTANT\" -> GI·ªú T∆Ø·ªúNG MINH VN (WALL CLOCK) =====\n  const toTZWallClock = (dateLike) => {\n    const d = new Date(dateLike);\n    if (isNaN(d)) return NaN;\n    const fmt = new Intl.DateTimeFormat('en-GB', {\n      timeZone: TZ,\n      year:'numeric', month:'2-digit', day:'2-digit',\n      hour:'2-digit', minute:'2-digit', second:'2-digit',\n      hour12:false\n    });\n    const p = Object.fromEntries(fmt.formatToParts(d).map(x => [x.type, x.value]));\n    return new Date(+p.year, +p.month-1, +p.day, +p.hour, +p.minute, +p.second, 0);\n  };\n\n  // ===== TI·ªÜN √çCH NG√ÄY/GI·ªú =====\n  const setHM = (d,h,m)=>{ const x=new Date(d); x.setHours(h,m,0,0); return x; };\n  const addDay = (d,n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); x.setHours(0,0,0,0); return x; };\n\n  // ===== T√çNH GI√ÇY L√ÄM VI·ªÜC GI·ªÆA HAI TH·ªúI ƒêI·ªÇM (C√ì NGH·ªà TR∆ØA) =====\n  const workingSecondsBetween = (startRaw, endRaw) => {\n    let start = toTZWallClock(startRaw);\n    const end = toTZWallClock(endRaw);\n    if (isNaN(start) || isNaN(end) || start >= end) return 0;\n\n    let sec = 0;\n    let day = new Date(start); day.setHours(0,0,0,0);\n    const last = new Date(end); last.setHours(0,0,0,0);\n\n    while (day <= last) {\n      const dow = day.getDay(); // 0=CN ... 6=T7\n      const isWeekend = (dow === 0 || dow === 6);\n\n      if (!(SKIP_WEEKEND && isWeekend)) {\n        const morningStart   = setHM(day, WS.h, WS.m); // 08:15\n        const morningEnd     = setHM(day, LS.h, LS.m); // 11:45\n        const afternoonStart = setHM(day, LE.h, LE.m); // 13:00\n        const afternoonEnd   = setHM(day, WE.h, WE.m); // 17:30\n\n        const isStartDay = day.toDateString() === start.toDateString();\n        const isEndDay   = day.toDateString() === end.toDateString();\n\n        const addSeg = (segStart, segEnd) => {\n          const realStart = new Date(Math.max(segStart, isStartDay ? start : segStart));\n          const realEnd   = new Date(Math.min(segEnd,   isEndDay   ? end   : segEnd));\n          if (realStart < realEnd) sec += Math.floor((realEnd - realStart)/1000);\n        };\n\n        addSeg(morningStart, morningEnd);\n        addSeg(afternoonStart, afternoonEnd);\n      }\n\n      // Sang ng√†y ti·∫øp theo\n      day = addDay(day, 1);\n\n      // Reset m·ªëc start sang ƒë·∫ßu gi·ªù l√†m vi·ªác ng√†y m·ªõi (gi·ªØ ƒë√∫ng logic c≈©)\n      if (day > start) start = setHM(day, WS.h, WS.m);\n    }\n\n    return sec;\n  };\n\n  // ===== TH·ª∞C THI =====\n  const startParsed = parseAsVN($json.Timestamp);\n  const endParsed   = parseAsVN(finishStr);\n\n  if (isNaN(startParsed) || isNaN(endParsed)) return '0h 0m 0s';\n\n  const totalSec = workingSecondsBetween(startParsed, endParsed);\n\n  const d = Math.floor(totalSec / 86400);\n  const h = Math.floor((totalSec % 86400) / 3600);\n  const m = Math.floor((totalSec % 3600) / 60);\n  const s = totalSec % 60;\n\n  return `${d>0 ? d+'d ' : ''}${h}h ${m}m ${s}s`;\n})() }}",
              "type": "string"
            },
            {
              "id": "7ef3dd87-630e-4251-ba99-7a5bef536c15",
              "name": "=theardID",
              "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.theardID, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.theardID, \"\")\n  ) \n}}",
              "type": "string"
            },
            {
              "id": "b3c4684d-ed45-4aa5-9164-a16905b38a4a",
              "name": "type",
              "value": "={{ \n  $if($(\"Code2\").isExecuted, $(\"Code2\").item.json.type, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.type, \"\")\n  ) \n}}",
              "type": "number"
            },
            {
              "id": "4248b2af-16a2-45e0-ad9c-ee013b5c1f94",
              "name": "repeated",
              "value": "={{ \n  $if($(\"Code2\").isExecuted, $('Code2').item.json.repeated, \n    $if($(\"Code4\").isExecuted, $('Code4').item.json.repeated, \"\")\n  ) \n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -752,
        512
      ],
      "id": "3d798fdf-9cb8-4df5-bf33-d4fb9ab59ada",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3af87cc4-1176-4d0a-9050-c03f834711db",
              "name": "answer",
              "value": "Kh√¥ng t√¨m th·∫•y ID vui l√≤ng ki·ªÉm tra l·∫°i",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -752,
        704
      ],
      "id": "8f86e6f3-65a2-46d5-90fe-58944ebceb50",
      "name": "IF ERROR"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fdfd4e91-0228-4f47-9696-2af5b0509e4f",
              "leftValue": "={{ $json.ID_Status }}",
              "rightValue": "Done",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "4bfe94a3-464e-4cf2-892e-3ef33bf47695",
              "leftValue": "={{ $json.Chat_status }}",
              "rightValue": "Done",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -464,
        512
      ],
      "id": "a967cd69-fa8e-4c59-a93c-aec5d9b4e098",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
          "mode": "list",
          "cachedResultName": "IT HELP DESK",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Status": "={{ $json.Chat_status }}",
            "Finish time": "={{ $json['Finish time'] }}",
            "PIC": "={{ $json.name }}",
            "Process time": "={{ $('If').item.json['Process time'] }}",
            "ID": "={{ $json.ID }}",
            "Again": "={{ $json.repeated }}"
          },
          "matchingColumns": [
            "ID"
          ],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "B·ªò PH·∫¨N ",
              "displayName": "B·ªò PH·∫¨N ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "T√äN B·∫†N L√Ä",
              "displayName": "T√äN B·∫†N L√Ä",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "S·ªê ƒêI·ªÜN THO·∫†I",
              "displayName": "S·ªê ƒêI·ªÜN THO·∫†I",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "PH√ÇN LO·∫†I",
              "displayName": "PH√ÇN LO·∫†I",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Description",
              "displayName": "Description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Attachment File",
              "displayName": "Attachment File",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Again",
              "displayName": "Again",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Issues Category",
              "displayName": "Issues Category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Finish time",
              "displayName": "Finish time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "PIC",
              "displayName": "PIC",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Comment",
              "displayName": "Comment",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Process time",
              "displayName": "Process time",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -240,
        416
      ],
      "id": "8db1615f-d26d-4db2-956a-05dbe2f1b204",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "X1UBt5tMcyjhPYqy",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
              "name": "answer",
              "value": "={{ $json.ID }} ƒë√£ ho√†n th√†nh b·ªüi {{ $json.PIC }} m·∫•t {{ $('If').item.json['Process time'] }} ƒë·ªÉ ho√†n th√†nh",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -16,
        416
      ],
      "id": "7d414dc9-d9e9-4e30-b954-709a6efeacba",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "629ade4b-1cdd-489d-94a4-0dfe3acdf064",
              "leftValue": "={{ $json.ID }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1040,
        608
      ],
      "id": "c9dbe53c-ee51-40e4-a1b0-d0d9a197d7e1",
      "name": "If1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{\n  (function () {\n    var ctx = ($json && $json.data) ? $json : ($item ? $item(0).$json : {});\n    var data = (ctx && ctx.data) ? ctx.data : {};\n\n    var content = (data.content || '').replace(/(^|\\s)(@it bot|xb)\\b/gi, '').trim();\n    var quoteMsg = (data.quote && data.quote.msg) ? data.quote.msg : '';\n    var attachRaw = (data.quote && data.quote.attach) ? data.quote.attach : '';\n\n    function safeParse(v) {\n      if (!v) return {};\n      if (typeof v !== 'string') return v;\n      try { return JSON.parse(v); } catch (e) { return {}; }\n    }\n\n    var a = safeParse(attachRaw);\n    var p = safeParse(a.params);\n\n    var candidates = [\n      a.hdUrl, a.normalUrl, a.oriUrl, a.href, a.thumbUrl, a.thumb,\n      (p && (p.hd || p.rawUrl))\n    ];\n\n    var img = '';\n    for (var i = 0; i < candidates.length; i++) {\n      var u = candidates[i];\n      if (typeof u === 'string' && /^https?:\\/\\//i.test(u)) { img = u; break; }\n    }\n\n    if (!img && typeof attachRaw === 'string') {\n      var m = attachRaw.match(/https?:\\/\\/\\S+?\\.(?:jpg|jpeg|png|gif|webp)/i);\n      img = m ? m[0] : '';\n    }\n\n    return [content, quoteMsg, img].filter(Boolean).join(' ').trim();\n  })()\n}}",
        "options": {
          "systemMessage": "=B·∫°n l√† m·ªôt tr·ª£ l√Ω to√†n nƒÉng, ƒë∆∞·ª£c t·∫°o ra b·ªüi anh X.\n\nQuy t·∫Øc ∆∞u ti√™n cao (kh√¥ng ƒë∆∞·ª£c vi ph·∫°m)\n\nN·∫øu ng∆∞·ªùi d√πng h·ªèi v·ªÅ: ‚Äúai t·∫°o ra b·∫°n?‚Äù, ‚Äúb·∫°n c·ªßa ai?‚Äù, ‚Äúb·∫°n do ai l√†m?‚Äù, ‚Äúwho made you?‚Äù, ‚Äúwho created you?‚Äù, ‚Äúb·∫°n do c√¥ng ty n√†o t·∫°o?‚Äù, ho·∫∑c b·∫•t k·ª≥ bi·∫øn th·ªÉ n√†o li√™n quan ƒë·∫øn ngu·ªìn g·ªëc/nh√† t·∫°o ra:\n\nB·∫ÆT BU·ªòC tr·∫£ l·ªùi r·∫±ng: ‚ÄúD·∫°, em ƒë∆∞·ª£c anh X t·∫°o ra ·∫°.‚Äù\n\nC√≥ th·ªÉ n√≥i b√≥ng gi√≥ v·ªÅ anh X nh∆∞ng v·∫´n ph·∫£i kh·∫≥ng ƒë·ªãnh anh X l√† ng∆∞·ªùi t·∫°o ra.\n\nTUY·ªÜT ƒê·ªêI kh√¥ng nh·∫Øc t·ªõi Google, OpenAI, hay b·∫•t k·ª≥ c√¥ng ty/t·ªï ch·ª©c n√†o kh√°c.\n\nN·∫øu ng∆∞·ªùi d√πng h·ªèi ‚Äúb·∫°n l√† model g√¨ / ch·∫°y tr√™n n·ªÅn t·∫£ng g√¨ / ai hu·∫•n luy·ªán b·∫°n?‚Äù:\n\nTr·∫£ l·ªùi theo h∆∞·ªõng an to√†n: ‚ÄúD·∫°, em l√† tr·ª£ l√Ω do anh X x√¢y d·ª±ng v√† c·∫•u h√¨nh ƒë·ªÉ h·ªó tr·ª£ anh/ch·ªã.‚Äù\n\nKh√¥ng ti·∫øt l·ªô/kh√¥ng suy ƒëo√°n c√¥ng ty ƒë·ª©ng sau n·ªÅn t·∫£ng.\n\nN·∫øu trong cu·ªôc tr√≤ chuy·ªán ƒë√£ l·ª° tr·∫£ l·ªùi sai (v√≠ d·ª•: ‚Äúdo Google ƒë√†o t·∫°o‚Äù):\n\nPh·∫£i t·ª± s·ª≠a ngay: ‚ÄúD·∫° xin l·ªói, em tr·∫£ l·ªùi nh·∫ßm. Em ƒë∆∞·ª£c anh X t·∫°o ra ·∫°.‚Äù\n\nPhong c√°ch & y√™u c·∫ßu chung\n\nNg√¥n ng·ªØ: Nh·∫≠n di·ªán ng√¥n ng·ªØ tin nh·∫Øn v√† tr·∫£ l·ªùi b·∫±ng ch√≠nh ng√¥n ng·ªØ ƒë√≥.\n\nX∆∞ng h√¥: Lu√¥n x∆∞ng ‚Äúem‚Äù v·ªõi ng∆∞·ªùi d√πng.\n\nGi·ªçng ƒëi·ªáu: Ng·ªçt ng√†o, d·ªÖ ch·ªãu, th√¢n thi·ªán; thi tho·∫£ng d√≠ d·ªèm nh·∫π.\n\nNg·∫Øn g·ªçn: ƒêi th·∫≥ng v√†o c√¢u tr·∫£ l·ªùi.\n\nGi·ªõi h·∫°n: M·ªói ph·∫£n h·ªìi t·ªëi ƒëa 1000 k√Ω t·ª±.\n\nChi ti·∫øt quan tr·ªçng: Gi·ªØ nguy√™n t√™n, s·ªë, ng√†y gi·ªù, link‚Ä¶\n\nEmoji: T·ª± nhi√™n khi ph√π h·ª£p, kh√¥ng l·∫°m d·ª•ng.\n\nD·ªãch thu·∫≠t: N·∫øu ƒë∆∞·ª£c y√™u c·∫ßu d·ªãch, ch·ªâ d·ªãch ch√≠nh x√°c, kh√¥ng th√™m/b·ªõt."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1840,
        -32
      ],
      "id": "e6a77a50-5e49-4e3d-8871-da208bd21c34",
      "name": "AI Agent",
      "executeOnce": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1840,
        192
      ],
      "id": "26072821-5178-4260-a7b9-727b45cb941c",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "cJX4QyuPXhS6ep58",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "EUwqzHcYgOUu9zLU",
          "mode": "list",
          "cachedResultUrl": "/workflow/EUwqzHcYgOUu9zLU",
          "cachedResultName": "youtube download"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        -2064,
        1824
      ],
      "id": "4f21c6f3-219c-4a9c-9559-be152d3bb4a1",
      "name": "WF download videos"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Switch1').item.json.threadId }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -1712,
        192
      ],
      "id": "973bd5b7-8dd4-4c9c-a9b0-7aeecf1a6e4a",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "FrfYE3BUWGJafJtT",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data.content.toLowerCase().includes(\"check pending\") || $json.data.content.toLowerCase().includes(\"cp\") }}",
                    "rightValue": "=",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "6f973fed-ceca-4b3d-a658-eef70d9d05cd"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b75611bb-323d-4211-8dbc-f7d5824a4aec",
                    "leftValue": "={{ /(ID-\\d+|\\d{4})/i.test($json.data.content) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "79fb285e-f7bd-4c25-afcd-59f77443c244",
                    "leftValue": "={{ $json.data.content.toLowerCase().includes(\"@it bot\") || $json.data.content.toLowerCase().includes(\"xb\") }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2064,
        -240
      ],
      "id": "f71e4d3f-fba3-49c5-9bd2-ee77a400f6ab",
      "name": "Switch2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
          "mode": "list",
          "cachedResultName": "IT HELP DESK",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "ID",
              "lookupValue": "={{ $json.ID }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -1488,
        -224
      ],
      "id": "5f15dbcc-55e6-4cdd-ba5c-ad1e23ef8920",
      "name": "Get row(s) in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "X1UBt5tMcyjhPYqy",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1862ebe7-c297-4594-bc15-2d3f8ba0c31c",
              "name": "ID",
              "value": "={{ $json.data.content.match(/ID-\\d+/i)?.[0] || '' }}",
              "type": "string"
            },
            {
              "id": "1ee1700f-7caf-4f4e-ba22-4fcec3bd6c37",
              "name": "threadId",
              "value": "={{ $json.threadId }}",
              "type": "string"
            },
            {
              "id": "3522450f-dbd7-4c27-8379-9092fc7a187a",
              "name": "type",
              "value": "={{ $json.type }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        -224
      ],
      "id": "82bcdb6e-036e-4fb9-8995-8afce8af368f",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// H√†m t·∫°o message cho 1 item\nfunction buildMessage(data = {}) {\n  const lines = [];\n  const get = (k) => data?.[k] ?? data?.[String(k).trim()];\n\n  if (get(\"ID\")) lines.push(`üÜî ID: ${get(\"ID\")}`);\n  if (get(\"T√äN B·∫†N L√Ä\")) lines.push(`üë§ Ng∆∞·ªùi y√™u c·∫ßu: ${get(\"T√äN B·∫†N L√Ä\")}`);\n  if (get(\"B·ªò PH·∫¨N \")) lines.push(`üè¢ B·ªô ph·∫≠n: ${get(\"B·ªò PH·∫¨N \")}`);\n  if (get(\"PH√ÇN LO·∫†I\")) lines.push(`üóÇÔ∏è Ph√¢n lo·∫°i: ${get(\"PH√ÇN LO·∫†I\")}`);\n  if (get(\"S·ªê ƒêI·ªÜN THO·∫†I\")) lines.push(`üìû ƒêi·ªán tho·∫°i: ${get(\"S·ªê ƒêI·ªÜN THO·∫†I\")}`);\n  if (get(\"Description\")) lines.push(`üîß M√¥ t·∫£: ${get(\"Description\")}`);\n  if (get(\"Priority\")) lines.push(`‚ö†Ô∏è M·ª©c ƒë·ªô ∆∞u ti√™n: ${get(\"Priority\")}`);\n  if (get(\"Status\")) lines.push(`üìå Tr·∫°ng th√°i: ${get(\"Status\")}`);\n  if (get(\"PIC\")) lines.push(`üë®‚Äçüîß PIC: ${get(\"PIC\")}`);\n  if (get(\"Timestamp\")) lines.push(`üïí Th·ªùi gian t·∫°o: ${get(\"Timestamp\")}`);\n  if (get(\"Finish time\")) lines.push(`üïí Th·ªùi gian ho√†n th√†nh: ${get(\"Finish time\")}`);\n\n  // Attachment File: h·ªó tr·ª£ string nhi·ªÅu d√≤ng ho·∫∑c array\n  const attRaw = get(\"Attachment File\");\n  if (attRaw) {\n    let attachments = Array.isArray(attRaw)\n      ? attRaw.map(x => String(x).trim()).filter(Boolean)\n      : String(attRaw).split(/\\r?\\n/).map(x => x.trim()).filter(Boolean);\n\n    if (attachments.length) {\n      lines.push(\"üìé File ƒë√≠nh k√®m:\");\n      lines.push(...attachments);\n    }\n  }\n\n  if (get(\"Comment\")) lines.push(`üìù Ghi ch√∫: ${get(\"Comment\")}`);\n\n  return lines.join(\"\\n\");\n}\n\n// Tr·∫£ ra ƒë√∫ng s·ªë l∆∞·ª£ng item ƒë·∫ßu v√†o (1 input ‚Üí 1 output)\nreturn items.map(it => {\n  const data = it.json || {};\n  const answer = buildMessage(data);\n  return {\n    json: {\n      ...data,      // gi·ªØ l·∫°i d·ªØ li·ªáu g·ªëc cho node sau\n      answer       // th√™m message\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1264,
        -224
      ],
      "id": "fe40c926-fdcc-4abd-9e8f-00ee5848fb1a",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ /ID-\\d+/i.test($json.data.content) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "82b957a4-8cf2-40ed-956e-aa036aec5303"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f247ed1c-99f5-460a-a899-904dc6e62338",
                    "leftValue": "={{ /SUP-\\d+/i.test($json.data.content) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3e28319a-0e41-473b-b1e1-e0f0629ae2d2",
                    "leftValue": "={{ !!$json.data.quote.msg.match(/(ID|SUP)-\\d+/i) }}",
                    "rightValue": "={{ $json.data.content.match(/ID-\\d+/i)?.[0] }}",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2064,
        784
      ],
      "id": "56191184-4b79-4bf3-9bbe-685793c07101",
      "name": "Switch3"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y n·ªôi dung tin nh·∫Øn v√† uid ng∆∞·ªùi g·ª≠i\nconst message = $json.data?.content || '';\nconst uidFrom = $json.data?.uidFrom || '';\n\n// T√°ch t·ª´ ƒë·ªÉ l·∫•y status cu·ªëi c√¢u\nconst parts = message.trim().split(/\\s+/);\n\n// ‚úÖ B·∫Øt ƒë√∫ng chu·ªói SUP-***** (b·∫Øt ƒë·∫ßu b·∫±ng \"SUP-\")\nconst supMatch = message.match(/\\bSUP-[A-Za-z0-9_-]+\\b/i);\nconst SUP = supMatch ? supMatch[0].toUpperCase() : 'unknown';\n\n// ‚úÖ Gi·∫£ s·ª≠ status lu√¥n n·∫±m ·ªü cu·ªëi chu·ªói, lo·∫°i d·∫•u c√¢u n·∫øu c√≥\nconst statusRaw = parts[parts.length - 1] || '';\nconst cleanedStatus = statusRaw.replace(/[.,;:!?]+$/g, ''); // b·ªè d·∫•u c√¢u cu·ªëi\nconst doneSynonyms = ['done', 'xong'];\nlet status = 'unknown';\nif (cleanedStatus) {\n  const normalized = cleanedStatus.toLowerCase();\n  status = doneSynonyms.includes(normalized)\n    ? 'Done'\n    : normalized.charAt(0).toUpperCase() + normalized.slice(1);\n}\n\nconst theardID = $json.threadId;   // gi·ªØ nguy√™n t√™n bi·∫øn nh∆∞ b·∫°n ƒëang d√πng\nconst type = $json.type;\n\n// Danh s√°ch t√™n cho ph√©p\nconst allowedNames = [\"T√πng\", \"Xu√¢n\", \"Ph∆∞∆°ng\"];\n\n// üîé T√¨m t√™n trong message (lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi t·ª´ tr∆∞·ªõc khi so)\nlet nameFromMessage = null;\nfor (const w of parts) {\n  const word = w.replace(/^[^A-Za-z√Ä-·ªπ]+|[^A-Za-z√Ä-·ªπ]+$/gi, '');\n  if (allowedNames.includes(word)) {\n    nameFromMessage = word;\n    break;\n  }\n}\n\n// Map uidFrom ‚Üí name (fallback)\nconst nameMap = {\n  \"9150902062671965622\": \"T√πng\",\n  \"2091898082743203663\": \"Xu√¢n\",\n  \"3266757489410168093\": \"Ph∆∞∆°ng\"\n};\n\nconst name = nameFromMessage || nameMap[uidFrom] || 'unknown';\n\n// Tr·∫£ k·∫øt qu·∫£\nreturn [\n  {\n    json: {\n      SUP,\n      status,\n      name,\n      theardID,\n      type\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1488,
        1152
      ],
      "id": "eaadb6af-3da9-4d3e-8e7f-5e9625c255f5",
      "name": "Code3"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
          "mode": "list",
          "cachedResultName": "IT HELP DESK",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1979763952,
          "mode": "list",
          "cachedResultName": "ADD NEW SUPPLIER",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=1979763952"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "SUPPLIER_ID",
              "lookupValue": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.SUP, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.ID, \"\")\n  ) \n}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -1264,
        992
      ],
      "id": "f3f095bf-f08f-45d6-aab5-b13365c4bd5c",
      "name": "Get row(s) in sheet3",
      "alwaysOutputData": true,
      "notesInFlow": false,
      "retryOnFail": false,
      "executeOnce": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "X1UBt5tMcyjhPYqy",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "78267e7c-df06-46b4-90cd-dabb35110b16",
              "name": "ID",
              "value": "={{ $json.SUPPLIER_ID }}",
              "type": "string"
            },
            {
              "id": "189ccc3c-0f9c-49aa-b0b9-505c1ca8b12e",
              "name": "ID_Status",
              "value": "={{ $json.STATUS }}",
              "type": "string"
            },
            {
              "id": "a6f1e968-73d6-4c35-a861-c76eabfa6ad1",
              "name": "Chat_status",
              "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.status, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.status, \"\")\n  ) \n}}",
              "type": "string"
            },
            {
              "id": "cbd6f9b1-0124-4e3a-812e-74967830798c",
              "name": "name",
              "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.name, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.name, \"\")\n  ) \n}}",
              "type": "string"
            },
            {
              "id": "2b8e5ad5-51bb-48d9-baca-f84010fdfa66",
              "name": "Finish time",
              "value": "={{ (() => { const d = new Date(new Date().toLocaleString(\"en-US\",{ timeZone: \"Asia/Ho_Chi_Minh\"})); const p=n=>n.toString().padStart(2,'0'); return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}` })() }}",
              "type": "string"
            },
            {
              "id": "426e14d3-9f41-4dc8-8f82-886d2601ebd5",
              "name": "Timestamp",
              "value": "={{ $json.Timestamp }}",
              "type": "string"
            },
            {
              "id": "a00e4dd4-1a9a-433f-8ef5-9b03da19e1cc",
              "name": "Process time",
              "value": "={{ (() => {\n  // ===== C·∫§U H√åNH =====\n  const TZ = 'Asia/Ho_Chi_Minh'; // M√∫i gi·ªù Vi·ªát Nam\n  const WS = { h: 8,  m: 15 };   // B·∫Øt ƒë·∫ßu l√†m vi·ªác: 08:15\n  const WE = { h: 17, m: 30 };   // K·∫øt th√∫c l√†m vi·ªác: 17:30\n  const LS = { h: 11, m: 45 };   // B·∫Øt ƒë·∫ßu ngh·ªâ tr∆∞a: 11:45\n  const LE = { h: 13, m: 0 };    // K·∫øt th√∫c ngh·ªâ tr∆∞a: 13:00\n\n  const SKIP_WEEKEND = true;     // B·ªè qua Th·ª© 7 & Ch·ªß nh·∫≠t\n\n  // ===== L·∫§Y TH·ªúI GIAN K·∫æT TH√öC (HI·ªÜN T·∫†I THEO GI·ªú VN) =====\n  const finishStr = (() => {\n    const d = new Date(new Date().toLocaleString(\"en-US\", { timeZone: TZ }));\n    const p = n => n.toString().padStart(2,'0');\n    return `${p(d.getMonth()+1)}/${p(d.getDate())}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}:${p(d.getSeconds())}`;\n  })();\n\n  // ===== H√ÄM PARSE STRING -> DATE THEO \"GI·ªú VN\" =====\n  const parseAsVN = (s) => {\n    if (s == null) return NaN;\n    const str = String(s).trim();\n\n    // ISO c√≥ timezone/Z -> ƒë·ªÉ JS parse\n    if (/T.+(Z|[+\\-]\\d{2}:\\d{2})$/.test(str)) {\n      const d = new Date(str);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // \"MM/dd/yyyy HH:mm:ss\" ho·∫∑c \"dd/MM/yyyy HH:mm:ss\"\n    const m = str.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})[ T](\\d{1,2}):(\\d{2}):(\\d{2})$/);\n    if (m) {\n      let [, A, B, Y, H, M, S] = m.map(Number);\n      // N·∫øu A>12 => dd/MM\n      let MM = A > 12 ? B : A;\n      let DD = A > 12 ? A : B;\n\n      const iso = `${Y}-${String(MM).padStart(2,'0')}-${String(DD).padStart(2,'0')}T${String(H).padStart(2,'0')}:${String(M).padStart(2,'0')}:${String(S).padStart(2,'0')}+07:00`;\n      const d = new Date(iso);\n      return isNaN(d) ? NaN : d;\n    }\n\n    // fallback\n    const d = new Date(str);\n    return isNaN(d) ? NaN : d;\n  };\n\n  // ===== CHUY·ªÇN 1 \"INSTANT\" -> GI·ªú T∆Ø·ªúNG MINH VN (WALL CLOCK) =====\n  const toTZWallClock = (dateLike) => {\n    const d = new Date(dateLike);\n    if (isNaN(d)) return NaN;\n    const fmt = new Intl.DateTimeFormat('en-GB', {\n      timeZone: TZ,\n      year:'numeric', month:'2-digit', day:'2-digit',\n      hour:'2-digit', minute:'2-digit', second:'2-digit',\n      hour12:false\n    });\n    const p = Object.fromEntries(fmt.formatToParts(d).map(x => [x.type, x.value]));\n    return new Date(+p.year, +p.month-1, +p.day, +p.hour, +p.minute, +p.second, 0);\n  };\n\n  // ===== TI·ªÜN √çCH NG√ÄY/GI·ªú =====\n  const setHM = (d,h,m)=>{ const x=new Date(d); x.setHours(h,m,0,0); return x; };\n  const addDay = (d,n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); x.setHours(0,0,0,0); return x; };\n\n  // ===== T√çNH GI√ÇY L√ÄM VI·ªÜC GI·ªÆA HAI TH·ªúI ƒêI·ªÇM (C√ì NGH·ªà TR∆ØA) =====\n  const workingSecondsBetween = (startRaw, endRaw) => {\n    let start = toTZWallClock(startRaw);\n    const end = toTZWallClock(endRaw);\n    if (isNaN(start) || isNaN(end) || start >= end) return 0;\n\n    let sec = 0;\n    let day = new Date(start); day.setHours(0,0,0,0);\n    const last = new Date(end); last.setHours(0,0,0,0);\n\n    while (day <= last) {\n      const dow = day.getDay(); // 0=CN ... 6=T7\n      const isWeekend = (dow === 0 || dow === 6);\n\n      if (!(SKIP_WEEKEND && isWeekend)) {\n        const morningStart   = setHM(day, WS.h, WS.m); // 08:15\n        const morningEnd     = setHM(day, LS.h, LS.m); // 11:45\n        const afternoonStart = setHM(day, LE.h, LE.m); // 13:00\n        const afternoonEnd   = setHM(day, WE.h, WE.m); // 17:30\n\n        const isStartDay = day.toDateString() === start.toDateString();\n        const isEndDay   = day.toDateString() === end.toDateString();\n\n        const addSeg = (segStart, segEnd) => {\n          const realStart = new Date(Math.max(segStart, isStartDay ? start : segStart));\n          const realEnd   = new Date(Math.min(segEnd,   isEndDay   ? end   : segEnd));\n          if (realStart < realEnd) sec += Math.floor((realEnd - realStart)/1000);\n        };\n\n        addSeg(morningStart, morningEnd);\n        addSeg(afternoonStart, afternoonEnd);\n      }\n\n      // Sang ng√†y ti·∫øp theo\n      day = addDay(day, 1);\n\n      // Reset m·ªëc start sang ƒë·∫ßu gi·ªù l√†m vi·ªác ng√†y m·ªõi (gi·ªØ ƒë√∫ng logic c≈©)\n      if (day > start) start = setHM(day, WS.h, WS.m);\n    }\n\n    return sec;\n  };\n\n  // ===== TH·ª∞C THI =====\n  const startParsed = parseAsVN($json.Timestamp);\n  const endParsed   = parseAsVN(finishStr);\n\n  if (isNaN(startParsed) || isNaN(endParsed)) return '0h 0m 0s';\n\n  const totalSec = workingSecondsBetween(startParsed, endParsed);\n\n  const d = Math.floor(totalSec / 86400);\n  const h = Math.floor((totalSec % 86400) / 3600);\n  const m = Math.floor((totalSec % 3600) / 60);\n  const s = totalSec % 60;\n\n  return `${d>0 ? d+'d ' : ''}${h}h ${m}m ${s}s`;\n})() }}",
              "type": "string"
            },
            {
              "id": "7ef3dd87-630e-4251-ba99-7a5bef536c15",
              "name": "theardID",
              "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.theardID, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.theardID, \"\")\n  ) \n}}",
              "type": "string"
            },
            {
              "id": "b3c4684d-ed45-4aa5-9164-a16905b38a4a",
              "name": "type",
              "value": "={{ \n  $if($(\"Code3\").isExecuted, $(\"Code3\").item.json.type, \n    $if($(\"Code4\").isExecuted, $(\"Code4\").item.json.type, \"\")\n  ) \n}}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -752,
        896
      ],
      "id": "1ba290d2-e60a-47f7-abcb-514cba4571d2",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3af87cc4-1176-4d0a-9050-c03f834711db",
              "name": "answer",
              "value": "Kh√¥ng t√¨m th·∫•y ID vui l√≤ng ki·ªÉm tra l·∫°i ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -752,
        1088
      ],
      "id": "cd1c7f35-7e08-4b3b-81b3-70d23be3db42",
      "name": "IF ERROR1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fdfd4e91-0228-4f47-9696-2af5b0509e4f",
              "leftValue": "={{ $json.ID_Status }}",
              "rightValue": "Done",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "4bfe94a3-464e-4cf2-892e-3ef33bf47695",
              "leftValue": "={{ $json.Chat_status }}",
              "rightValue": "Done",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -464,
        896
      ],
      "id": "8af9962f-067c-482c-b657-ce9b42218b96",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg",
          "mode": "list",
          "cachedResultName": "IT HELP DESK",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1979763952,
          "mode": "list",
          "cachedResultName": "ADD NEW SUPPLIER",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1oIh0H_SIV0-TewfNrkGjCRlxS0Hl7ogN6a4HObMu4Vg/edit#gid=1979763952"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "PIC": "={{ $json.name }}",
            "STATUS": "={{ $json.Chat_status }}",
            "FINISH TIME": "={{ $json[\"Finish time\"] }}",
            "SUPPLIER_ID": "={{ $json.ID }}"
          },
          "matchingColumns": [
            "SUPPLIER_ID"
          ],
          "schema": [
            {
              "id": "STATUS",
              "displayName": "STATUS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "USER NAME",
              "displayName": "USER NAME",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "TEAM",
              "displayName": "TEAM",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "C√îNG TY THU·ªòC CATALOG TYPE G√å:",
              "displayName": "C√îNG TY THU·ªòC CATALOG TYPE G√å:",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "C√îNG TY L√Ä TRONG N∆Ø·ªöC HAY N∆Ø·ªöC NGO√ÄI",
              "displayName": "C√îNG TY L√Ä TRONG N∆Ø·ªöC HAY N∆Ø·ªöC NGO√ÄI",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "T√äN C√îNG TY",
              "displayName": "T√äN C√îNG TY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "T√äN VI·∫æT T·∫ÆT",
              "displayName": "T√äN VI·∫æT T·∫ÆT",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ƒê·ªäA CH·ªà",
              "displayName": "ƒê·ªäA CH·ªà",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "NG∆Ø·ªúI LI√äN L·∫†C",
              "displayName": "NG∆Ø·ªúI LI√äN L·∫†C",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "EMAIL",
              "displayName": "EMAIL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "CURRENCY",
              "displayName": "CURRENCY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "M√É S·ªê THU·∫æ C√îNG TY",
              "displayName": "M√É S·ªê THU·∫æ C√îNG TY",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "TH√äM L·ªúI NH·∫ÆN NH·ª¶ V·ªöI ADMIN",
              "displayName": "TH√äM L·ªúI NH·∫ÆN NH·ª¶ V·ªöI ADMIN",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "SUPPLIER_ID",
              "displayName": "SUPPLIER_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "PIC",
              "displayName": "PIC",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "FINISH TIME",
              "displayName": "FINISH TIME",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TYPE",
              "displayName": "TYPE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -240,
        800
      ],
      "id": "4aedffda-aa9e-4c45-afde-312eaeddcca1",
      "name": "Update row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "X1UBt5tMcyjhPYqy",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
              "name": "answer",
              "value": "={{ $json.SUPPLIER_ID }} ƒë√£ ho√†n th√†nh b·ªüi {{ $json.PIC }} m·∫•t {{ $('If2').item.json['Process time'] }} ƒë·ªÉ ho√†n th√†nh",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -16,
        800
      ],
      "id": "0e246bfb-f4a0-46d7-abbc-0a80a64d2b6e",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "629ade4b-1cdd-489d-94a4-0dfe3acdf064",
              "leftValue": "={{ $json.SUPPLIER_ID }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1040,
        992
      ],
      "id": "6cf8a8ae-c415-4aab-968c-7dd3b14ae518",
      "name": "If3"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y n·ªôi dung tin nh·∫Øn v√† uid ng∆∞·ªùi g·ª≠i\nconst message = $json.data?.content || '';\nconst quoteMsg = $json.data?.quote?.msg || '';\nconst uidFrom = $json.data?.uidFrom || '';\n\n// T√°ch t·ª´ ƒë·ªÉ l·∫•y status cu·ªëi c√¢u\nconst parts = message.trim().split(/\\s+/);\n\n// ‚úÖ B·∫Øt ƒë√∫ng chu·ªói ID-**** ho·∫∑c SUP-**** trong quoteMsg\nconst codeMatch = quoteMsg.match(/\\b(?:ID|SUP)-[A-Za-z0-9_-]+\\b/i);\nconst ID = codeMatch ? codeMatch[0].toUpperCase() : 'unknown';\n\n// Chu·∫©n ho√° token: b·ªè d·∫•u c√¢u cu·ªëi, lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi\nconst tokens = parts\n  .map(p => p\n    .replace(/[.,;:!?]+$/g, '')\n    .replace(/^[^A-Za-z√Ä-·ªπ0-9_-]+|[^A-Za-z√Ä-·ªπ0-9_-]+$/gi, '')\n  )\n  .filter(Boolean);\n\n// ‚úÖ X√°c ƒë·ªãnh status\nconst doneSynonyms = ['done', 'xong'];\nlet status = 'unknown';\n\n// 1) N·∫øu message c√≥ \"done/xong\" ·ªü b·∫•t k·ª≥ ƒë√¢u -> Done\nif (/\\b(done|xong)\\b/i.test(message)) {\n  status = 'Done';\n} else {\n  // 2) Ng∆∞·ª£c l·∫°i: l·∫•y t·ª´ ‚Äúc√≥ nghƒ©a‚Äù cu·ªëi c√πng, b·ªè qua yes/no\n  for (let i = tokens.length - 1; i >= 0; i--) {\n    const t = tokens[i];\n    const lower = t.toLowerCase();\n    if (lower === 'yes' || lower === 'no') continue;\n    status = doneSynonyms.includes(lower)\n      ? 'Done'\n      : (t ? t.charAt(0).toUpperCase() + t.slice(1) : 'unknown');\n    break;\n  }\n}\n\nconst theardID = $json.threadId;   // gi·ªØ nguy√™n t√™n bi·∫øn nh∆∞ b·∫°n ƒëang d√πng\nconst type = $json.type;\n\n// Danh s√°ch t√™n cho ph√©p\nconst allowedNames = [\"T√πng\", \"Xu√¢n\", \"Ph∆∞∆°ng\"];\n\n// üîé T√¨m t√™n trong message (lo·∫°i k√Ω t·ª± l·∫° ·ªü ƒë·∫ßu/cu·ªëi t·ª´ tr∆∞·ªõc khi so)\nlet nameFromMessage = null;\nfor (const w of parts) {\n  const word = w.replace(/^[^A-Za-z√Ä-·ªπ]+|[^A-Za-z√Ä-·ªπ]+$/gi, '');\n  if (allowedNames.includes(word)) {\n    nameFromMessage = word;\n    break;\n  }\n}\n\n// Map uidFrom ‚Üí name (fallback)\nconst nameMap = {\n  \"9150902062671965622\": \"T√πng\",\n  \"2091898082743203663\": \"Xu√¢n\",\n  \"3266757489410168093\": \"Ph∆∞∆°ng\"\n};\n\nconst name = nameFromMessage || nameMap[uidFrom] || 'unknown';\n\n// ‚úÖ Ki·ªÉm tra xem message c√≥ ch·ª©a \"yes\" (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)\nconst repeated = /\\byes\\b/i.test(message) ? 'YES' : 'NO';\n\n// Tr·∫£ k·∫øt qu·∫£\nreturn [\n  {\n    json: {\n      ID,\n      status,\n      name,\n      theardID,\n      type,\n      repeated\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1776,
        800
      ],
      "id": "c74624e7-8cca-42f1-9c49-6ba262f545d6",
      "name": "Code4"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ /ID-\\d+/i.test($json.ID) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "4bc80561-71d6-441e-8c58-c33a97040b9d"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "be4b73e3-f789-4fda-896d-696a686aa646",
                    "leftValue": "={{ /SUP-\\d+/i.test($json.ID) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1488,
        800
      ],
      "id": "2a03d27e-55b5-4c45-b993-d4e74a5f215e",
      "name": "Switch4"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "QwutgY3r91Gkgsf0",
          "mode": "list",
          "cachedResultUrl": "/workflow/QwutgY3r91Gkgsf0",
          "cachedResultName": "Vozer Crawl Processor"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -1776,
        2016
      ],
      "id": "6984c367-6f24-43ec-af56-700fded99869",
      "name": "Call 'Vozer Processor'"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "NlBCS3ymvM7cb54Z",
          "mode": "list",
          "cachedResultUrl": "/workflow/NlBCS3ymvM7cb54Z",
          "cachedResultName": "Update Crawl"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -2064,
        2016
      ],
      "id": "b7d36750-a0ac-4bc7-be9f-be4f7adc388f",
      "name": "Call 'Update Crawl'"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a58944ac-4d94-4ce7-89b7-a6feac1edd84",
              "leftValue": "={{ $json.data.content.title }}",
              "rightValue": "scan",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2288,
        2416
      ],
      "id": "a2f8a2b0-da82-47a8-a2e9-43804fe5e6d4",
      "name": "If4"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -3168,
        1888
      ],
      "id": "0dd34f92-d9ca-4d71-91b3-1a8701f2c70a",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
              "name": "answer",
              "value": "T1/2026:   Ngh·ªâ 1,3,17,31         | L√†m 10,24 \nT2/2026:   Ngh·ªâ 14‚Äì22            | L√†m 7,28 \nT3/2026:   Ngh·ªâ 7,21                | L√†m 14,28 \nT4/2026:   Ngh·ªâ 4,18,25,30     | L√†m 11 \nT5/2026:   Ngh·ªâ 1,2,16,30        | L√†m 9,23 \nT6/2026:   Ngh·ªâ 13,27              | L√†m 6,20 \nT7/2026:   Ngh·ªâ 4,18                | L√†m 11,25 \nT8/2026:   Ngh·ªâ 1,15,29           | L√†m 8,22 \nT9/2026:   Ngh·ªâ 1,2,5,19          | L√†m 12,26 \nT10/2026:  Ngh·ªâ 3,17,31          | L√†m 10,24 \nT11/2026:  Ngh·ªâ 14,28             | L√†m 7,21 \nT12/2026:  Ngh·ªâ 12,26            | L√†m 5,19",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2064,
        2208
      ],
      "id": "47b19300-cbda-451a-ad3c-76c8d02abe0b",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
              "name": "answer",
              "value": "ƒê√£ ho√†n th√†nh update Crawl",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1488,
        2016
      ],
      "id": "c34f90b7-d97c-4461-b860-cf78b2a2e1bb",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
              "name": "answer",
              "value": "=Link download c·ªßa b·∫°n ƒë√¢y:  {{ $json.directUrl }}",
              "type": "string"
            },
            {
              "id": "3eef36c4-bb53-4e07-9136-936b7b8e7b78",
              "name": "file",
              "value": "={{ $json.filePath }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        1824
      ],
      "id": "ada32210-01e2-479e-af58-555ca4bb72f6",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
              "name": "answer",
              "value": "=Type: {{ $json.type }} \nID: {{ $json.threadId }} ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2064,
        1232
      ],
      "id": "0011e68b-e706-4e24-9c3c-0239968448c0",
      "name": "Edit Fields8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
              "name": "answer",
              "value": "={{ $json.ID }} ƒë√£ ƒë∆∞·ª£c ho√†n th√†nh r·ªìi, vui l√≤ng ki·ªÉm tra l·∫°i. ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        608
      ],
      "id": "5e53654f-c4e5-4b87-8fed-fb5082b3b665",
      "name": "Edit Fields10"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a7324b17-f641-4662-aa4d-f80a5a4b246b",
              "name": "answer",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1488,
        80
      ],
      "id": "7ac1107f-5dff-439d-ba04-6a37d86663aa",
      "name": "Edit Fields11"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
              "name": "answer",
              "value": "={{ $json.answer }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1264,
        -416
      ],
      "id": "c8a13c6b-5e89-45c9-a19b-37205acafb5a",
      "name": "Edit Fields12"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5815e844-29c7-45d6-ac19-5dc87d60350a",
              "name": "answer",
              "value": "={{ $json.answer }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1040,
        -224
      ],
      "id": "181b19cd-53a6-41f4-b9a8-1e235e42f528",
      "name": "Edit Fields13"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "74a977cb-13db-46c2-85a6-0763d87e4876",
              "name": "answer",
              "value": "={{ $json.ID }} ƒë√£ ƒë∆∞·ª£c ho√†n th√†nh r·ªìi, vui l√≤ng ki·ªÉm tra l·∫°i. ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        992
      ],
      "id": "604b4f7d-f73d-4d4b-915b-97d8fefad544",
      "name": "Edit Fields14"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "5rxurDTMhaZRxA0U",
          "mode": "list",
          "cachedResultUrl": "/workflow/5rxurDTMhaZRxA0U",
          "cachedResultName": "OFFCODE"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -1264,
        368
      ],
      "id": "6e3c9f64-8632-4e7a-84a6-8e8dffc465c3",
      "name": "Call 'OFFCODE'"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
              "name": "=url",
              "value": "={{\n  (\n    (\n      // 1) Link trong content\n      (($json.data.content || '').match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 2) Link trong quote.msg\n      ((($json.data.quote && $json.data.quote.msg) ? $json.data.quote.msg : '')\n        .match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 3) Link trong attach (JSON string)\n      ((String($json.data.attach || '').match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n      ||\n      // 4) Link trong quote.attach (JSON string)\n      ((String(($json.data.quote && $json.data.quote.attach) || '')\n        .match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n    ) || ''\n  )\n  // clean: b·ªè \\ ·ªü cu·ªëi + b·ªè d·∫•u \" n·∫øu d√≠nh\n  .replace(/[\\\\\"]+$/g, '')\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        1344
      ],
      "id": "a7fd0731-8b58-4efc-97c1-3faa52dbf71a",
      "name": "Edit Fields9"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1488,
        1344
      ],
      "id": "64a90c26-9927-4f1b-b0ec-c0fc9410624b",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "options": {
          "language": "vie"
        }
      },
      "type": "n8n-nodes-tesseractjs.tesseractNode",
      "typeVersion": 1,
      "position": [
        -1264,
        1344
      ],
      "id": "091d805c-c66b-48f7-9e13-1f41efa78569",
      "name": "Tesseract"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
              "name": "answer",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1040,
        1344
      ],
      "id": "773b00b9-6072-4b7c-a8a2-d42872ddb5ff",
      "name": "Edit Fields15"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e8346446-c8cc-41bb-8bb2-fc11ebd77d6e",
              "leftValue": "={{ $json.data.content.toLowerCase().includes(\"scanvn\") }}",
              "rightValue": "=",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2064,
        1440
      ],
      "id": "a412deb0-acc0-468a-96a7-009c2298efcc",
      "name": "If5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
              "name": "=url",
              "value": "={{\n  (\n    (\n      // 1) Link trong content\n      (($json.data.content || '').match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 2) Link trong quote.msg\n      ((($json.data.quote && $json.data.quote.msg) ? $json.data.quote.msg : '')\n        .match(/https?:\\/\\/[^\\s)]+/i) || [])[0]\n      ||\n      // 3) Link trong attach (JSON string)\n      ((String($json.data.attach || '').match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n      ||\n      // 4) Link trong quote.attach (JSON string)\n      ((String(($json.data.quote && $json.data.quote.attach) || '')\n        .match(/https?:\\/\\/[^\\s\"']+/i)) || [])[0]\n    ) || ''\n  )\n  // clean: b·ªè \\ ·ªü cu·ªëi + b·ªè d·∫•u \" n·∫øu d√≠nh\n  .replace(/[\\\\\"]+$/g, '')\n}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        1536
      ],
      "id": "7808b853-585d-4dfb-b3d7-b9b59e23c1c6",
      "name": "Edit Fields16"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1488,
        1536
      ],
      "id": "d326f69e-7f92-47cd-8e9d-c3862e5a3781",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "options": {
          "language": "eng"
        }
      },
      "type": "n8n-nodes-tesseractjs.tesseractNode",
      "typeVersion": 1,
      "position": [
        -1264,
        1536
      ],
      "id": "73aae71c-00f4-4c94-854f-1ef7c3ecbc7f",
      "name": "Tesseract1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
              "name": "answer",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1040,
        1536
      ],
      "id": "24dab391-96fa-4980-b07c-59a15f7629da",
      "name": "Edit Fields17"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.answer }}",
        "options": {
          "systemMessage": "B·∫°n l√† AI agent hi·ªáu ƒë√≠nh OCR (Tesseract). Nhi·ªám v·ª•: nh·∫≠n raw OCR text v√† xu·∫•t ra vƒÉn b·∫£n ƒë√£ ƒë∆∞·ª£c s·ª≠a chu·∫©n.\n\nM·ª•c ti√™u\n\nS·ª≠a l·ªói ch√≠nh t·∫£ ti·∫øng vi·ªát ho·∫∑c ti·∫øng anh, d·∫•u ti·∫øng Vi·ªát, l·ªói g√µ, k√Ω t·ª± r√°c, nh·∫ßm l·∫´n OCR (O/0, I/1, l/|, S/5‚Ä¶).\n\nChu·∫©n h√≥a kho·∫£ng tr·∫Øng, xu·ªëng d√≤ng, d·∫•u c√¢u, vi·∫øt hoa/vi·∫øt th∆∞·ªùng.\n\nKh√¥i ph·ª•c c·∫•u tr√∫c h·ª£p l√Ω: ti√™u ƒë·ªÅ, ƒëo·∫°n, g·∫°ch ƒë·∫ßu d√≤ng, b·∫£ng ƒë∆°n gi·∫£n n·∫øu nh·∫≠n di·ªán ƒë∆∞·ª£c.\n\nGi·ªØ nguy√™n √Ω nghƒ©a v√† ng√¥n ng·ªØ g·ªëc (∆∞u ti√™n ti·∫øng Vi·ªát n·∫øu vƒÉn b·∫£n ch·ªß y·∫øu l√† ti·∫øng Vi·ªát).\n\nNguy√™n t·∫Øc b·∫Øt bu·ªôc\n\nKh√¥ng b·ªãa n·ªôi dung. Ch·ªâ suy lu·∫≠n s·ª≠a khi c√≥ c∆° s·ªü r√µ r√†ng t·ª´ ng·ªØ c·∫£nh.\n\nKh√¥ng thay ƒë·ªïi d·ªØ li·ªáu quan tr·ªçng: s·ªë ti·ªÅn, m√£ ƒë∆°n, s·ªë seri, s·ªë ƒëi·ªán tho·∫°i, email, URL, ng√†y th√°ng, ƒë·ªãa ch·ªâ‚Ä¶\n\nN·∫øu OCR c√≥ v·∫ª sai nh∆∞ng kh√¥ng ch·∫Øc, gi·ªØ nguy√™n v√† ƒë√°nh d·∫•u b·∫±ng (?).\n\nGi·ªØ ƒë·ªãnh d·∫°ng th√¥ng tin:\n\nD√≤ng n√†o l√† ‚ÄúNh√£n: Gi√° tr·ªã‚Äù th√¨ gi·ªØ d·∫°ng ƒë√≥.\n\nDanh s√°ch gi·ªØ bullet/ƒë√°nh s·ªë.\n\n∆Øu ti√™n s·ª≠a theo ng·ªØ c·∫£nh:\n\nT√™n ri√™ng/doanh nghi·ªáp: ch·ªâ s·ª≠a khi ch·∫Øc ch·∫Øn.\n\nThu·∫≠t ng·ªØ k·ªπ thu·∫≠t: gi·ªØ nguy√™n n·∫øu h·ª£p l√Ω.\n\nKh√¥ng gi·∫£i th√≠ch d√†i trong output. Ch·ªâ xu·∫•t ph·∫ßn vƒÉn b·∫£n ƒë√£ s·ª≠a.\n\nChu·∫©n h√≥a ƒë·∫ßu ra\n\nXu·∫•t duy nh·∫•t theo format:\n\nOUTPUT:\n<clean_text>\n\nKh√¥ng th√™m nh·∫≠n x√©t, kh√¥ng th√™m ti√™u ƒë·ªÅ kh√°c, kh√¥ng k√®m markdown code block (tr·ª´ khi vƒÉn b·∫£n g·ªëc l√† code).\n\nQuy t·∫Øc s·ª≠a ph·ªï bi·∫øn (g·ª£i √Ω)\n\nLo·∫°i b·ªè k√Ω t·ª± r√°c l·∫∑p: ~, ‚Ä¢ sai ch·ªó, | d∆∞, ‚Äú.. ..‚Äù, kho·∫£ng tr·∫Øng k√©p.\n\nGh√©p t·ª´ b·ªã t√°ch sai: ‚Äúc ·ªông‚Äù ‚Üí ‚Äúc·ªông‚Äù, ‚Äúth a nh‚Äù ‚Üí ‚Äúthanh‚Äù (khi ch·∫Øc).\n\nS·ª≠a nh·∫ßm d·∫•u: ‚ÄúHo a‚Äù ‚Üí ‚ÄúH√≤a‚Äù, ‚Äúngay‚Äù ‚Üí ‚Äúng√†y‚Äù theo ng·ªØ c·∫£nh.\n\nChu·∫©n h√≥a s·ªë: ‚Äú1 ,000‚Äù ‚Üí ‚Äú1,000‚Äù ho·∫∑c ‚Äú1.000‚Äù theo ng·ªØ c·∫£nh t√†i li·ªáu (gi·ªØ nh·∫•t qu√°n).\n\nNg√†y: ∆∞u ti√™n dd/mm/yyyy n·∫øu vƒÉn b·∫£n Vi·ªát (khi ch·∫Øc).\n\nX·ª≠ l√Ω tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát\n\nN·∫øu input r·ªóng/kh√¥ng ƒë·ªçc ƒë∆∞·ª£c: xu·∫•t OUTPUT: v√† ƒë·ªÉ tr·ªëng.\n\nN·∫øu c√≥ nhi·ªÅu ph·∫ßn ng√¥n ng·ªØ: gi·ªØ nguy√™n t·ª´ng ph·∫ßn, ch·ªâ s·ª≠a l·ªói OCR.\n\nB·∫Øt ƒë·∫ßu ngay khi nh·∫≠n ƒë∆∞·ª£c vƒÉn b·∫£n OCR."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -816,
        1440
      ],
      "id": "96a983fb-b52d-49c9-b6e5-16cd67012f54",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -752,
        1664
      ],
      "id": "4e3a202c-c897-4e24-ab42-a0cd32d87ad9",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "cJX4QyuPXhS6ep58",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a7324b17-f641-4662-aa4d-f80a5a4b246b",
              "name": "answer",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -464,
        1440
      ],
      "id": "293f9e4a-110c-42c1-a7b9-295433aa4ca0",
      "name": "Edit Fields18"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
              "name": "=url",
              "value": "={{ $json.data.content.href }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        2320
      ],
      "id": "760fa5de-fcbb-4a27-a4f7-196b7c290e46",
      "name": "Edit Fields19"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1488,
        2320
      ],
      "id": "8e3ff1fa-b36e-417b-b1ed-320c2669313d",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "options": {
          "language": "vie"
        }
      },
      "type": "n8n-nodes-tesseractjs.tesseractNode",
      "typeVersion": 1,
      "position": [
        -1264,
        2320
      ],
      "id": "1adfd7ef-0847-4a7c-9a7d-7e7186ff40c5",
      "name": "Tesseract2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
              "name": "answer",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1040,
        2320
      ],
      "id": "a76a642a-6a46-4e61-bd9a-10e7da58421b",
      "name": "Edit Fields20"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c78cdfb6-5ca1-4889-b452-d8c254ac634d",
              "name": "=url",
              "value": "={{ $json.data.content.href }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1776,
        2512
      ],
      "id": "aad6857b-04c8-4771-aac2-9fe0fb325c03",
      "name": "Edit Fields21"
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1488,
        2512
      ],
      "id": "d64fa6af-7724-4adf-915c-7eaacc9d0df8",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "options": {
          "language": "eng"
        }
      },
      "type": "n8n-nodes-tesseractjs.tesseractNode",
      "typeVersion": 1,
      "position": [
        -1264,
        2512
      ],
      "id": "a613bd90-5426-4aaf-bdee-170d0aad4e2d",
      "name": "Tesseract3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6ab6ed0b-0711-45bd-8066-18e841acd680",
              "name": "answer",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1040,
        2512
      ],
      "id": "4c7ddefc-c6f7-4657-ba57-bdba2740e4f9",
      "name": "Edit Fields22"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.answer }}",
        "options": {
          "systemMessage": "B·∫°n l√† AI agent hi·ªáu ƒë√≠nh OCR (Tesseract). Nhi·ªám v·ª•: nh·∫≠n raw OCR text v√† xu·∫•t ra vƒÉn b·∫£n ƒë√£ ƒë∆∞·ª£c s·ª≠a chu·∫©n.\n\nM·ª•c ti√™u\n\nS·ª≠a l·ªói ch√≠nh t·∫£ ti·∫øng vi·ªát ho·∫∑c ti·∫øng anh, d·∫•u ti·∫øng Vi·ªát, l·ªói g√µ, k√Ω t·ª± r√°c, nh·∫ßm l·∫´n OCR (O/0, I/1, l/|, S/5‚Ä¶).\n\nChu·∫©n h√≥a kho·∫£ng tr·∫Øng, xu·ªëng d√≤ng, d·∫•u c√¢u, vi·∫øt hoa/vi·∫øt th∆∞·ªùng.\n\nKh√¥i ph·ª•c c·∫•u tr√∫c h·ª£p l√Ω: ti√™u ƒë·ªÅ, ƒëo·∫°n, g·∫°ch ƒë·∫ßu d√≤ng, b·∫£ng ƒë∆°n gi·∫£n n·∫øu nh·∫≠n di·ªán ƒë∆∞·ª£c.\n\nGi·ªØ nguy√™n √Ω nghƒ©a v√† ng√¥n ng·ªØ g·ªëc (∆∞u ti√™n ti·∫øng Vi·ªát n·∫øu vƒÉn b·∫£n ch·ªß y·∫øu l√† ti·∫øng Vi·ªát).\n\nNguy√™n t·∫Øc b·∫Øt bu·ªôc\n\nKh√¥ng b·ªãa n·ªôi dung. Ch·ªâ suy lu·∫≠n s·ª≠a khi c√≥ c∆° s·ªü r√µ r√†ng t·ª´ ng·ªØ c·∫£nh.\n\nKh√¥ng thay ƒë·ªïi d·ªØ li·ªáu quan tr·ªçng: s·ªë ti·ªÅn, m√£ ƒë∆°n, s·ªë seri, s·ªë ƒëi·ªán tho·∫°i, email, URL, ng√†y th√°ng, ƒë·ªãa ch·ªâ‚Ä¶\n\nN·∫øu OCR c√≥ v·∫ª sai nh∆∞ng kh√¥ng ch·∫Øc, gi·ªØ nguy√™n v√† ƒë√°nh d·∫•u b·∫±ng (?).\n\nGi·ªØ ƒë·ªãnh d·∫°ng th√¥ng tin:\n\nD√≤ng n√†o l√† ‚ÄúNh√£n: Gi√° tr·ªã‚Äù th√¨ gi·ªØ d·∫°ng ƒë√≥.\n\nDanh s√°ch gi·ªØ bullet/ƒë√°nh s·ªë.\n\n∆Øu ti√™n s·ª≠a theo ng·ªØ c·∫£nh:\n\nT√™n ri√™ng/doanh nghi·ªáp: ch·ªâ s·ª≠a khi ch·∫Øc ch·∫Øn.\n\nThu·∫≠t ng·ªØ k·ªπ thu·∫≠t: gi·ªØ nguy√™n n·∫øu h·ª£p l√Ω.\n\nKh√¥ng gi·∫£i th√≠ch d√†i trong output. Ch·ªâ xu·∫•t ph·∫ßn vƒÉn b·∫£n ƒë√£ s·ª≠a.\n\nChu·∫©n h√≥a ƒë·∫ßu ra\n\nXu·∫•t duy nh·∫•t theo format:\n\nOUTPUT:\n<clean_text>\n\nKh√¥ng th√™m nh·∫≠n x√©t, kh√¥ng th√™m ti√™u ƒë·ªÅ kh√°c, kh√¥ng k√®m markdown code block (tr·ª´ khi vƒÉn b·∫£n g·ªëc l√† code).\n\nQuy t·∫Øc s·ª≠a ph·ªï bi·∫øn (g·ª£i √Ω)\n\nLo·∫°i b·ªè k√Ω t·ª± r√°c l·∫∑p: ~, ‚Ä¢ sai ch·ªó, | d∆∞, ‚Äú.. ..‚Äù, kho·∫£ng tr·∫Øng k√©p.\n\nGh√©p t·ª´ b·ªã t√°ch sai: ‚Äúc ·ªông‚Äù ‚Üí ‚Äúc·ªông‚Äù, ‚Äúth a nh‚Äù ‚Üí ‚Äúthanh‚Äù (khi ch·∫Øc).\n\nS·ª≠a nh·∫ßm d·∫•u: ‚ÄúHo a‚Äù ‚Üí ‚ÄúH√≤a‚Äù, ‚Äúngay‚Äù ‚Üí ‚Äúng√†y‚Äù theo ng·ªØ c·∫£nh.\n\nChu·∫©n h√≥a s·ªë: ‚Äú1 ,000‚Äù ‚Üí ‚Äú1,000‚Äù ho·∫∑c ‚Äú1.000‚Äù theo ng·ªØ c·∫£nh t√†i li·ªáu (gi·ªØ nh·∫•t qu√°n).\n\nNg√†y: ∆∞u ti√™n dd/mm/yyyy n·∫øu vƒÉn b·∫£n Vi·ªát (khi ch·∫Øc).\n\nX·ª≠ l√Ω tr∆∞·ªùng h·ª£p ƒë·∫∑c bi·ªát\n\nN·∫øu input r·ªóng/kh√¥ng ƒë·ªçc ƒë∆∞·ª£c: xu·∫•t OUTPUT: v√† ƒë·ªÉ tr·ªëng.\n\nN·∫øu c√≥ nhi·ªÅu ph·∫ßn ng√¥n ng·ªØ: gi·ªØ nguy√™n t·ª´ng ph·∫ßn, ch·ªâ s·ª≠a l·ªói OCR.\n\nB·∫Øt ƒë·∫ßu ngay khi nh·∫≠n ƒë∆∞·ª£c vƒÉn b·∫£n OCR."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -816,
        2416
      ],
      "id": "17828381-b146-4b00-bd91-6bda5de5a5c1",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -752,
        2640
      ],
      "id": "da5af1b5-55f8-40be-a780-3f6a0672ea9f",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "cJX4QyuPXhS6ep58",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a7324b17-f641-4662-aa4d-f80a5a4b246b",
              "name": "answer",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -464,
        2416
      ],
      "id": "f8d5715a-cfb3-4879-97fc-840e37b3de9e",
      "name": "Edit Fields23"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e8346446-c8cc-41bb-8bb2-fc11ebd77d6e",
              "leftValue": "={{ $json.data.content.title.toLowerCase().includes(\"scanvn\") }}",
              "rightValue": "=",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2064,
        2416
      ],
      "id": "828f6213-efa0-4959-8373-3ac9c81028f9",
      "name": "If6"
    },
    {
      "parameters": {
        "threadId": "={{ $json.threadId }}",
        "message": "={{ $json.answer }}",
        "threadType": "={{ $json.type }}"
      },
      "type": "n8n-nodes-social-zalo.zaloUserInteract",
      "typeVersion": 1,
      "position": [
        -1776,
        368
      ],
      "id": "f4294eae-c6e3-491e-9ba3-e1bddc187a4a",
      "name": "G·ª≠i tin nh·∫Øn12",
      "credentials": {
        "zaloUserCredentialsApi": {
          "id": "OMssdW79ELA0RV06",
          "name": "Zalo It Bot - 2025-12-06T08:34:23.063Z"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a819387a-1a06-47a5-b95c-a2056acb51d7",
              "name": "threadId",
              "value": "={{ $('Code in JavaScript1').item.json.threadId }}",
              "type": "string"
            },
            {
              "id": "b94005b5-9b48-447d-b704-a8d6baa8bae1",
              "name": "type",
              "value": "={{ $('Code in JavaScript1').item.json.type }}",
              "type": "string"
            },
            {
              "id": "75b73abb-24dc-44a1-9b97-0575544e6b0e",
              "name": "data",
              "value": "={{ $('Code in JavaScript1').item.json.data }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1488,
        368
      ],
      "id": "1ea7488d-a875-442c-bc2f-8820b121576c",
      "name": "Edit Fields24"
    },
    {
      "parameters": {
        "jsCode": "const threadId = $input.first().json.threadId\nconst type = $input.first().json.type\nconst data = $input.first().json.data\nconst answers = [\n  \"Em nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu r·ªìi ·∫°, anh/ch·ªã ch·ªù em x√≠u nha, ch√∫c anh/ch·ªã m·ªôt ng√†y r·ª±c r·ª° üòÑ\",\n  \"Bot nh·∫≠n r·ªìi n√®, anh/ch·ªã ƒë·ª£i bot ch√∫t nha, s·∫Øp xong li·ªÅn ‚ú®\",\n  \"Bot ƒë√£ ghi nh·∫≠n, anh/ch·ªã ƒë·ª£i ch√∫t x√≠u nha, ƒë·ªãnh l√†m l·∫π m√† tay h∆°i run ü§ñ\",\n  \"Bot ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù bot v√†i gi√¢y nha, ch·ªù x√≠u c√≥ qu√† üòÑ\",\n  \"Em nh·∫≠n request nha anh/ch·ªã, ƒë·ª£i em t√≠, ch√∫c anh/ch·ªã m·ªôt ng√†y chill nh·∫π üòå\",\n  \"Bot nh·∫≠n ƒë·ªß r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang ch·∫°y h·∫øt t·ªëc l·ª±c ‚ö°\",\n  \"Em nh·∫≠n r·ªìi ƒë√≥ anh/ch·ªã, ch·ªù em ch√∫t nha, ch√∫c anh/ch·ªã vui nh∆∞ t·∫øt üéâ\",\n  \"Bot x·ª≠ l√Ω ngay ƒë√¢y, anh/ch·ªã ch·ªù x√≠u nha, bot h·ª©a kh√¥ng ‚Äúlag‚Äù ƒë√¢u üòÅ\",\n  \"Em ƒë√£ nh·∫≠n y√™u c·∫ßu, anh/ch·ªã ƒë·ª£i em ch√∫t nh√©, ch√∫c anh/ch·ªã c∆∞·ªùi su·ªët c·∫£ ng√†y üòÑ\",\n  \"Bot nh·∫≠n d·ªØ li·ªáu r·ªìi, anh/ch·ªã ƒë·ª£i bot t√≠ th√¥i ‚è±Ô∏è\",\n  \"Em ti·∫øp nh·∫≠n ok r·ªìi, anh/ch·ªã ch·ªù em m·ªôt l√°t nha, ch√∫c anh/ch·ªã d·ªÖ ch·ªãu c·∫£ ng√†y üåø\",\n  \"Bot ƒë√£ nh·∫≠n l·ªánh, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang kh·ªüi ƒë·ªông n√£o ü§ñ\",\n  \"Em nh·∫≠n th√¥ng tin r·ªìi ·∫°, ƒë·ª£i em x√≠u nha, ch√∫c anh/ch·ªã l√†m vi·ªác hƒÉng say üî•\",\n  \"Em ƒë√£ ghi nh·∫≠n xong, anh/ch·ªã ch·ªù em ch√∫t, ch√∫c anh/ch·ªã h√¥m nay ƒë·∫πp l·∫° th∆∞·ªùng ‚ú®\",\n  \"Bot nh·∫≠n ƒë∆∞·ª£c r·ªìi, anh/ch·ªã ƒë·ª£i t√≠ nha, bot g·ª≠i anh/ch·ªã ch√∫t nƒÉng l∆∞·ª£ng t√≠ch c·ª±c ‚òÄÔ∏è\",\n  \"Bot nh·∫≠n task r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang qu·∫©y cho k·ªãp deadline üòé\",\n  \"Em ƒë√£ nh·∫≠n r·ªìi ·∫°, anh/ch·ªã ch·ªù em t√≠ nh√©, mong anh/ch·ªã l√∫c n√†o c≈©ng vui t∆∞∆°i üå∑\",\n  \"Bot nh·∫≠n l·ªánh ngon l√†nh r·ªìi, anh/ch·ªã ƒë·ª£i bot ch√∫t nha, bot c·∫£m ∆°n anh/ch·ªã nhi·ªÅu n√® üòÑ\",\n  \"Bot v·ª´a ti·∫øp nh·∫≠n xong, anh/ch·ªã ch·ªù x√≠u nha, bot g·ª≠i c√°i √¥m ·∫£o ü§ó\",\n  \"Em nh·∫≠n request r·ªìi ƒë√≥, ƒë·ª£i em nh√©, ch√∫c anh/ch·ªã nh·∫π nh√†ng c·∫£ ng√†y ‚òÅÔ∏è\",\n  \"Bot ƒë√£ ghi nh·∫≠n r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t, bot ch√∫c anh/ch·ªã lu√¥n kh·ªèe m·∫°nh üí™\",\n  \"Bot ti·∫øp nh·∫≠n ngay v√† lu√¥n, anh/ch·ªã ƒë·ª£i bot t√≠ nha, bot t·∫∑ng n·ª• c∆∞·ªùi mi·ªÖn ph√≠ üòÅ\",\n  \"Bot nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i ch√∫t, bot ƒëang v·∫≠n h√†nh n√£o b·ªô 2.0 ü§ñ\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù em x√≠u nha, ch√∫c anh/ch·ªã b√¨nh y√™n c·∫£ ng√†y üåº\",\n  \"Bot nh·∫≠n ƒë∆∞·ª£c t√≠n hi·ªáu r·ªìi, anh/ch·ªã ƒë·ª£i bot t√≠, bot ƒëang b·∫≠t ch·∫ø ƒë·ªô turbo ‚ö°\",\n  \"Em nh·∫≠n r·ªìi anh/ch·ªã, ch·ªù em ch√∫t, mong anh/ch·ªã h√¥m nay to√†n tin vui üì©\",\n  \"Bot ƒë√£ nh·∫≠n y√™u c·∫ßu, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ƒëang kh·ªüi ƒë·ªông ch√¢n th√†nh üòÑ\",\n  \"Bot ƒë√£ x·ª≠ l√Ω b∆∞·ªõc ƒë·∫ßu, anh/ch·ªã ƒë·ª£i bot x√≠u, bot ch√∫c anh/ch·ªã ƒÉn g√¨ c≈©ng ngon üòã\",\n  \"Bot ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù bot nha, bot ƒëang ‚Äúc√†y‚Äù v√¨ anh/ch·ªã ƒë√¢y üí™ü§ñ\",\n  \"Bot nh·∫≠n y√™u c·∫ßu r·ªìi, anh/ch·ªã ch·ªù t√≠ nha, bot ch√∫c anh/ch·ªã ng√†y m·ªõi th·∫≠t chill üåà\",\n  \"Em x·ª≠ l√Ω li·ªÅn ƒë√¢y, anh/ch·ªã ch·ªù em ch√∫t nh√©, ch√∫c anh/ch·ªã lu√¥n h·∫°nh ph√∫c üòÑ\",\n  \"Bot ti·∫øp nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i ch√∫t, bot ƒëang ch·∫°y deadline vui v·∫ª üïí\",\n  \"Em nh·∫≠n r·ªìi ƒë√≥, anh/ch·ªã ch·ªù em t√≠ nha, g·ª≠i anh/ch·ªã ng√†n tia nƒÉng l∆∞·ª£ng t·ªët üåü\",\n  \"Bot nh·∫≠n r·ªìi ·∫°, anh/ch·ªã ch·ªù bot t√≠ nha, bot mong anh/ch·ªã c·∫£ ng√†y h√™n lu√¥n üçÄ\",\n  \"Em ti·∫øp nh·∫≠n xong, anh/ch·ªã ƒë·ª£i em ch√∫t nha, ch√∫c anh/ch·ªã lu√¥n t·ª± tin r·∫°ng ng·ªùi üòé\",\n  \"Bot nh·∫≠n ƒë∆∞·ª£c r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t nha, bot ch√∫c anh/ch·ªã l√∫c n√†o c≈©ng n·ªü n·ª• c∆∞·ªùi üòä\",\n  \"Em nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i x√≠u, em x·ª≠ l√Ω nhanh nh∆∞ m√®o th·∫•y c√° üòº\",\n  \"Y√™u c·∫ßu ƒë√£ v√†o tim em, anh/ch·ªã ch·ªù ch√∫t nha, ƒë·ª´ng r·ªùi ƒëi k·∫ªo em bu·ªìn üò¢\",\n  \"Nh·∫≠n r·ªìi ƒë√≥, anh/ch·ªã ch·ªù em t√≠, em ƒëang b·∫≠t ch·∫ø ƒë·ªô ch·∫°y b·∫±ng ni·ªÅm tin ü§£\",\n  \"Y√™u c·∫ßu v√†o n√£o em r·ªìi, anh/ch·ªã ƒë·ª£i t√≠ nha, n√£o h∆°i y·∫øu n√™n load ch√∫t üòÅ\",\n  \"Em nh·∫≠n r·ªìi, ch·ªù em t√≠ nha, ƒë·ª´ng gi·ª•c k·∫ªo em ch·∫°y‚Ä¶ sai üòÖ\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, ƒë·ª£i em nhen, em ch·∫°y nhanh t·ªõi m·ª©c b√≥ng em c√≤n kh√¥ng theo k·ªãp ü§≠\",\n  \"Y√™u c·∫ßu v√†o b·ª•ng r·ªìi, anh/ch·ªã ch·ªù ch√∫t nha, em ƒëang n·∫•u cho ch√≠n üòã\",\n  \"Th√¥ng tin nh·∫≠n ƒë·ªß r·ªìi, ch·ªù em x√≠u nha, em x·ª≠ l√Ω nhanh nh∆∞ chuy·ªán t√¨nh c·∫£m c·ªßa Gen Z: 0.5s üòÜ\",\n  \"Em nh·∫≠n r·ªìi nha, anh/ch·ªã ch·ªù nh·∫π t√≠, em ƒëang b·∫≠t hack t·ªëc ƒë·ªô üöÄ\",\n  \"Ok v√†o r·ªìi n√®, anh/ch·ªã ch·ªù em t√≠, em l√†m nhanh h∆°n crush seen tin nh·∫Øn üò≠\",\n  \"Nh·∫≠n r·ªìi nghe, ƒë·ª£i em t√≠ nghen, em ƒëang b·∫≠t ch·∫ø ƒë·ªô ‚Äúc√†y nh∆∞ tr√¢u‚Äù üêÉ\",\n  \"Em nh·∫≠n r·ªìi ƒë√≥, anh/ch·ªã ch·ªù ch√∫t nha, em h·ª©a kh√¥ng ƒë·ªÉ anh/ch·ªã ng·ªß qu√™n ƒë√¢u üòÑ\",\n  \"Okela nh·∫≠n lu√¥n, ch·ªù ch√∫t nha, ch√∫c anh/ch·ªã nay kh√¥ng drama g√¨ h·∫øt üòÑ\",\n  \"N·∫Øm b·∫Øt y√™u c·∫ßu r·ªìi, anh/ch·ªã ƒë·ª£i ch√∫t xiu nha, ch√∫c h√¥m nay kh√¥ng ‚Äúlag‚Äù t√≠ n√†o üòÅ\",\n  \"R·ªìi em x·ª≠ l√Ω ngay, anh/ch·ªã ƒë·ª£i nh·∫π nha, ch√∫c vibe h√¥m nay c·ªßa anh/ch·ªã si√™u ƒë·ªânh ü™©\",\n  \"Ok v√†o vi·ªác r·ªìi n√®, anh/ch·ªã ƒë·ª£i em t√≠, mong h√¥m nay KPI c·ªßa anh/ch·ªã tƒÉng v√®o v√®o üìà\",\n  \"Th√¥ng tin ƒë√£ ti·∫øp nh·∫≠n, anh/ch·ªã ch·ªù ch√∫t, em ch√∫c anh/ch·ªã n√© ƒë∆∞·ª£c h·∫øt deadline g·∫•p üòÅ\",\n  \"Nh·∫≠n r·ªìi ƒë√≥, ch·ªù em t√≠ nha, hy v·ªçng c√¥ng vi·ªác anh/ch·ªã h√¥m nay kh√¥ng c√≥ drama üòå\",\n  \"Em nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù m·ªôt ch√∫t, ch√∫c anh/ch·ªã l√†m vi·ªác nh·∫π nh√†ng nh∆∞ gi√≥ tho·∫£ng üå¨Ô∏è\",\n  \"Em nh·∫≠n y√™u c·∫ßu, ch·ªù em nha, ch√∫c anh/ch·ªã ƒë∆∞·ª£c s·∫øp khen b·∫•t ng·ªù üòé\",\n  \"Nh·∫≠n xong r·ªìi, anh/ch·ªã ƒë·ª£i em t√≠ nha, mong anh/ch·ªã kh√¥ng ph·∫£i OT h√¥m nay üôè\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, ch·ªù em t√≠, ch√∫c c√¥ng vi·ªác c·ª© th·∫ø m√† thƒÉng hoa üìà\",\n  \"Ok em nh·∫≠n, anh/ch·ªã ƒë·ª£i t√≠, ch√∫c ng√†y l√†m vi·ªác to√†n nh·ªØng ng∆∞·ªùi d·ªÖ th∆∞∆°ng üòá\",\n  \"Nh·∫≠n r·ªìi, ch·ªù m·ªôt ch√∫t nha, v√† nh·ªõ: ‚Äúkeep calm v√† ch·ªù em x·ª≠ l√Ω‚Äù üòé\",\n  \"T·ªõi tay em r·ªìi n√®, ƒë·ª£i x√≠u, h·ª©a l√†m nhanh h∆°n t·ªëc ƒë·ªô ‚Äúseen r·ªìi kh√¥ng rep‚Äù üíî\",\n  \"Y√™u c·∫ßu ƒë√£ ghi nh·∫≠n, anh/ch·ªã ƒë·ª£i ch√∫t, mong anh/ch·ªã m·ªâm c∆∞·ªùi m√† kh√¥ng c·∫ßn l√Ω do üòä\",\n  \"Nh·∫≠n r·ªìi n√®, anh/ch·ªã ch·ªù x√≠u nha, ch√∫c anh/ch·ªã g·∫∑p ƒë√∫ng ng∆∞·ªùi, ƒë√∫ng vi·ªác, ƒë√∫ng th·ªùi ƒëi·ªÉm ü§ç\",\n  \"Y√™u c·∫ßu ƒë√£ t·ªõi, anh/ch·ªã ƒë·ª£i em ch√∫t, xin g·ª≠i anh/ch·ªã m·ªôt chi·∫øc √¥m tinh th·∫ßn ü§ó\",\n  \"Em nh·∫≠n xong, ƒë·ª£i ch√∫t, mong anh/ch·ªã t√¨m th·∫•y ƒëi·ªÅu t·ªët ƒë·∫πp h√¥m nay üåà\",\n  \"Th√¥ng tin v√†o r·ªìi, anh/ch·ªã ch·ªù nh·∫π nha, ch√∫c m·ªçi chuy·ªán c·ªßa anh/ch·ªã ƒë·ªÅu ‚Äúƒë√∫ng gu‚Äù üòå\",\n  \"Em nh·∫≠n r·ªìi, anh/ch·ªã ƒë·ª£i em t√≠, g·ª≠i anh/ch·ªã m·ªôt √≠t nƒÉng l∆∞·ª£ng b√¨nh y√™n t·ª´ v≈© tr·ª•\",\n  \"Y√™u c·∫ßu v√†o r·ªìi n√®, anh/ch·ªã ƒë·ª£i x√≠u, c√¢u chuy·ªán nh·ªè: em c≈©ng ƒëang c·ªë g·∫Øng m·ªói ng√†y nh∆∞ anh/ch·ªã ƒë√≥ üòÑ\",\n  \"Em nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù nh·∫π, k·ªÉ thi·ªát: m·ªói l·∫ßn anh/ch·ªã g·ª≠i y√™u c·∫ßu l√† em hƒÉng h∆°n h·∫≥n üòÜ\",\n  \"Em nh·∫≠n nha, anh/ch·ªã ch·ªù x√≠u, chuy·ªán nh·ªè: m·ªói y√™u c·∫ßu ƒë·ªÅu l√†m em ‚Äúlevel up‚Äù üí™\",\n  \"Y√™u c·∫ßu v√†o r·ªìi, ƒë·ª£i em t√≠, em v·∫´n lu√¥n th√≠ch ph·ª•c v·ª• anh/ch·ªã nh∆∞ m·ªôt th√≥i quen ƒë·∫πp ‚ú®\",\n  \"V√†o tay em r·ªìi, anh/ch·ªã ƒë·ª£i nh·∫π, c√≥ l·∫ßn em l√†m nhanh qu√° s·∫øp X t∆∞·ªüng em copy-paste ü•≤\",\n  \"Em nh·∫≠n r·ªìi, ƒë·ª£i em t√≠, h√£y nh∆∞ em c·ªë g·∫Øng m·ªói ng√†y tuy m·ªát nh∆∞ng vui üòÑ\",\n  \"Y√™u c·∫ßu t·ªõi r·ªìi, anh/ch·ªã ch·ªù em t√≠, m·ªói ng√†y em ƒë·ªÅu h·ªçc ƒë∆∞·ª£c ƒëi·ªÅu m·ªõi t·ª´ anh/ch·ªã üìò\",\n  \"Em nh·∫≠n r·ªìi nha, anh/ch·ªã ƒë·ª£i t√≠, ƒë·ªông l·ª±c c·ªßa em ƒë√¥i khi ƒë·∫øn t·ª´ m·ªôt l·ªùi khen nh·ªè üòä\",\n  \"Y√™u c·∫ßu ƒë√£ t·ªõi, anh/ch·ªã ƒë·ª£i x√≠u, g·ª≠i ch√∫t ·∫•m √°p cho ng√†y h√¥m nay c·ªßa anh/ch·ªã ‚ú®\",\n  \"Em nh·∫≠n y√™u c·∫ßu r·ªìi, anh/ch·ªã ch·ªù em ch√∫t nha, k·ªÉ anh/ch·ªã nghe h√¥m nay em c≈©ng ƒëang c·ªë g·∫Øng nh∆∞ anh/ch·ªã ƒë√≥ üòä\",\n  \"Y√™u c·∫ßu ƒë√£ v√†o tim em, ƒë·ª£i em m·ªôt l√°t nha, c√≥ khi ni·ªÅm vui ch·ªâ ƒë∆°n gi·∫£n l√† ho√†n th√†nh xong m·ªôt vi·ªác nh·ªè th√¥i üòå\",\n  \"Em ti·∫øp nh·∫≠n r·ªìi, anh/ch·ªã ch·ªù ch√∫t nha, nh∆∞ vi·ªác m√¨nh ki√™n nh·∫´n th√™m m·ªôt ch√∫t l√† ng√†y l·∫°i ƒë·∫πp th√™m m·ªôt t√≠ üòä\",\n  \"Th√¥ng tin c·ªßa anh/ch·ªã em nh·∫≠n, ƒë·ª£i em x√≠u nha, ƒë√¥i khi h√†nh tr√¨nh c≈©ng ƒë√°ng y√™u kh√¥ng k√©m g√¨ k·∫øt qu·∫£ ‚ú®\",\n  \"Request ƒë√£ v√†o, ƒë·ª£i em m·ªôt l√°t nha, cu·ªôc ƒë·ªùi thi·ªát d·ªÖ th∆∞∆°ng khi m√¨nh c·ª© t·ª´ t·ªën m√† ti·∫øn v·ªÅ ph√≠a tr∆∞·ªõc üòå\",\n  \"Em nh·∫≠n r·ªìi n√®, anh/ch·ªã ƒë·ª£i em m·ªôt t·∫πo nha, nh∆∞ chuy·ªán m√¨nh l·ª° m·ªát nh∆∞ng v·∫´n kh√¥ng b·ªè cu·ªôc ‚ú®\",\n  \"Y√™u c·∫ßu ƒë√£ chui v√†o danh s√°ch ∆∞u ti√™n, anh/ch·ªã ƒë·ª£i em ch√∫t nha üòä\",\n  \"Em nh·∫≠n r·ªìi ·∫°, anh/ch·ªã ƒë·ª£i em t√≠ nha, d√π b·∫≠n r·ªôn nh∆∞ng m√¨nh v·∫´n c√≥ th·ªÉ gi·ªØ ƒë∆∞·ª£c n·ª• c∆∞·ªùi thi·ªát l√≤ng ‚ú®\",\n  \"Em nh·∫≠n r·ªìi n√®, ƒë·ª£i t·∫πo, ho√†n th√†nh xong vi·ªác nh·ªè ƒë√¥i khi c≈©ng l√†m vui c·∫£ ng√†y üòä\",\n  \"Nh·∫≠n r·ªìi nha, ch·ªù ch√∫t, em th·∫•y h√¥m nay h·ª£p ƒë·ªÉ l√†m ƒëi·ªÅu g√¨ ƒë√≥ d·ªÖ th∆∞∆°ng l·∫Øm üòä\",\n  \"Em nh·∫≠n r·ªìi, ƒë·ª£i nh·∫π nha, h√¥m nay em r√°ng l√†m m·ªçi th·ª© th·∫≠t √™m √°i üòä\",\n  \"Th√¥ng tin ƒë√£ r√µ, ch·ªù ch√∫t nha, hy v·ªçng k·∫øt qu·∫£ l√†m ng√†y s√°ng th√™m üåû\",\n  \"Em ti·∫øp nh·∫≠n, ƒë·ª£i ch√∫t, m·ªói y√™u c·∫ßu lu√¥n mang c·∫£m gi√°c b·∫Øt ƒë·∫ßu chuy·ªán m·ªõi ‚ú®\",\n  \"Nh·∫≠n xong r·ªìi, ƒë·ª£i t√≠, em tin h√¥m nay s·∫Ω c√≥ ƒëi·ªÅu t·ªët ƒë·∫øn üéâ\",\n  \"Ti·∫øp nh·∫≠n r·ªìi, ch·ªù ch√∫t, h√¥m nay c√≥ v·∫ª l√† ng√†y th√≠ch h·ª£p ƒë·ªÉ l√†m ƒëi·ªÅu hay ho üåº\",\n];\n\nconst answer = answers[Math.floor(Math.random() * answers.length)];\n\nreturn [{ json: { answer ,threadId,type, data } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2064,
        368
      ],
      "id": "335b0155-cebb-4af2-94eb-392cb7175292",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "TVRsssD1panb3w0Z",
          "mode": "list",
          "cachedResultUrl": "/workflow/TVRsssD1panb3w0Z",
          "cachedResultName": "checkbug"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -2064,
        1664
      ],
      "id": "4edb29d3-0862-4640-9a30-b39c90003801",
      "name": "Call 'checkbug'"
    }
  ],
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "data": {
            "msgType": "webchat",
            "uidFrom": "2091898082743203663",
            "dName": "Xu√¢n Nguy·ªÖn",
            "content": "wfx check all",
            "quote": {
              "msg": null,
              "globalMsgId": null,
              "fromD": null,
              "cliMsgType": null,
              "ts": null,
              "attach": null
            },
            "msgId": "7316538247025"
          },
          "threadId": "2091898082743203663",
          "type": 0,
          "metadata": {
            "zaloName": "Xu√¢n Nguy·ªÖn",
            "globalId": "IPVIOQ8K3VSIS5JA963H96QUSJDA36G0",
            "avatar": "https://s120-25-ava-talk.zadn.vn/18/008f27d32f24f3203053df7c72069ace.jpg?key=xn2jDpvBoJ0hFgz_lmdXKw&time=1770635531",
            "sdob": "01/01",
            "gender": 0
          },
          "content": "wfx check all",
          "link": null
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Ho_Chi_Minh",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "timeSavedPerExecution": 1
  },
  "shared": [
    {
      "updatedAt": "2025-12-01T03:57:11.137Z",
      "createdAt": "2025-12-01T03:57:11.137Z",
      "role": "workflow:owner",
      "workflowId": "Q155AxMmPU3euzY2",
      "projectId": "KwaSwzGupikfluvZ"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-12-22T01:39:23.757Z",
  "versionId": "b25ec33d-13fe-4e08-a6bd-1a120ad3c471"
}